==============================================================
Guild: Ergo Platform
Channel: üõ† „Éª„Äò Development „Äô‚ò∞ / ‚ùì‚îÇergoscript-support
==============================================================

[06/13/2021 10:34 AM] fateme.r#4033
I have pubkey.propbytes in a box register, how can I use this register to make sure that the box spender has the secret key belonging to pubkey?
I can't find the proper syntax


[06/13/2021 11:04 AM] fateme.r#4033
@kushti


[06/13/2021 2:13 PM] greenhat#6562
`proveDlog(decodePoint(pubkey.propBytes))` should work

{Reactions}
üòç 

[06/13/2021 2:48 PM] fateme.r#4033
thanks


[06/13/2021 5:18 PM] Deleted User#0000
Is it possible to use boxId in ergo script? Is there any overflow or something like this?


[06/13/2021 5:19 PM] Deleted User#0000
OUTPUTS(3).R4[Long].get == byteArrayToBigInt(CONTEXT.dataInputs(0).id) % totalSoldTicket


[06/13/2021 5:20 PM] Deleted User#0000


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/853670071074422834/unknown.png


[06/13/2021 5:20 PM] Deleted User#0000


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/853670085535989780/unknown.png


[06/13/2021 5:21 PM] Deleted User#0000
I checked the math in appkit and thats correct.  so the winner value is correct and its in R4.


[06/13/2021 5:21 PM] Deleted User#0000
but the script returns false so it should be an error in ergo script.


[06/13/2021 5:23 PM] Deleted User#0000
@greenhat @Ilya | Spectrum  thanks in advance


[06/13/2021 5:27 PM] Deleted User#0000
is this because bigint is signed?


[06/13/2021 6:59 PM] greenhat#6562
Nothing catches my eye. You can compare the eval semantics below:
The `byteArrayToBigInt` eval is - https://github.com/ScorexFoundation/sigmastate-interpreter/blob/89afefa935d52dd83741f6530f97e4c935992f76/sigma-impl/src/main/scala/special/sigma/SigmaDslOverArrays.scala#L56-L60
where `to256ValueExact` is https://github.com/ScorexFoundation/sigmastate-interpreter/blob/89afefa935d52dd83741f6530f97e4c935992f76/common/src/main/scala/scalan/util/Extensions.scala#L166-L177


[06/13/2021 7:00 PM] greenhat#6562
@morphic any ideas? ^^^


[06/13/2021 7:03 PM] greenhat#6562
BigInt `mod` is using java's:
```
    /**
     * Returns a BigInteger whose value is {@code (this mod m}).  This method
     * differs from {@code remainder} in that it always returns a
     * <i>non-negative</i> BigInteger.
     *
     * @param  m the modulus.
     * @return {@code this mod m}
     * @throws ArithmeticException {@code m} &le; 0
     * @see    #remainder
     */
    public BigInteger mod(BigInteger m) {
        if (m.signum <= 0)
            throw new ArithmeticException("BigInteger: modulus not positive");

        BigInteger result = this.remainder(m);
        return (result.signum >= 0 ? result : result.add(m));
    }
```


[06/13/2021 7:04 PM] greenhat#6562
If id parses to negative bigint the result of `%` should be  non-negative.


[06/13/2021 7:44 PM] morphic#4133
In the appkit example you are using scala.math.BigInt, that is why it works. In ErgoScript different BigInt is used.


[06/13/2021 7:44 PM] kushti#0978
if you got bytes via proveDlog.toSigmaProp.propBytes, then SELF.R4[SigmaProp].get would be enough I guess @greenhat


[06/13/2021 7:53 PM] morphic#4133
Not every id will pass this method https://github.com/ScorexFoundation/sigmastate-interpreter/blob/7a772ef8f6b249ee6f16d98629841c86a4ed0ad1/common/src/main/scala/scalan/util/Extensions.scala#L166
This check is performed as part of byteArrayToBigInt


[06/13/2021 7:57 PM] morphic#4133
@Deleted User do you need all bytes of boxId. If can use less bytes (by slicing them out) then it should work.

{Reactions}
üçâ 

[06/13/2021 7:58 PM] Deleted User#0000
No I don't. Thx yes I am using slice method and works fine.

{Reactions}
üëç 

[08/27/2021 11:19 AM] Crypto Cream#4657
Why is it if you change the script to something else evaluating to true in the pin lock contract it errors out? https://scastie.scala-lang.org/gMr5ZxOjS7mKCKSDNYpsWQ


[08/27/2021 3:33 PM] Crypto Cream#4657
I cant even find any documentation explaining what `sigmaProp` does


[08/27/2021 4:06 PM] glasgowm#9381
There's some recent discussion about it if you search in here


[08/27/2021 4:06 PM] glasgowm#9381
@Gazza_SP might know


[08/27/2021 5:32 PM] Crypto Cream#4657
Maybe it's worth creating a learning-ergoscript channel? Because not to be rude, but I have experience in python and solidity and the current documentation/examples & explanations still make ergo smart contracts next to impossible to approach


[08/28/2021 11:21 AM] glasgowm#9381
That is what this channel is though? Documentation will improve over the next too ergohacks

I would expect it to be difficult atm as it's nothing like python or solidity.


[08/28/2021 11:39 AM] glasgowm#9381 (pinned)
https://www.reddit.com/r/ergonauts/comments/pcwcui/info_on_developing_ergo_applicationssmart/

{Embed}
https://www.reddit.com/r/ergonauts/comments/pcwcui/info_on_developing_ergo_applicationssmart/
r/ergonauts - Info on developing Ergo applications/smart contracts
25 votes and 5 comments so far on Reddit
https://images-ext-1.discordapp.net/external/nu58OXTf7eBUJrMRuvmlrqSInyUF3W4SU1GtbirPcPU/%3Fauto%3Dwebp%26s%3D829500df3560e6d13ef78f9942032e6d819e1c9b/https/external-preview.redd.it/DyG0YL4dLFK0sr33lsjDx66icgiifG1GoitkHzGTiuA.jpg


[08/28/2021 11:40 AM] glasgowm#9381
Pinned a message.


[08/28/2021 8:15 PM] morphic#4133
```
/** Embedding of Boolean values to SigmaProp values. As an example, this
 * operation allows boolean experesions to be used as arguments of
 * `atLeast(..., sigmaProp(myCondition), ...)` operation.
 */
def sigmaProp(condition: Boolean): SigmaProp
```
from here https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md


[08/28/2021 8:17 PM] Crypto Cream#4657
I guess I just meant trying to find others who are also trying to learn so we can bounce questions off eachother


[08/28/2021 8:19 PM] Crypto Cream#4657
I agree the language overall is better than solidity and I can see all the benefits, however I am trying to point out as someone coming over from solidity wanting to work with ergo smart contracts I'm finding it difficult, which I find a real shame as I love the tech ergo team has produced


[08/28/2021 8:19 PM] Crypto Cream#4657
Thanks morphic, I didn't see anything pointing to the scorexfoundation docs so I didn't look there


[08/28/2021 11:58 PM] glasgowm#9381
Oh we agree. Working on it :)


[09/08/2021 5:44 PM] kushti#0978
https://www.ergoforum.org/t/ergoscript-design-patterns/222/23

{Embed}
https://www.ergoforum.org/t/ergoscript-design-patterns/222/23
ErgoScript Design patterns
Discovered by @anon_real :  As is it possible to store box in a register (and context extension of an input), it is also possible to prove that spent box had some properties. For that, we need to issue  certificate NFT during spending, to check then that corresponding box had some properties (while certificate box is not spent). Used in auctions...

{Reactions}
ergo_orange 

[09/08/2021 8:48 PM] kushti#0978
It is not about the language mostly I believe, rather different execution model and context


[09/09/2021 10:29 PM] Crypto Cream#4657
agreed, I actually think I've got the hang of it now


[09/10/2021 9:43 PM] Crypto Cream#4657
The documentaion (https://github.com/ergoplatform/ergo/wiki#box) say a box needs a minimum of 4 peices of data, but you can create one with just `value` and `script`? Does additional assets and txid get added automatically if nothing is stated?


[09/10/2021 9:47 PM] Crypto Cream#4657
So `R0` and `R1` normally need to be set and `R2` and `R3` will be set automatically if nothing is expressed?


[09/11/2021 7:10 AM] greenhat#6562
@Hz No additional assets (tokens?) are added. R0-R3 are mandatory registers and they are automatically set, see https://github.com/ScorexFoundation/sigmastate-interpreter/blob/1a1b003bc30e490d8b5af30e7670227e54e682c2/sigmastate/src/main/scala/org/ergoplatform/ErgoBox.scala#L29-L34
R4-R9 are additional registers and can be filled by a developer with any data they want.

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/1a1b003bc30e490d8b5af30e7670227e54e682c2/sigmastate/src/main/scala/org/ergoplatform/ErgoBox.scala
sigmastate-interpreter/ErgoBox.scala at 1a1b003bc30e490d8b5af30e767...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/ErgoBox.scala at 1a1b003bc30e490d8b5af30e7670227e54e682c2 ¬∑ ScorexFoundation/sigmastate-inte...
https://images-ext-2.discordapp.net/external/wCUVhYZC82xSdxu4AhWNyeniYgzPY2UQW-gXS4Ulqrc/https/opengraph.githubassets.com/5e9dbeda2dce845eac4ed4701599b10318b824f5af4b6f84be4dd00a15b99a51/ScorexFoundation/sigmastate-interpreter


[09/11/2021 10:52 AM] Crypto Cream#4657
Thanks greenhat - apologies I guess I worded it badly, I didn't mean actual additional assets being auto added, just the value being auto set to 0. 

In what cases would create a box without `R0` and `R1` though? What get's auto set if you don't express anything?


[09/11/2021 12:35 PM] greenhat#6562
1. None.
2. R0 is value(coins), R1 is script, R2 is tokens (empty if none), R3 is block height and tx id. So only R2 can be empty.


[09/13/2021 10:09 PM] fateme.r#4033
I wrote a script but got syntax exceptions, gradually made it simpler and simpler but still got exceptions.
What am I doing wrong here in this script?


[09/13/2021 10:09 PM] fateme.r#4033


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/887082632578498570/unknown.png


[09/13/2021 10:10 PM] fateme.r#4033


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/887082730309959720/unknown.png


[09/13/2021 10:10 PM] fateme.r#4033
@greenhat would you please check it out?


[09/14/2021 6:52 AM] kii#8888
are we still taking examples for ergoscript?


[09/14/2021 8:28 AM] greenhat#6562
Hey! This error looks super confusing and I had to look into the parser code to wrap my head around it. We need better error reporting. üôÇ 
The parser is trying to parse a lambda out of `val bool = true`.  Try enclosing the whole script with `{}`.


[09/14/2021 9:57 AM] fateme.r#4033
Thanks a lot, it solved my problem


[09/17/2021 5:05 AM] Marty#4039
anyone trying to learn ergoscript and has come to the part about secp256k1 and schnorr proofs? To what level of understanding would someone need to be able to write ergo smart contracts?
elliptical curve cryptography seems like it requires a strong understanding of abstract algebra


[09/17/2021 5:59 AM] Marty#4039
https://blog.cloudflare.com/a-relatively-easy-to-understand-primer-on-elliptic-curve-cryptography/
this actually helped make some sense of it, even though they gloss over the math both for RSA and elliptical curve


[09/17/2021 9:28 AM] greenhat#6562
In ErgoScript all this is abstracted away so I'd say to write contacts you don't need to know how schnorr proofs and ECC works only what properties do they provide.  
If you want to know how they implemented under the hood check out prover implementations in Scala (ProvingInterpreter/Verifier types) or Rust (prover/verifier modules).

{Reactions}
üëç 

[09/20/2021 6:08 AM] kii#8888
noob question:
Why do we compare propositionBytes in ergoScripts?
OUTPUTS(0).propositionBytes == buyerPk.propBytes


[09/20/2021 7:06 AM] greenhat#6562
To check what script is guarding the box. In your example to check that  the first box in outputs can be spent by whoever knows secret key for buyerPk. 
Another often used technique will be to check if a box guarded by the same script that is currently executing ‚ÄòOUTPUTS(0).propositionBytes == SELF. propositonBytes‚Äò

{Reactions}
üëç (2) 

[09/20/2021 7:08 AM] kii#8888
That makes a lot of sense. Thank you!


[09/29/2021 12:45 PM] glasgowm#9381
https://twitter.com/ergoplatformorg/status/1443179492340609025

{Embed}
Alex Chepurnoy (@chepurnoy)
https://twitter.com/ergoplatformorg/status/1443179492340609025
New entry in Ergoscript-by-Example repository, payments with timing conditions https://t.co/2aLrEE5Uij
https://images-ext-1.discordapp.net/external/ddmIny7-FwRdLqObM_Nd1hNpMPjNhSAAl5nHeW7hBPM/%3Fformat%3Djpg%26name%3D600x314/https/pbs.twimg.com/card_img/1443179047106846721/G9ucVdDn
Twitter

{Reactions}
ergo_white (2) 

[09/30/2021 9:25 PM] kii#8888
What are the packages that I would need to import to scala's build.sbt to compile ergoscript?

I'm calling this:
  libraryDependencies += "org.ergoplatform" %% "ergo-scala-compiler" % "0.0.0-32-aaadbee1-SNAPSHOT",
from https://github.com/ergoplatform/ergo-scala-compiler

However I keep getting:
Error (BuildMessages(Vector(),Vector(BuildFailure(sbt task failed, see log for details)),Vector(),Vector(),Error))

Using Java 1.8 and Scala 2.13

Let me know if there's a better place to direct this question.

{Embed}
https://github.com/ergoplatform/ergo-scala-compiler
GitHub - ergoplatform/ergo-scala-compiler: ErgoScala to ErgoTree co...
ErgoScala to ErgoTree compiler. Contribute to ergoplatform/ergo-scala-compiler development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/wIEjiwdxIrymSG5ewHYPJHfO7S9-VhqcDvUQh4Wejfw/https/opengraph.githubassets.com/8cd96b10d507f28da20e68b12a2405449cda0bfb7ba7bd35b83af8c2cbaca8db/ergoplatform/ergo-scala-compiler


[10/01/2021 6:05 AM] greenhat#6562
ergo-scala-compiler is a proof-of-concept ErgoScala compiler. I believe https://github.com/ergoplatform/ergo-appkit is what you are looking for.

{Embed}
https://github.com/ergoplatform/ergo-appkit
GitHub - ergoplatform/ergo-appkit: Appkit: A Library for Polyglot D...
Appkit: A Library for Polyglot Development of Ergo Applications - GitHub - ergoplatform/ergo-appkit: Appkit: A Library for Polyglot Development of Ergo Applications
https://images-ext-1.discordapp.net/external/xninb3XYeMwD62KKZdXVtzbc9p2xkq2RRaTfHg1nJTU/https/opengraph.githubassets.com/0eddc708c91a8bb1f72e087906aecd50661ca9c16126fa9ee275616a8380f72e/ergoplatform/ergo-appkit


[10/01/2021 6:08 AM] kii#8888
Omg thank you so much. I‚Äôve been looking at the wrong direction the whole time!


[10/01/2021 9:17 AM] greenhat#6562
No worries. Our documentation is lacking. üôÇ


[10/09/2021 8:20 PM] glasgowm#9381
https://twitter.com/chepurnoy/status/1446918093247324164?t=pLgjIzO8PR3m8lnh_lIXTg&s=19

{Embed}
Alex Chepurnoy (@chepurnoy)
https://twitter.com/chepurnoy/status/1446918093247324164?t=pLgjIzO8PR3m8lnh_lIXTg&s=19
Another new entry in ErgoScript by Example, "Tokensale example" by code-for-uss https://t.co/2rSVcnLrEm
https://images-ext-2.discordapp.net/external/SOgBZ0l-vpnH0CQpBNHFZYFG9L9FcpBEUGhFWxVYKZA/%3Fformat%3Djpg%26name%3D600x314/https/pbs.twimg.com/card_img/1446918061722947593/eeY6DAuj
Twitter


[10/13/2021 7:18 PM] terrapin#5455
if a smart contract has a buyer who pays the seller, and the buyer never receives the goods. The contract can be built so that the buyer can get a refund of the money from the sellers account. But what if the seller moves all the funds to a different wallet before this happens? i might not be understanding smart contracts correctly, but can someone point me to some documentation or help me understand how this works? or maybe a better way to ask this is if there is a way for the contract to "own" the funds as an intermediary. and if all requirements are met, the funds are dispersed to the appropriate parties. from what i can tell, it doesnt seem like funds are actually held in the contract.


[10/13/2021 10:22 PM] kushti#0978
funds can be time-locked, and I guess if judgement on external event is needed, thus the contract needs for an escrow

{Reactions}
üëç 

[10/17/2021 8:33 AM] kii#8888
Hi, I'm trying to import ergo-playgrounds in scala so that I can run some tests. However, I'm having trouble importing it. This is my import file. I notice that ergo-platform only builds on scala version 2.12, not 2.13. Does playgrounds have something similar to this?

I'm getting this error when importing: Extracting structure failed, reason: not ok build status

```
name := "ergo-playground"

version := "0.1"

scalaVersion := "2.12.10"

resolvers ++= Seq("Sonatype Releases" at "https://oss.sonatype.org/content/repositories/releases/",
  "SonaType" at "https://oss.sonatype.org/content/groups/public",
  "Sonatype OSS Snapshots" at "https://oss.sonatype.org/content/repositories/snapshots")

libraryDependencies ++= Seq(
  "org.scalaj" %% "scalaj-http" % "2.4.2",
  "com.dripower" %% "play-circe" % "2712.0",
  "org.scalatestplus.play" %% "scalatestplus-play" % "5.0.0" % Test,
  "com.typesafe.play" %% "play-slick" % "4.0.0",
  "com.typesafe.play" %% "play-slick-evolutions" % "4.0.0",
  "org.ergoplatform" %% "ergo-appkit" % "develop-dd40e4e5-SNAPSHOT",
  "org.ergoplatform" %% "playgrounds" % "0.0.0-76-0fd15a64-SNAPSHOT",
  "org.scorexfoundation" %% "scrypto" % "2.1.10",
)

```


[10/17/2021 11:33 AM] greenhat#6562
Hey! Yes, 2.13 is not supported. Use `ergo-playground-env` instead of  `playgrounds`. I updated the latest snapshot version in the readme.


[10/17/2021 10:03 PM] kii#8888
That worked. Have you seen this error before though?
I'm trying to generate unspentboxes with that and its throwing that, even though its running fine in scastie.

I tried going into the source code. But i havent found anything useful

```
java.lang.NoSuchMethodError: org.ergoplatform.ErgoBox$.apply$default$5()Lscala/collection/immutable/Map;
    at org.ergoplatform.playgroundenv.models.DummyBlockchainSimulationImpl.generateUnspentBoxesFor(DummyBlockchainSimulationImpl.scala:90)
    at org.ergoplatform.playgroundenv.models.DummyPartyImpl.generateUnspentBoxes(DummyPartyImpl.scala:15)
```


[10/17/2021 10:07 PM] kii#8888
Also, are there code examples for where getVar[Int](1) is used. I read through the docs, but I dont fully get it.

I have a gist of what it does and what it means, but some code to see how it translates would be great for understanding how to utilize it


[10/18/2021 4:58 AM] zargarzadehmoein#2928
https://discord.com/channels/668903786361651200/840313005064585246/887282489687683082

Maybe this can help you


[10/18/2021 5:02 AM] kii#8888
sweett. will check it out


[10/18/2021 6:40 AM] greenhat#6562
Seems like a JDK issue. What's your JDK version? 11 and 1.8 should work fine.


[10/18/2021 6:41 AM] kii#8888
Seems like I'm using 1.8 already. Weird


[10/18/2021 6:46 AM] greenhat#6562
`NoSuchMethodError` usually signals some version conflict. Could you show your current build.sbt?


[10/18/2021 6:46 AM] kii#8888
sure

```
name := "ergo-playground"

version := "0.1"

scalaVersion := "2.12.10"

resolvers ++= Seq("Sonatype Releases" at "https://oss.sonatype.org/content/repositories/releases/",
  "SonaType" at "https://oss.sonatype.org/content/groups/public",
  "Sonatype OSS Snapshots" at "https://oss.sonatype.org/content/repositories/snapshots")

libraryDependencies ++= Seq(
  "org.scalaj" %% "scalaj-http" % "2.4.2",
  "com.dripower" %% "play-circe" % "2712.0",
  "org.scalatestplus.play" %% "scalatestplus-play" % "5.0.0" % Test,
  "com.typesafe.play" %% "play-slick" % "4.0.0",
  "com.typesafe.play" %% "play-slick-evolutions" % "4.0.0",
  "org.ergoplatform" %% "ergo-appkit" % "develop-dd40e4e5-SNAPSHOT",
  "org.ergoplatform" %% "ergo-playground-env" % "0.0.0-88-a781666a-SNAPSHOT",
  "org.scorexfoundation" %% "scrypto" % "2.1.10",
)

```


[10/18/2021 6:58 AM] greenhat#6562
@kii The only idea I have is that ergo-playground-env is using a too old version of ergo-appkit with old sigmastate-interpreter version. Can you try `"develop-d77acfb8-SNAPSHOT"` version of ergo-appkit?


[10/18/2021 7:00 AM] kii#8888
That gave a different error:

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/899537480066408478/error.rtf


[10/18/2021 7:01 AM] kii#8888
Is it recommended to use playground env only in scastie?


[10/18/2021 7:02 AM] kii#8888
It's weird cause ergo-appkit works but the playground which uses the appkit is showing errors. 

Do you use playground-env in your pc (outside of scastie)


[10/18/2021 7:03 AM] greenhat#6562
@kii Yes, I used playground-env on my pc no problem.


[10/18/2021 7:04 AM] kii#8888
interesting. Can you share your build.sbt?


[10/18/2021 7:06 AM] greenhat#6562
It was not a separate project(build.sbt). I used a `playgrounds` sub-project in https://github.com/ergoplatform/ergo-playgrounds/blob/d5d297df1d4369a94d0b95b3fa3ee1d856aa19c6/build.sbt#L55-L55

{Embed}
https://github.com/ergoplatform/ergo-playgrounds/blob/d5d297df1d4369a94d0b95b3fa3ee1d856aa19c6/build.sbt
ergo-playgrounds/build.sbt at d5d297df1d4369a94d0b95b3fa3ee1d856aa1...
Run contracts + off-chain code in the browser. Contribute to ergoplatform/ergo-playgrounds development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/-f9kDBaVEuLsjdzMqDDqXoYgQckXZtCg4SC9OHhVV-k/https/opengraph.githubassets.com/974775303777a50d5771513ac143679e6690cd0447daa952814e1623232122ef/ergoplatform/ergo-playgrounds


[10/18/2021 7:06 AM] kii#8888
oh as in pull the pr and then just use it right out of the box?


[10/18/2021 7:08 AM] greenhat#6562
@kii Yes, I developed examples like DEXPlayground this way - https://github.com/ergoplatform/ergo-playgrounds/blob/d5d297df1d4369a94d0b95b3fa3ee1d856aa19c6/playgrounds/src/main/scala/org/ergoplatform/playgrounds/examples/DEXPlayground.scala#L3-L3

{Embed}
https://github.com/ergoplatform/ergo-playgrounds/blob/d5d297df1d4369a94d0b95b3fa3ee1d856aa19c6/playgrounds/src/main/scala/org/ergoplatform/playgrounds/examples/DEXPlayground.scala
ergo-playgrounds/DEXPlayground.scala at d5d297df1d4369a94d0b95b3fa3...
Run contracts + off-chain code in the browser. Contribute to ergoplatform/ergo-playgrounds development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/-f9kDBaVEuLsjdzMqDDqXoYgQckXZtCg4SC9OHhVV-k/https/opengraph.githubassets.com/974775303777a50d5771513ac143679e6690cd0447daa952814e1623232122ef/ergoplatform/ergo-playgrounds


[10/18/2021 7:12 AM] kii#8888
oh that's cool. I'll just do that then. Is it recommended to write examples in here alongside the ergoscript example repo?


[10/18/2021 7:13 AM] kii#8888
Just pulled and ran the tests. Seems to work fine. 

There is this error that came up. But It doesnt seem anything crucial:

```
SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
```


[10/18/2021 7:14 AM] greenhat#6562
No, I think ergoscript example repo is enough.

{Reactions}
üëç 

[10/18/2021 7:16 AM] greenhat#6562
This error is even weirder. I'd suspect some conflict in scala/java version.


[10/18/2021 7:17 AM] kii#8888
I just checked the java version. Its 10. I'm changing to 1.8 and rerunning


[10/18/2021 7:18 AM] greenhat#6562
@kii There should be no problem using `ergo-playground-env` as a dependency in any project. In fact, Scastie is using it as a regular dependency.


[10/18/2021 7:18 AM] kii#8888
seems like problem is not solved


[10/18/2021 7:18 AM] kii#8888
Yeah, thats a good point. If Scastie is using it, it doesnt make sense for it to not work. Weird


[10/18/2021 7:19 AM] kii#8888
is it possible to check what version Scastie is using?


[10/18/2021 7:21 AM] greenhat#6562
Yep, check out Build Settings/Extra Sbt configuration on any Scastie project/url.


[10/18/2021 7:24 AM] kii#8888
using this as build.sbt works for playground:
```
lazy val sonatypePublic = "Sonatype Public" at "https://oss.sonatype.org/content/groups/public/"
lazy val sonatypeReleases = "Sonatype Releases" at "https://oss.sonatype.org/content/repositories/releases/"
lazy val sonatypeSnapshots = "Sonatype Snapshots" at "https://oss.sonatype.org/content/repositories/snapshots/"

resolvers ++= Seq(Resolver.mavenLocal, sonatypeReleases, sonatypeSnapshots, Resolver.mavenCentral)

scalacOptions ++= Seq(
  "-deprecation",
  "-encoding", "UTF-8",
  "-feature",
  "-unchecked"
)

libraryDependencies ++= Seq(
  "org.ergoplatform" %% "ergo-playground-env" % "0.0.0-65-c91117ae-SNAPSHOT"
  
)
```


[10/18/2021 7:27 AM] kii#8888
also, one last question for the night.

I saw this in advanced ErgoScript, and was wondering what it means?

```
        val bob = SELF.R5[SigmaProp].get
```

would it be a contract script in R5?


[10/18/2021 7:34 AM] greenhat#6562
Great! I'd suggest using newer version of ergo-playground-env though.


[10/18/2021 7:36 AM] greenhat#6562
No, it's not a contract it's a sigma proposition. Think of it as an expression consisting of AND/OR/public keys.


[10/18/2021 7:39 AM] kii#8888
Agree. However if its breaking :X haha.


[10/18/2021 7:40 AM] kii#8888
Could you give an example if you dont mind. It should explain a lot more.


[10/18/2021 7:41 AM] kii#8888
Thanks for your time. I just got into ergo about 3 weeks or a month now. Still working hard on understanding everything

{Reactions}
ergo_orange 

[10/18/2021 7:42 AM] greenhat#6562
No problem, I'm happy to help!


[10/20/2021 4:51 AM] sandz#8082
@greenhat Hi, What would you recommend to use instead of "atLeast" for sigmaProps? i tried using "&&" and "||" instead of "atLeast" but my script becomes too long.


[10/20/2021 6:31 AM] greenhat#6562
Unfortunately, only re-construct it with AND/OR but it leads to explosion pretty quickly as you probably already saw.


[10/20/2021 6:41 AM] greenhat#6562
Sorry, I missed it. Here is a contract `HEIGHT > 1000 && (pubKeyBob || pubKeyAlice)`. When the contract gets reduced to a sigma proposition (evaluated by the interpreter) if HEIGHT is greater than 1000 the result would be `pubKeyBob || pubKeyAlice` and then the prover will generate a proof for OR operation of these sigma propositions. If HEIGHT is not greater than 1000 the whole contract evaluates to false. 
Now, `SELF.R5[SigmaProp]` gives you the sigma proposition as an external parameter to your contract.


[10/20/2021 6:42 AM] sandz#8082
Yes, thank you


[10/20/2021 6:46 AM] kii#8888
Wao. That is super cool!


[10/20/2021 8:12 AM] kii#8888
Hi, i wrote a sigma script where the script goes
```
pkAandpkBScript = s"""sigmaProp(pkA && pkB)"""

// where
val pkContract = ErgoScriptCompiler.compile(
  Map("pkA" -> pkA.wallet.getAddress.pubKey,
    "pkB" -> pkB.wallet.getAddress.pubKey),
  pkAandpKBScript)
```

Normally if it's one user, i would sign it like this
```
val pkOutputBox = Box(
   value = pkFunds - 2 * MinTxFee,
   script = 
  contract(party.wallet.getAddress.pubKey))

val pkWithdrawTx = Transaction(
   inputs = List(txSigned.outputs(0)),
   outputs = List(pkOutputBox),
   fee = MinTxFee,
   sendChangeTo = party.wallet.getAddress
)

// I assume that in this part, both wallet has to sign. But how do both sign simultaneously?
val pkWithdrawTxSigned = 
      party.wallet.sign(pkWithdrawTx)
```

Question in comments.


[10/20/2021 8:16 AM] greenhat#6562
Great question! We have distributed signatures for this case. Check out this example - https://github.com/ScorexFoundation/sigmastate-interpreter/blob/311407568589767b2fa0150fda836a6bc768eebc/sigmastate/src/test/scala/sigmastate/utxo/DistributedSigSpecification.scala#L8-L8

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/311407568589767b2fa0150fda836a6bc768eebc/sigmastate/src/test/scala/sigmastate/utxo/DistributedSigSpecification.scala
sigmastate-interpreter/DistributedSigSpecification.scala at 3114075...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/DistributedSigSpecification.scala at 311407568589767b2fa0150fda836a6bc768eebc ¬∑ ScorexFounda...


[10/20/2021 8:17 AM] kii#8888
Sweet. I'll go through it


[10/20/2021 8:25 AM] kii#8888
I went through it and it seems like it uses HintsBag and the party can call a method called GenerateCommitments or get its commitments. and then prove it. 

the compounded proof is then correct. 

Is the Party in playgroundenv limited and does not have those functions in its class? And therefore that case can't be simulated in playgroundenv?


[10/20/2021 8:27 AM] greenhat#6562
Yes, you're right. There is no support of distributed signatures in ergo-playground yet.


[10/20/2021 8:30 AM] kii#8888
Okay. That makes sense. yet is a good finish. üôÇ


[10/21/2021 3:10 AM] kii#8888
hi, i came across this error
```
Don't know how to convert RType GeneralType(org.ergoplatform.ErgoBox) to SType
```

What are does this mean? Seems like it has to do with types?


[10/21/2021 3:11 AM] kii#8888
this is my script:
```
    val twoBoxesTogetherScript =
      s"""
         | {
         |    // The items within INPUTS collection will run against
         |    // this lambda function to find if the inputBox exists.
         |    def isFriendBox = { (inputBox: Box) => inputBox.id == friendBox.id }
         |    val isFriendBoxExists = INPUTS.exists(isFriendBox)
         |    sigmaProp(isFriendBoxExists)
         | }
         |""".stripMargin


    val blockchainSimulation = newBlockChainSimulationScenario("ErgoScript 2.3.a: Two Boxes Together Example")
    val pkFriend = blockchainSimulation.newParty("person-friend")
    val pkA = blockchainSimulation.newParty("person-A")
    generateAndPrintUnspent(pkFriend, pkFunds)
    generateAndPrintUnspent(pkA, pkFunds)
    printBorder("-------------------------")

    val friendContract = ErgoScriptCompiler.compile(Map(
      "pkFriend" -> pkFriend.wallet.getAddress.pubKey
    ), s"""sigmaProp(pkFriend)""")
```


[10/21/2021 7:29 AM] greenhat#6562
That's weird. @morphic any ideas?


[10/21/2021 2:14 PM] morphic#4133
@kii what is `friendBox` in the script?


[10/21/2021 5:42 PM] kii#8888


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/900786156143276073/TwoBoxesTogether.scala


[10/21/2021 5:42 PM] kii#8888
Here's the code i written


[10/22/2021 2:37 PM] morphic#4133
Do you have a full stack trace for the Exception?


[10/22/2021 5:16 PM] kii#8888
I can get it later


[10/23/2021 11:07 AM] sandz#8082
@greenhat Hi, i want to deserilize ergotree to sigma-protocol node. could you give me a document or something that i can understand how this serilization happend?


[10/23/2021 11:37 AM] greenhat#6562
I'm not sure I get it. Deserialization is parsing ErgoTree from bytes. Sigma protocol happens after ErgoTree is evaluated/reduced to sigma propositions (tree of OR/AND/ATLEAST props). If you want to understand how ErgoTree is parsed from bytes https://ergoplatform.org/docs/ErgoTree.pdf is a good start and then dive into the code (`impl SigmaSerializable for Expr`). If you want to know how ErgoTree is evaluated/reduced to sigma propositions the source code (`impl Evaluable for Expr`) is probably the best place to start.


[10/23/2021 2:50 PM] sandz#8082
Thanks, in fact i have a contract that should be signed by multiple person. i need to sign the transaction without revealing the secret of signers. i don't see any option in prover that allow me to sign transaction step by step. and after reading appendix of whitePaper2 i understand how the signing procedure works and it makes sense to me why there is no such option in prover. so i decided to make change in prover that do what i told. Could you please correct me if i wrong about what i understand from prover and the statement above?


[10/23/2021 2:54 PM] greenhat#6562
I think distributed signatures are what you're looking for. Check out this example https://github.com/ScorexFoundation/sigmastate-interpreter/blob/311407568589767b2fa0150fda836a6bc768eebc/sigmastate/src/test/scala/sigmastate/utxo/DistributedSigSpecification.scala#L8-L8

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/311407568589767b2fa0150fda836a6bc768eebc/sigmastate/src/test/scala/sigmastate/utxo/DistributedSigSpecification.scala
sigmastate-interpreter/DistributedSigSpecification.scala at 3114075...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/DistributedSigSpecification.scala at 311407568589767b2fa0150fda836a6bc768eebc ¬∑ ScorexFounda...
https://images-ext-1.discordapp.net/external/DHh-P8_wAjbs4ncUXKXY3oTDpSEx1iPDQ7zvsqMkKGw/https/opengraph.githubassets.com/1484f73156a36796ca20d31a034787ddbf7697450396a26c2dad37d8f237bde7/ScorexFoundation/sigmastate-interpreter


[10/23/2021 2:59 PM] sandz#8082
Wow thank you, does sigma-rust supports this feature or should be implemented?


[10/23/2021 3:03 PM] greenhat#6562
Not yet. But it's the first item on our roadmap.


[10/24/2021 10:14 AM] kii#8888
@greenhat random statement. but thats a cool profile pic

{Reactions}
üòä (2) 

[10/25/2021 3:12 PM] kushti#0978
the node also has support for distributed signatures


[10/25/2021 9:35 PM] sandz#8082
i went throw node apis i can only found  /wallet/generateCommitments for generating commitment for signers but i can't find any end point that i can use to generate challenge and response for  the signers. could you help me with that?


[10/26/2021 8:03 AM] kii#8888
Hi sorry it took me awhile. here's the stack trace.

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/902452283646832700/RSBoxError.txt


[10/26/2021 9:09 AM] kushti#0978
https://www.ergoforum.org/t/improved-distributed-signatures/366

{Embed}
https://www.ergoforum.org/t/improved-distributed-signatures/366
Improved distributed signatures
Initial implementation of distributed signatures support in the node worked well in simple cases, and ZK Treasury built on top of it. However, in complex cases it has some problems:   hints generated (such as commitments) were not tied to a position of a sub-expression in a sigma-expression. For example, for statement like ‚ÄúatLeast(2, Coll(pkAli...

{Reactions}
üëç 

[10/31/2021 8:29 PM] kii#8888
@morphic ping


[11/01/2021 12:10 PM] morphic#4133
The problem is in this method https://github.com/ScorexFoundation/sigmastate-interpreter/blob/fb71404fe300313553badb84fe2b34d0a2cb5ea5/sigmastate/src/main/scala/sigmastate/lang/SigmaBinder.scala#L41 
More specifically, the env.get(n) method cannot resolve the variable name. 
The variables are provide to the compile method, like the Map(
      "friendBox" -> friendBoxOutput
    )
in your script. 
So, the problem may be that, you have some variable in scripts which is neigher declared not provided to the compile method.

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/fb71404fe300313553badb84fe2b34d0a2cb5ea5/sigmastate/src/main/scala/sigmastate/lang/SigmaBinder.scala
sigmastate-interpreter/SigmaBinder.scala at fb71404fe300313553badb8...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/SigmaBinder.scala at fb71404fe300313553badb84fe2b34d0a2cb5ea5 ¬∑ ScorexFoundation/sigmastate-...
https://images-ext-1.discordapp.net/external/WH_FGQ9ChBI_-zpvFF7A7xCC5m2uRxSXBc-f4BzNZ2o/https/opengraph.githubassets.com/55ffb326779e212354605281f894cbf18091f2ad81f5c19480d2795abb42e48c/ScorexFoundation/sigmastate-interpreter


[11/01/2021 12:12 PM] morphic#4133
Or there  may be another reason, but I don't know how exactly ErgoScriptCompiler is implemented.


[11/01/2021 12:13 PM] morphic#4133
So, I would start with checking the variable names to make sure they are all either declared or provided to the compile method.


[11/02/2021 4:00 AM] Marty#4039
I am just beginning to learn ergoscript so apologies if this is a stupid question. In this example https://github.com/ergoplatform/ergoscript-by-example/blob/main/simpleSend.md, Box has a script value. In Ergoscript Language description (https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md), Box type does not have "script" in the list of methods. Is there a list that describes more than what's found in LangSpec.md? Am i thinking about this the wrong way?


[11/02/2021 4:02 AM] Marty#4039
I am wondering if ErgoScriptCompiler is the answer, that it's creating a guard script in the form of propositionBytes?


[11/02/2021 4:45 AM] Marty#4039
Another question: in examples, it often refers to another box in the simulator by name, ie: `inputs       = List(timedFundTransactionSigned.outputs(0))`, in a real use case, would you use the txID or something like that here in place of `timedFundTransactionSigned`


[11/02/2021 7:47 AM] greenhat#6562
ErgoBox.propositionBytes is compiled script (written in ErgoScript).


[11/02/2021 7:49 AM] greenhat#6562
Yes, you'd find a transaction by it's id and then get the box from it's outputs.


[11/02/2021 12:32 PM] Marty#4039
Lovely, thank you!


[11/08/2021 9:11 PM] Marty#4039
I have a theoretical question that might be just a lack of understanding... 

If I made a staking smart contract that has access to a token created and held by a P2S address, what's stopping someone from copying the smart contract and changing the output? 

Like if I made the contract use a configNFT that determines it will issue 5% tokens to stakers per year, could someone just copy that smart contract and point it at a new configNFT of their choosing, and issue themselves 100% of the tokens?


[11/08/2021 11:19 PM] Marty#4039
Or is it protected the other direction by the token holding address?


[11/09/2021 7:36 AM] greenhat#6562
I'm not sure I understand the question. Could you share the smart contracts involved?


[11/09/2021 11:16 PM] Marty#4039
I'm probably thinking too hypothetically. I'll do more research first and reframe the question


[11/12/2021 9:20 PM] Marty#4039
Are they any examples of a token transfer tax? One use case would be artist commission on sale of an NFT


[11/12/2021 10:47 PM] Pulsarz#9208
doesn't the AH already have this? royalties


[11/12/2021 10:48 PM] Marty#4039
i didn't know that, i'll check it out


[11/12/2021 11:00 PM] Marty#4039
i think it's just a datapoint added in R4 that the auction house honors on future auctions


[11/12/2021 11:32 PM] Pulsarz#9208
oh :disgusted:


[11/16/2021 7:52 PM] Deleted User#0000
Have been trying to break apart the script presented in:            https://github.com/ergoplatform/ergoscript-by-example/blob/main/selfReplicatingTokenSale.md

{Embed}
https://github.com/ergoplatform/ergoscript-by-example/blob/main/selfReplicatingTokenSale.md
ergoscript-by-example/selfReplicatingTokenSale.md at main ¬∑ ergopla...
Learn ErgoScript by reading example smart contracts powered by Ergo Playground. - ergoscript-by-example/selfReplicatingTokenSale.md at main ¬∑ ergoplatform/ergoscript-by-example
https://images-ext-1.discordapp.net/external/CEqfaHtEgwaRm9bjZj7MRm_1zAX7bJh3tMgQ3asjUqg/https/opengraph.githubassets.com/302a4e4a1171c01c4a7f65bcd9b987245cf48d17dd505a6f3e83e6ef93f702ac/ergoplatform/ergoscript-by-example


[11/16/2021 7:53 PM] Deleted User#0000
As i am trying to grasp my mind around it i have been ordening my understanding in the following Scatsie link: https://scastie.scala-lang.org/w7Gt07vOTPWDSZJJelHPSQ

{Embed}
https://scastie.scala-lang.org/w7Gt07vOTPWDSZJJelHPSQ
Scastie - An interactive playground for Scala.
//Guess i am going to need these to play with the code.

//perhaps someone can explain me why line 4 and 6 need a underscore at the end? And why it can't load line 4?
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
import org.ergoplatform.Erg...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[11/16/2021 7:55 PM] Deleted User#0000
If someone is willing could you check if my understanding of lines 52 towards 78 is correct. The biggest question i still got is the propositionBytes what it exactly does and the token(0)._1 and 2

{Reactions}
üíØ 

[11/16/2021 7:55 PM] Deleted User#0000
What exactly does the 0 stand for and the 1 and 2?


[11/17/2021 12:47 AM] Leif Erickson#8939
@Deleted User  I'm interested in this conversation also, but not sure I can answer your questions currently, myself. Are you just playing around or trying to implement the ergoscript somehow?


[11/17/2021 7:40 AM] Deleted User#0000
Trying to make it work. But I start at the beginning to see how it works first. üòÑ


[11/17/2021 7:46 AM] Leif Erickson#8939
Excellent! That's how I started and I can do many things now, but other things I just haven't gotten around to...and some amazing Devs here as well!


[11/17/2021 7:46 AM] Leif Erickson#8939
Have you setup a node yet?


[11/17/2021 8:09 AM] greenhat#6562
propositonBytes is a serialized ErgoTree (contract/scripts that guards the box). In your line it checks that the first output box's contract is just a public key of seller, i. e. only a seller can spend it. 
tokens(0) is accessing the first token in the box. Token is stored as a tuple(pair) where _1 is token id and _2 is token amount.


[11/17/2021 12:14 PM] Deleted User#0000
i haven't yet. But thats on my to do list for this week at least


[11/17/2021 12:14 PM] Deleted User#0000
thank you! that clears alot up for me

{Reactions}
üôå 

[11/17/2021 8:54 PM] Marty#4039
Can outputs be delayed? IE you make a script that sells Token-A for Erg, but when someone buys Token-A, you don't want the contract to give it all at once. So 50% sent now, 50% sent in one month. Is this possible with ergoscript?


[11/18/2021 1:20 AM] JOFLITO#9983
yes


[11/18/2021 1:20 AM] JOFLITO#9983
https://github.com/ergoplatform/ergoscript-by-example/blob/main/timedFund.md

{Embed}
https://github.com/ergoplatform/ergoscript-by-example/blob/main/timedFund.md
ergoscript-by-example/timedFund.md at main ¬∑ ergoplatform/ergoscrip...
Learn ErgoScript by reading example smart contracts powered by Ergo Playground. - ergoscript-by-example/timedFund.md at main ¬∑ ergoplatform/ergoscript-by-example
https://images-ext-1.discordapp.net/external/CEqfaHtEgwaRm9bjZj7MRm_1zAX7bJh3tMgQ3asjUqg/https/opengraph.githubassets.com/302a4e4a1171c01c4a7f65bcd9b987245cf48d17dd505a6f3e83e6ef93f702ac/ergoplatform/ergoscript-by-example


[11/18/2021 1:20 AM] JOFLITO#9983
that one has it


[11/18/2021 1:21 AM] JOFLITO#9983
and this one too


[11/18/2021 1:21 AM] JOFLITO#9983
https://github.com/ergoplatform/ergoscript-by-example/blob/main/headsOrTails.md

{Embed}
https://github.com/ergoplatform/ergoscript-by-example/blob/main/headsOrTails.md
ergoscript-by-example/headsOrTails.md at main ¬∑ ergoplatform/ergosc...
Learn ErgoScript by reading example smart contracts powered by Ergo Playground. - ergoscript-by-example/headsOrTails.md at main ¬∑ ergoplatform/ergoscript-by-example
https://images-ext-1.discordapp.net/external/CEqfaHtEgwaRm9bjZj7MRm_1zAX7bJh3tMgQ3asjUqg/https/opengraph.githubassets.com/302a4e4a1171c01c4a7f65bcd9b987245cf48d17dd505a6f3e83e6ef93f702ac/ergoplatform/ergoscript-by-example


[11/18/2021 1:21 AM] JOFLITO#9983
you use block height as your "timer" maybe on the future we have a UTC timer oracle


[11/18/2021 1:33 AM] Houseofcoin#4645
I have silly noob question here: if the eutxo model moves your entire wallet balance in exchange for a token/(sigrsv for example with ergodex swap) how is it possible for multiple transactions with a single wallet?


[11/18/2021 5:58 PM] Marty#4039
The thing is, you have to send a second transaction after the time has expired. Can you trigger a timed event to happen automatically after a certain time?


[11/18/2021 5:59 PM] Marty#4039
You intend to send multiple simultaneous transactions?


[11/19/2021 6:44 PM] FF#4320
Hi, I am searching but still couldn't find it, how can you after coding a ergoscript, add a ui to it, meaning interact with the smart contract for user interface.


[11/19/2021 6:46 PM] FF#4320
How to add GUI to smart contract basically.


[11/19/2021 6:53 PM] glasgowm#9381
http://docs.ergoplatform.org/dev/stack/front-end/


[11/19/2021 7:04 PM] FF#4320
Thank you but with it came another question, probably I just didn't read it yet, but.
I need to either use sigma-rust or ergo-ts to interact with the smart contract?
Another question I probably will know when looking deeper into the files, how to deploy ergoscript smart contract?
Do I do it on ergo playground?


[11/20/2021 8:22 PM] FF#4320
I think I found the answer can someone say if I'm right or no?
In order to interact with ergo smart contract I need to use Ergo Headless dApp Framwork right?


[11/20/2021 8:46 PM] glasgowm#9381
Missed your last q sorry, you can use the headless dApp framework, appkit, or the jde.


[11/20/2021 8:47 PM] FF#4320
No problems I said it I was going to find it when I looked deeper :D.
Just wanted to confirmed it, to be sure.
Thank you!


[11/20/2021 8:49 PM] glasgowm#9381
http://docs.ergoplatform.org/dev/stack/front-end/


[11/20/2021 8:50 PM] glasgowm#9381
And http://docs.ergoplatform.org/dev/stack/back-end/


[11/20/2021 8:52 PM] glasgowm#9381
Appkit by example video is maybe the best place to start - also an tutorial


[11/20/2021 8:53 PM] glasgowm#9381
Added more here today too - http://docs.ergoplatform.org/dev/scs/ergoscript/


[11/20/2021 8:53 PM] FF#4320
Actually did not found it there, because I though the back-end of the dApp was the smart contract, and this back-end option was to add other functionality, like to preform a certain action given the smart contract interaction, like an oracle but diferent.


[11/20/2021 8:53 PM] FF#4320
Will see all!!
Thank you so much man!


[11/20/2021 8:57 PM] glasgowm#9381
Easy mistake to make. Need more graphics :)

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/911721850265018398/Screenshot_2021-11-20-20-56-43-956_com.mi.globalbrowser.jpg


[11/20/2021 9:09 PM] FF#4320
I saw that, but because it said off-chain logic I though it was oracle like as I describe it earlier.


[11/20/2021 9:10 PM] FF#4320
Its because I'm knew.


[11/20/2021 9:11 PM] FF#4320
@glasgowm Btw are you a lead developer? Or just someone who understand the ecosystem and how to use it?


[11/20/2021 9:11 PM] FF#4320
and know how to use it*


[11/20/2021 10:12 PM] glasgowm#9381
Part of the team and a developer, dunno about lead ^^ just going through it myself


[11/20/2021 10:12 PM] glasgowm#9381
https://www.reddit.com/r/ergonauts/comments/qyczj4/announcing_ergolearn_come_learn_the_beginnings_of/

{Embed}
https://www.reddit.com/r/ergonauts/comments/qyczj4/announcing_ergolearn_come_learn_the_beginnings_of/
r/ergonauts - Announcing ErgoLearn!! Come learn the beginnings of y...
49 votes and 18 comments so far on Reddit
https://images-ext-2.discordapp.net/external/tWKTwDD9H8Q_IMssW9C-hUWg7Ois2NcKnlnREnr4wE8/%3Fauto%3Dwebp%26s%3D182ef2c79c48f1eb9fd0accc883a59248a6658d4/https/external-preview.redd.it/0T9xa4b0vQXd-3p3nbHrtyW5wBPzXzCau33x59UPV-Y.jpg


[11/21/2021 2:04 PM] FF#4320
@glasgowm Hi again, not to be annoying, so, if I understood correctly, I write the smart contract in ergo-script, then compile it into P2S, and then follow the ergo-headless-dapp-framework and on point 3 instead of making cli, I compile the existing rust code into WASM. 
Right?
Or do I am I missing something? (Never worked with web assembly so maybe I am missing something)


[11/21/2021 2:15 PM] glasgowm#9381
maybe @greenhat can confirm I'm not familiar with the rust side yet.


[11/21/2021 2:22 PM] greenhat#6562
You don't necessarily need ergo-h-d-f. It's a high-level lib. If you targeting Wasm keep in mind that ergo-lib in sigma-rust repo is the core lib. ergo-h-d-f uses it under the hood.


[11/21/2021 6:22 PM] FF#4320
I could only understand it (if I understood it), that you use the ergo-h-d-f, and then add #[wasm_bindgen] to it.
Could not find a way on ergo-lib in sigma-rust.


[11/21/2021 6:24 PM] FF#4320
as in box spec


[11/21/2021 6:24 PM] FF#4320
https://github.com/ergoplatform/ergo-headless-dapp-framework

{Embed}
https://github.com/ergoplatform/ergo-headless-dapp-framework
GitHub - ergoplatform/ergo-headless-dapp-framework: An easy to use ...
An easy to use framework for building Ergo headless dApps. Developed by EMURGO and Ergo Platform. - GitHub - ergoplatform/ergo-headless-dapp-framework: An easy to use framework for building Ergo he...
https://images-ext-1.discordapp.net/external/b9SSqrm4V_hqD4gPZkFr4vl06wbX2adU5UqTUL-CU4Y/https/opengraph.githubassets.com/a59be63f07bab48c2bcf8f6f25ddc3bf6fb7a4ece8844d85ac1d2871f0926c1a/ergoplatform/ergo-headless-dapp-framework


[11/21/2021 6:27 PM] FF#4320
Then preform was-pack to it.
Am I right?
Does it work?


[11/21/2021 9:01 PM] FF#4320
does someone know?


[11/22/2021 5:00 AM] greenhat#6562
@FF I'm not sure what are you planning to do. ergo-hdf already has Wasm bindings. You could write your code in Rust and then add Wasm bindings.


[11/22/2021 10:50 AM] FF#4320
I'm just confuse, sorry to bother.
Just trying to find a way to make dapp on top of ergo smart contract, thats all.


[11/22/2021 10:55 AM] greenhat#6562
No worries. I suggest you look at the existing dapps for examples. Like sigmausd.io - https://github.com/anon-real/sigma-usd

{Embed}
https://github.com/anon-real/sigma-usd
GitHub - anon-real/sigma-usd: UI for SigmaUSD instance of AgeUSD pr...
UI for SigmaUSD instance of AgeUSD protocol. Contribute to anon-real/sigma-usd development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/3Bmtk96JugCtUoJLVFr1C4v797jgoS54tPkDQR-DhmQ/https/opengraph.githubassets.com/1a58713464fe86e6b20b4d472d68a9a37d6b4a0f64fb44295f166ebce5ad188e/anon-real/sigma-usd


[11/23/2021 9:41 AM] lgd#5847
I wasn't sure where to post this, but this channel seems to make sense. Idk if anyone has ever used draw.io before to make diagrams for stuff (flowcharts,  UML, etc.)? The name has changed to diagrams.net. I have used this website myself for personal and school projects. 

I'm not smart enough to actually implement tooling for FlowCards but wanted a way to convert sketches into diagrams for documentation.

I had some free time and made a FlowCards component library for diagrams.net that can be easily imported into the website, all the info can be found here: https://github.com/lucagdangelo/flowcardLib

I wanted to share but not sure if anyone will actually find it useful.

{Embed}
https://github.com/lucagdangelo/flowcardLib
GitHub - lucagdangelo/flowcardLib: Ergo FlowCard library for diagra...
Ergo FlowCard library for diagrams.net. Contribute to lucagdangelo/flowcardLib development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/gg2hiCEOSqa4-kOr0W24oaIe41pTWG3WLpQiVFUJygU/https/opengraph.githubassets.com/2e4a296b67d91b89dc56ada21698ac568aa974aa433eab4491c275e0507a8810/lucagdangelo/flowcardLib

{Reactions}
üëç (3) 

[11/23/2021 10:16 AM] Ergo Tipper Bot[BETA]#0902
@glasgowm sent a tip of 2 erg to @lgd: nice one!!

{Reactions}
üëÄ 

[11/23/2021 11:18 AM] morphic#4133
Awesome! It is much easier to draw FlowCards in diagrams.net then in PowerPoint (which I originally used). Consider adding link here https://github.com/ergoplatform/awesome-ergo/blob/master/pages/docs.md


[11/23/2021 12:53 PM] lgd#5847
do i just create a pull request? or maybe someone wants to use it and see if it's any good before doing that?


[11/23/2021 1:01 PM] morphic#4133
yes, please create a PR

{Reactions}
üëç 

[11/23/2021 2:09 PM] lgd#5847
done

{Reactions}
üëç (2) 

[11/24/2021 4:39 PM] kushti#0978
there are no automated alarm clocks on the blockchains


[11/24/2021 4:43 PM] HazeyOneKenobi#2091
Usually how this is done on other chains is by 'locking' the 50% you want to emit later in another smart contract, which the buyer can retrieve themselves after the specified block height is reached


[11/24/2021 4:46 PM] HazeyOneKenobi#2091
If a box was created where proposition was signing proof & a block height which must be passed, would the owner of the box need to 'retrieve' contents via another tx, or would the box simply be included under the wallet utxo's and be allowed to be spent when the proposition can evaluate to true?


[11/24/2021 4:46 PM] HazeyOneKenobi#2091
Forgive my very basic understanding of propositions and contracts


[11/24/2021 5:14 PM] Marty#4039
That's an interesting question if it alleviates the need for the user to manually send the second transaction for retrieval


[11/24/2021 10:26 PM] kushti#0978
Sounds like a contract which demands for 2 outputs from spending transaction: one is available right now, another is time-locked (HEIGHT >= current + one+month && PK)


[11/24/2021 11:09 PM] Marty#4039
That makes sense. For the timelocked one though, the user will have to send another box to get it out, correct?


[11/25/2021 5:26 AM] greenhat#6562
Although it's theoretically possible, I don't think we have such wallets yet. So, yes, you need to 'retrieve' the contents with another tx.


[11/25/2021 2:07 PM] Marty#4039
With a good UI it's not too big of a deal..can even include a countdown timer for the user, with a "retrieve funds" button or something. I'll keep that in mind though that the wallet software could potentially support timed payments in the future


[11/26/2021 8:20 PM] HeckLeif#7569
Hey guys! Im very interested in learning some things about developing ErgoScripts. My background is in solidity smart contracts/yet due to my exposure with Plutus I comprehend eUTxO, anyone know of good resources to get started in the ErgoScript space?


[11/26/2021 9:00 PM] soysor#6001
http://docs.ergoplatform.org/dev/scs/ergoscript/ & the pinned message in this channel

{Reactions}
üëç 

[11/27/2021 5:41 AM] JOFLITO#9983
Hey guys, I am trying to make a token locking contract. I am running into a problem, it seems my test tx isn't valid and it throws an error on line 160 https://scastie.scala-lang.org/wlBLmq9CR2mG9g2S0xS0aQ is there any way to debug this? I would like to  have a line like " println(OUTPUTS(0).tokens(0)._1)"  or "println(whatToken)"

{Embed}
https://scastie.scala-lang.org/wlBLmq9CR2mG9g2S0xS0aQ
Scastie - An interactive playground for Scala.
//this code is based on Luivatra‚Äôs code for a self replicating contract
// https://github.com/ergoplatform/ergoscript-by-example/blob/main/selfReplicatingTokenSale.md
//remember kids, it is not plagiarism if you provide the source
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[11/27/2021 5:42 AM] JOFLITO#9983
any input suggestion is highly welcomed


[11/27/2021 6:21 AM] greenhat#6562
Unfortunately, there is nothing similar to debug print in ErgoScript. Try commenting out parts of the script to find what expression causes false.


[11/27/2021 12:04 PM] JOFLITO#9983
thanks! that's a good idea


[11/27/2021 12:12 PM] Ergo Tipper Bot[BETA]#0902
@JOFLITO sent a tip of 10 thisguyfucks to @greenhat!


[11/27/2021 12:32 PM] JOFLITO#9983
It worked! https://scastie.scala-lang.org/Y6XjYubbR36h4UIXeZkGJA I wasn't checking the correct box on the last condition!

{Embed}
https://scastie.scala-lang.org/Y6XjYubbR36h4UIXeZkGJA
Scastie - An interactive playground for Scala.
//this code is based on Luivatra‚Äôs code for a self replicating contract
// https://github.com/ergoplatform/ergoscript-by-example/blob/main/selfReplicatingTokenSale.md
//remember kids, it is not plagiarism if you provide the source
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[11/27/2021 12:33 PM] JOFLITO#9983
How do I go so people can check my contract and prevents it from having vulnerabilities, or in fact doing what I tell them it does?


[11/28/2021 12:48 AM] JOFLITO#9983
just fixed a little breach, now it check the token being stored on each box

{Reactions}
ergo_orange (2) üëçüèª 

[12/05/2021 3:19 PM] Crypto Cream#4657
In ErgoPlayground is there something to catch assertion errors? so you can do something like ` try x.wallet.sign(Transaction) if assertion failed do x`


[12/05/2021 4:39 PM] Crypto Cream#4657
actually, whats the different between `assertion failed` and `Script reduced to false` ?


[12/06/2021 7:34 AM] greenhat#6562
https://docs.scala-lang.org/overviews/scala-book/try-catch-finally.html should do the job

{Embed}
https://docs.scala-lang.org/overviews/scala-book/try-catch-finally.html
try/catch/finally Expressions
This page shows how to use Scala's try/catch/finally construct, including several complete examples.
https://images-ext-2.discordapp.net/external/NimeBpuQwVZP68LG6VcPgxr_MFcLZ9m_oh3uR_FPyS8/https/docs.scala-lang.org/resources/img/scala-spiral-3d-2-toned-down.png

{Reactions}
üëç 

[12/06/2021 7:37 AM] greenhat#6562
I'm not sure what do you mean by assertion. Assuming it's an exception in Scala layer it differs from `script reduced to false` which is the result (undesirable) of running the ErgoScript.


[12/06/2021 2:48 PM] Crypto Cream#4657
an example of `assertion failed`: https://scastie.scala-lang.org/6UO3nqOlR7ulCB6flPSeTQ - i was trying to test the withdrawing early from the contract


[12/06/2021 4:07 PM] greenhat#6562
I don't see any `assertion failed`


[12/06/2021 4:43 PM] Crypto Cream#4657
if you scroll up slightly after running it's a message:

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/917456346973093898/unknown.png


[12/06/2021 5:15 PM] greenhat#6562
Oh, I see. Did you try Scala's try/catch?


[12/06/2021 9:12 PM] Crypto Cream#4657
not yet, will let you know.  For this I was just confused why it was showing this, as the test was aiming to fail the contract


[12/07/2021 11:17 PM] Krasavice Blasen#4574
I see it is common for scripts to contain:```OUTPUTS(0).tokens(0)._1 == token1```


[12/07/2021 11:18 PM] Krasavice Blasen#4574
But when I hard code the tokenid into the contract, like: ```OUTPUTS(0).tokens(0)._1 == "fbbaac7337d051c10fc3da0ccb864f4d32d40027551e1c3ea3ce361f39b91e40"```


[12/07/2021 11:18 PM] Krasavice Blasen#4574
It does not compile


[12/07/2021 11:19 PM] Krasavice Blasen#4574
is token1 not a tokenid?


[12/08/2021 2:13 AM] Krasavice Blasen#4574
The issue was I needed to convert the id to base58 and use frombase58

{Reactions}
üëç (3) 

[12/09/2021 7:46 PM] Leif Erickson#8939
I've seen locking by HEIGHT, but is it reasonable to lock using a register and  a future time? `sigmaProp(OUTPUTS(0).R4[Long].getOrElse(0L) >= [unixTimeGoesHere]` or something like this? For longer time-frames the height seems less predictable


[12/09/2021 8:05 PM] kushti#0978
but what prevents from constructing such an output before the time then ?


[12/09/2021 8:07 PM] Leif Erickson#8939
Right! That's my issue I guess. How can I reliably compare current time to contact limit?


[12/09/2021 8:59 PM] kushti#0978
you can use time from block header, @anon_real is doing that in AH2 contracts

{Reactions}
üíØ (2) 

[12/10/2021 8:21 PM] Leif Erickson#8939
I have seen the PK function used on its own.  If I have an ergoscript that is locking a box, something like `PK(wallet) && HEIGHT > 500000` will this unlock after the height only for that wallet? Or should I be comparing the wallet value from INPUTS to FromBase64(wallet)?  I saw the PK function used in an ergo-by-example and wasn't sure how it was validating.


[12/10/2021 8:23 PM] Leif Erickson#8939
@anon_real is the AHv2 code in the same GitHub repo as V1 ... I looked around a bit, and from the docs I see the timestamp kushti is referring to, but hoping seeing your code and something that is already working will save me a little time messing around with it and to validate.


[12/10/2021 10:00 PM] anon_real#2768
The contracts themselves are not in the code. The ergo tree is.
You can find the contracts in the auction EIP.


[12/10/2021 10:01 PM] anon_real#2768
https://github.com/ergoplatform/eips/blob/master/eip-0022.md

{Embed}
https://github.com/ergoplatform/eips/blob/master/eip-0022.md
eips/eip-0022.md at master ¬∑ ergoplatform/eips
Ergo Improvement Proposals. Contribute to ergoplatform/eips development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/viX8AGkip2HBW3NxTUufUKcHVMaaV5GWOgP78kC2PTE/https/opengraph.githubassets.com/baabfed815ab9d2f3a2da7dbd5888f297a518ae5c7644b2972262e2b7798fa16/ergoplatform/eips

{Reactions}
üíØ 

[12/10/2021 10:16 PM] Leif Erickson#8939
great, thank you!!  This looks amazing!


[12/11/2021 9:17 AM] fateme.r#4033
Hi, Do we have "bitwise shift" operator in the ergo script? I couldnt find any related operator in the langSpec.


[12/11/2021 9:51 AM] fateme.r#4033
@greenhat


[12/11/2021 10:16 AM] greenhat#6562
Yes. See examples in https://github.com/ScorexFoundation/sigmastate-interpreter/blob/bd1906e3a0a4f93039a357c8d3ca4343b135dcf2/sigmastate/src/test/scala/sigmastate/lang/SigmaCompilerTest.scala#L213

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/bd1906e3a0a4f93039a357c8d3ca4343b135dcf2/sigmastate/src/test/scala/sigmastate/lang/SigmaCompilerTest.scala
sigmastate-interpreter/SigmaCompilerTest.scala at bd1906e3a0a4f9303...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/SigmaCompilerTest.scala at bd1906e3a0a4f93039a357c8d3ca4343b135dcf2 ¬∑ ScorexFoundation/sigma...
https://images-ext-1.discordapp.net/external/n8hqJtO4MnNFrL-spJu60yZMmC41RzHnj0WTbWyx_BU/https/opengraph.githubassets.com/6c8d2d33ca8868b4547eb1b27bdab18c195ac4cc1b750c3b873a4cdb1e2f592e/ScorexFoundation/sigmastate-interpreter


[12/11/2021 10:17 AM] greenhat#6562
I don't know where we have documented it. ü§¶‚Äç‚ôÇÔ∏è


[12/11/2021 10:29 AM] fateme.r#4033
Thanks a lot

{Reactions}
üôå 

[12/11/2021 12:37 PM] morphic#4133
testMissingCosting suggests it is not implemented.


[12/11/2021 12:39 PM] greenhat#6562
Oops! @fateme.r ‚òùÔ∏è


[12/11/2021 12:41 PM] fateme.r#4033
Oh! So don't we have shifts yet?


[12/11/2021 12:42 PM] greenhat#6562
It seems they're not implemented in 4.0.


[12/11/2021 12:46 PM] morphic#4133
if the method is not here, then it is not implemented https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md
sigmastate-interpreter/LangSpec.md at develop ¬∑ ScorexFoundation/si...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/LangSpec.md at develop ¬∑ ScorexFoundation/sigmastate-interpreter
https://images-ext-1.discordapp.net/external/n8hqJtO4MnNFrL-spJu60yZMmC41RzHnj0WTbWyx_BU/https/opengraph.githubassets.com/6c8d2d33ca8868b4547eb1b27bdab18c195ac4cc1b750c3b873a4cdb1e2f592e/ScorexFoundation/sigmastate-interpreter


[12/11/2021 10:32 PM] fateme.r#4033
I need to create a variable with data 2^x (x power of 2). but it seems that ergoscript doesn't have power operator nor bitwise shift. Then what do you think i can do? the variable x is small (an integer in range 0 to 6 ), can i make a table or simple function or something?


[12/12/2021 3:46 AM] JOFLITO#9983
https://scastie.scala-lang.org/lE4DcaD7RKe4F4inmDQS8A

{Embed}
https://scastie.scala-lang.org/lE4DcaD7RKe4F4inmDQS8A
Scastie - An interactive playground for Scala.
//function for 2^x

def twoToThePowerOfX( a:Int ) : Int = {
    // 2 to the power of X for small ints
    var aux = 0;
    var power = 1;
    if (a > 0) {
      while ( aux < a){
      power = power*2
      aux = aux + 1
    }
  }
    println("2 to the " + a + " is "+ power)
    return power
}

// testing the function
var x =0;
while (x < 7)
  {...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[12/12/2021 3:47 AM] JOFLITO#9983
Probably there is a better way to do it, but this gets the job done


[12/12/2021 3:57 AM] JOFLITO#9983
I am trying to create a box with two tokens, on line 143 from this script https://scastie.scala-lang.org/x0LkB0J3SOCkXXWcJXhu0A It looks like I can only have a tokenAmount type, but since I want to have two tokens I don't know how to solve it, can someone help me out please?

{Embed}
https://scastie.scala-lang.org/x0LkB0J3SOCkXXWcJXhu0A
Scastie - An interactive playground for Scala.
// this contract is based on Luivatra's code for a "self replicating token sale contract" 
// https://github.com/ergoplatform/ergoscript-by-example/blob/main/selfReplicatingTokenSale.md

// This contract will be used for a refundable ico
// first stage is buying the token (same as the original code) until a deadline is met
// second stage is ref...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[12/12/2021 4:28 AM] fateme.r#4033
But I'm trying to do so in the ergo script. The scripts are not as straight as scala codes :)


[12/12/2021 8:19 AM] Krasavice Blasen#4574
Im sure there is a nice way but an ugly way can be?
``` x == 1 && data = 2 || x == 2 && data = 4 || x == 3 && data = 8 ``` etc


[12/12/2021 8:23 AM] fateme.r#4033
Ummm, I can't understand what do you mean by the code. I don't need to verify that the data is correct, I need to evaluate the value for another usage.


[12/12/2021 8:26 AM] Krasavice Blasen#4574
Only one of the 7 paths will be taken, then your script can run as usual.


[12/12/2021 8:26 AM] Krasavice Blasen#4574
The path that is true will have data as 2^x


[12/12/2021 8:42 AM] Krasavice Blasen#4574
https://wallet.plutomonkey.com/p2s/?source=ewp2YWwgdG9rZW5JbiA9IElOUFVUUygwKS5SMltDb2xsWyhDb2xsW0J5dGVdLCBMb25nKV1dLmdldCgwKS5fMgp7CnZhbCB0b2tlbk91dCA9IDIKdG9rZW5JbiA9PSAxICYmIHRva2VuT3V0ID09IE9VVFBVVFMoMCkuUjJbQ29sbFsoQ29sbFtCeXRlXSwgTG9uZyldXS5nZXQoMCkuXzIKfSB8fAp7CnZhbCB0b2tlbk91dCA9IDIqMgp0b2tlbkluID09IDIgJiYgdG9rZW5PdXQgPT0gT1VUUFVUUygwKS5SMltDb2xsWyhDb2xsW0J5dGVdLCBMb25nKV1dLmdldCgwKS5fMgp9IHx8CnsKdmFsIHRva2VuT3V0ID0gMioyKjIKdG9rZW5JbiA9PSAzICYmIHRva2VuT3V0ID09IE9VVFBVVFMoMCkuUjJbQ29sbFsoQ29sbFtCeXRlXSwgTG9uZyldXS5nZXQoMCkuXzIKfQp9IAo=


[12/12/2021 8:42 AM] Krasavice Blasen#4574
This script returns 2^x tokens for x as 1,2,3


[12/12/2021 8:43 AM] Krasavice Blasen#4574
Its very ugly, but I think it works


[12/12/2021 8:51 AM] fateme.r#4033
not exactly this but i can use the same way somehow. Anyone else has any better idea than naive if-else solution?!

{Reactions}
üëç 

[12/12/2021 8:53 AM] fateme.r#4033
thanks anyway for feedback üôÇ

{Reactions}
‚ù§Ô∏è 

[12/12/2021 10:32 AM] morphic#4133
`val y = Coll(1, 2, 4, 8, 16, 32, 64)(x)` should work

{Reactions}
üëç 

[12/12/2021 11:14 AM] fateme.r#4033
Fineeee, thanks a lot


[12/12/2021 3:28 PM] JOFLITO#9983
the ergo playground is not for ergoscript? üò±


[12/12/2021 4:14 PM] Cheese Enthusiast#0548
If you wanted to make it so that someone could input x and get 2^x I think you could use fold:

```scala
// Lets say R4 stores a collection of x elements with the value 2
val myExponentList = SELF.R4[Coll[Int]].get
// Exponent x is equal to size of collection
val x = myExponentList.size
val baseIsTwo = myExponentList.forall{(base:Int) => base == 2}
val twoToPowerOfX = 
  if(baseIsTwo && x < 7){
    // Each element index represents 2^(idx+1)
    val expFolded = 
      myExponentList.fold(1, {(z: Int, base:Int) => z * 2})
    // Returns 2^x by folding over exponent list
    expFolded
  }else{
    // return -1 if invalid
    -1
  }
```


[12/12/2021 4:18 PM] fateme.r#4033
Thanks


[12/13/2021 10:51 AM] Leif Erickson#8939
hi all, is there a clear calculation to convert an ergo wallet into it's ergotree?  If easiest, the intermediate calcs like addressbytes would be great! I'm using this for reference, https://ergoplatform.org/en/blog/2019_07_24_ergo_address/, but examples to verify would be extremely helpful! For example, if I want to convert this wallet on the testnet to it's ergotree: `3WwjaerfwDqYvFwvPRVJBJx2iUvCjD2jVpsL82Zho1aaV5R95jsG`  ... I'm also confused if the resulting ergotree value should start with 0008cd or not if it's a P2PK conversion?


[12/13/2021 11:47 AM] fateme.r#4033
@morphic Hi, The bitwise "and" and "or" are documented in the langSpec, but they are `testMissingCosting` in the link you have sent!
And i cant use them in my script! Don't we have bitwise and or?!!


[12/13/2021 12:39 PM] greenhat#6562
I don't know if these conversions are described anywhere, but here is the code for parsing an ErgoTree from address - https://github.com/ergoplatform/sigma-rust/blob/53b66aff4420f3dc39e360c6108549c94feb6ff6/ergotree-ir/src/chain/address.rs#L424-L432
And yes, if you serialize an ErgoTree which only contains ProveDlog (P2PK) it should start with 0008cd.

{Embed}
https://github.com/ergoplatform/sigma-rust/blob/53b66aff4420f3dc39e360c6108549c94feb6ff6/ergotree-ir/src/chain/address.rs
sigma-rust/address.rs at 53b66aff4420f3dc39e360c6108549c94feb6ff6 ¬∑...
Alternative and simple implementation of ErgoTree interpreter - sigma-rust/address.rs at 53b66aff4420f3dc39e360c6108549c94feb6ff6 ¬∑ ergoplatform/sigma-rust
https://images-ext-1.discordapp.net/external/P4bOW0AE-uDW2cfbrzhiWTw6tJbIWD_bH5QKHYpx3P0/https/opengraph.githubassets.com/af43632c7356d0f9cac75d86c2fa260f03d1dc12310d99c626f6bc71a7551d90/ergoplatform/sigma-rust


[12/13/2021 3:39 PM] Leif Erickson#8939
Thank you! Are there any way verifiable example? Without getting something going on rust? I am generating an unsigned transaction, including the ergotree in R4, but the 0008cd giving error, which I can get when I get back to comouter


[12/13/2021 3:43 PM] greenhat#6562
No, nothing come to mind. Can you share your code?


[12/13/2021 4:40 PM] Leif Erickson#8939
yes, and thank you for your help...I have gotten about everything to work individually, but I'm having a hard time getting everything to work together, but hopefully very close.  The overall goal is for Ergopad tokens to become timelocked after purchase from a website.  I'm using the assembler to initiate a transaction that results in a transaction with 3, each timelocked to different vesting periods (for example, one box will unlock in 1 month, the next in 2, and so on), and you can see those 3 boxes here `https://testnet.ergoplatform.com/en/transactions/012d49340e8db2ff74533b48152912704ac096f63a6512fdba5828027bfc0e77`


[12/13/2021 4:48 PM] Leif Erickson#8939
The next step is after a vesting period, to send a transaction to accept the tokens.  The intent is to only allow the buyer (ergotree in R4) to be able to do this after a given time, like this `{
    "requests": [
        {
            "address": "7MfsfXUqm8c5kbaYCPqXjUa1rodM7igszw8wERSeWz2q6gJbN6aAKtP1GCK3iE3ZmymMccZN5oZcknq3GGKYXgsyycaAG5SqBLvTweE7UgKGKCu3DN3a9mKgp3M7ZNaPtoEGQo6FrmBPqQ5pHu8sBS3RMW7xVHLuhUvjh2RLccXfTDwCztVvYcrE9VZ",
            "value": 100000,
            "registers": {
                "R4": "0008cd03e98b0082050a0878b6d1136f2d8cf5e24f7b6d025b2961bffaf5ca3a537a4f52"
            }
        }
    ],
    "fee": 100000
}` which I just send to the API, and then sign and send...but with that ergotree, I get, `b'{\n  "error" : 400,\n  "reason" : "bad.request",\n  "detail" : "The request content was malformed:\\nsigmastate.lang.exceptions.InvalidTypePrefix: Cannot deserialize type prefix 0. Unexpected buffer sigmastate.utils.SigmaByteReader@2c9c8a3c with bytes [B@64c80c24: DownField(R4),DownField(registers),DownArray,DownField(requests)"\n}'`


[12/13/2021 4:59 PM] haileypdll#3353
I think that you need to encode the value in R4 as a sigmaProp


[12/13/2021 5:14 PM] Leif Erickson#8939
ok! I've based my work off the ts coinbarn library, and there is an encode register step that I realize I've removed and is likely doing just that!  Thanks!


[12/13/2021 6:08 PM] Leif Erickson#8939
is this the same as converting the ergotree(hex) to VLQ?


[12/13/2021 6:16 PM] haileypdll#3353
not the same value, maybe base16 encoded ?


[12/13/2021 7:57 PM] morphic#4133
No, we don't.


[12/13/2021 8:22 PM] kushti#0978
If 2^x is stored, you can provide x in spending input(context extension of it), and then check 2^x in the contract


[12/13/2021 8:32 PM] kushti#0978
as byte array, the code to encode the Ergo tree into byte array https://gist.github.com/kushti/ebd6cac42d67dedef4f0c189148c9fe3


[12/15/2021 5:34 AM] Leif Erickson#8939
I can't seem to figure out the proper way to use the node API to pull a token from a locked transaction, here: https://testnet.ergoplatform.com/en/transactions/bbf8f34d727116df77bcd7ed5a159282a6e60cb31335def2ed03f65f9860d6e9


[12/15/2021 5:39 AM] Leif Erickson#8939
the input is the smart contract, which is time locked, but past the time, and also locked to the buyer PK (shown in the inputs): ```req = {
    'requests': [
        {            
            'address': buyerWallet.address,
            'value': minTx,            
            'assets': [
                {
                    'tokenId': '0890ad268cd62f29d09245baa423f2251f1d77ea21443a27d60c3c92377d2e4d',
                    'amount': 1
                }
            ],
            #'registers': {
            #    'R4': '0e240008cd03e98b0082050a0878b6d1136f2d8cf5e24f7b6d025b2961bffaf5ca3a537a4f52',
            #},
        }
    ],
    'inputs': ["tUZc71UXrkV7J6yLxJBpzwHBfs3rhChH54Scxa1hABXJemtJHHizB5JcTi5pbQuoCGCp2EwSq7fyUvYb3X2FdHaUPGzGBkWN2vPwCvgiFJjXtRH2wkHnyS3FpE6dSmsAXbycKKr9f3SH9GLxayvSGPSsNFaLmJF4bHXwSa"],
    'outputs': [buyerWallet.address],
    'dataInputs': [],
    'fee': minTx,
    'sendChangeTo': buyerWallet.address,
}```


[12/15/2021 6:17 AM] quokka#1273
I'm looking at the ergoscript by example code here: https://github.com/ergoplatform/ergoscript-by-example/blob/main/escrowDepositContract.md

So lets say the seller wanted to refund the buyer, so they "sign" the transaction. how would one implement the signing a transaction for a contract? would the seller have to send a small amount of erg to the contract?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/920560062773223474/sign.PNG

{Embed}
https://github.com/ergoplatform/ergoscript-by-example/blob/main/escrowDepositContract.md
ergoscript-by-example/escrowDepositContract.md at main ¬∑ ergoplatfo...
Learn ErgoScript by reading example smart contracts powered by Ergo Playground. - ergoscript-by-example/escrowDepositContract.md at main ¬∑ ergoplatform/ergoscript-by-example
https://images-ext-1.discordapp.net/external/CEqfaHtEgwaRm9bjZj7MRm_1zAX7bJh3tMgQ3asjUqg/https/opengraph.githubassets.com/302a4e4a1171c01c4a7f65bcd9b987245cf48d17dd505a6f3e83e6ef93f702ac/ergoplatform/ergoscript-by-example


[12/15/2021 8:03 AM] kushti#0978
what does it mean "to pull" ? You need to transfer the token , so put into an output


[12/15/2021 9:18 AM] kushti#0978
Well, no condition for output's value, so fee can be deducted from an input protected with the contract just , and so no need for seller to provide an input


[12/15/2021 7:58 PM] Leif Erickson#8939
Thanks for your help, this is working beautifully now!


[12/15/2021 7:59 PM] Leif Erickson#8939
I have a node API question...is there documentation or can someone list an limitations vs AppKit for example?


[12/16/2021 11:55 AM] Leif Erickson#8939
Is there documentation on minimum amounts for fees or anything else when using smart contracts? I am creating a transaction and spitting in to about 10 boxes, each with different time locks in the ergoscript, and seems like each box needs 2x minimum fee, and the entire transaction does also and then trying to send ergs to the wallet that contains the tokens that are used...I'll try to get some code up shortly to reference, just trying to get to a good point. Thanks


[12/16/2021 1:01 PM] greenhat#6562
Tx fee or box value? Min box value depends on the box size in bytes. See the comments - https://github.com/ergoplatform/sigma-rust/blob/f5b536d272dad3c0edf8408e65987f9ca9410bbf/ergotree-ir/src/chain/ergo_box/box_value.rs#L32-L48

{Embed}
https://github.com/ergoplatform/sigma-rust/blob/f5b536d272dad3c0edf8408e65987f9ca9410bbf/ergotree-ir/src/chain/ergo_box/box_value.rs
sigma-rust/box_value.rs at f5b536d272dad3c0edf8408e65987f9ca9410bbf...
Alternative and simple implementation of ErgoTree interpreter - sigma-rust/box_value.rs at f5b536d272dad3c0edf8408e65987f9ca9410bbf ¬∑ ergoplatform/sigma-rust
https://images-ext-1.discordapp.net/external/VmQTHY8i5Ly8G6A1j6PvCwa2BvSIQdnlVLqqq0KYCHI/https/opengraph.githubassets.com/3dbd87a2e86cac769022bdf18d56413cd204aa31db4e226008baa2192ab27b30/ergoplatform/sigma-rust


[12/16/2021 5:42 PM] quokka#1273
Does anyone know how to create an NFT token (like one made by the auction house with royalties+) on Scastie? I know theres a function for it blockchainSim.newToken but I don't know how to add things to the registers


[12/23/2021 11:38 AM] kushti#0978
@greenhat can elaborate ?


[12/23/2021 11:51 AM] greenhat#6562
Usually, in playgrounds  NFT token is assumed to be minted earlier. Like in https://github.com/ergoplatform/ergoscript-by-example/blob/main/tokenSalesService.md see `ServiceOwner.generateUnspentBoxes` for ConfigNFT token.

{Embed}
https://github.com/ergoplatform/ergoscript-by-example/blob/main/tokenSalesService.md
ergoscript-by-example/tokenSalesService.md at main ¬∑ ergoplatform/e...
Learn ErgoScript by reading example smart contracts powered by Ergo Playground. - ergoscript-by-example/tokenSalesService.md at main ¬∑ ergoplatform/ergoscript-by-example
https://images-ext-1.discordapp.net/external/edBeuIDQLkTkucJ2Smh7xIvJiN-yBYRE1QzJ4C1SLP4/https/opengraph.githubassets.com/a4decab3696c56c945d8c0cd7ab4119d56ec760d015ccf0ebc2f8c01500f5738/ergoplatform/ergoscript-by-example


[12/23/2021 2:52 PM] quokka#1273
I‚Äôm trying to build off of the auction house contract and change it to a marketplace where users can list their NFT‚Äôs without a time limit or bids, just direct buys. To test out my script I need to create an NFT on scastie that has all the qualities as an NFT made on ErgoAuctions.org (including royalties, artist address, etc). How would I go about that?


[12/23/2021 2:52 PM] quokka#1273
Thanks, will check this out and see if it helps. Might not be exactly what I‚Äôm looking for but still helpful in other areas


[12/23/2021 3:46 PM] greenhat#6562
To mint a token you need to put a token (with token id = first input box id) with whatever quantity (1 for NFT) in the output box. Here is an example on how to set registers in a box - https://github.com/ergoplatform/ergo-playgrounds/blob/a3ea79fe447685c267be9ae54d73aa5534e810c5/playgrounds/src/main/scala/org/ergoplatform/playgrounds/examples/DEXPlayground.scala#L197

{Embed}
https://github.com/ergoplatform/ergo-playgrounds/blob/a3ea79fe447685c267be9ae54d73aa5534e810c5/playgrounds/src/main/scala/org/ergoplatform/playgrounds/examples/DEXPlayground.scala
ergo-playgrounds/DEXPlayground.scala at a3ea79fe447685c267be9ae54d7...
Run contracts + off-chain code in the browser. Contribute to ergoplatform/ergo-playgrounds development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/XP1VZJRPgaXtST_72tbTAkzqfCh8Zk2C8NtXlnGpzo0/https/opengraph.githubassets.com/ed02d528a9fc2b3c65325f67a416a329bb3228f71914e4dd8f0bbe10e33635e2/ergoplatform/ergo-playgrounds


[12/23/2021 4:00 PM] quokka#1273
YES THANK YOU

{Reactions}
üôå 

[12/27/2021 5:05 AM] anon_real#2768
@morphic is there a way to convert `Long` to `Coll[Byte]` in ergoscript?


[12/27/2021 7:14 AM] greenhat#6562
yes, `longToByteArray(longValue)`


[12/27/2021 7:16 AM] greenhat#6562
@anon_real and there is also a "reverse" - `byteArrayToLong`.


[12/27/2021 4:54 PM] anon_real#2768
@greenhat nice, thanks a lot!


[12/28/2021 10:44 PM] kii#8888
Is there a library for ergoscript boxes properties and fields?


[12/28/2021 10:44 PM] kii#8888
are we able to get the id of a box within the script by saying SELF.id?


[12/28/2021 10:50 PM] kushti#0978
yes, SELF.id works


[12/31/2021 4:49 AM] Leif Erickson#8939
The ergopad crew has been working on the code in the public repo (dev branch) and currently have an ergoscript that mimics the auction house and exchanges erg or sigUSD for tokens.  It's pretty simple now and was hoping to get some feedback.  We also are preparing to release the vesting ergoscript so want to understand a bit of the timeline and have enough to fix anything. The code is here, https://github.com/ergo-pad/ergopad/blob/dev/backend/app/api/v1/routes/blockchain.py starting at line 318 (script == 'sale') Thank you!!

{Embed}
https://github.com/ergo-pad/ergopad/blob/dev/backend/app/api/v1/routes/blockchain.py
ergopad/blockchain.py at dev ¬∑ ergo-pad/ergopad
Contribute to ergo-pad/ergopad development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/X-ZSKhDKd0dhfHdcMbI2sHV1xKnp5EFenkozHvB3drU/https/opengraph.githubassets.com/60eea866606f8dbed27e2b0a4f63e2a53b0b28c0a7c1fedb6ec32e325586cc00/ergo-pad/ergopad


[01/10/2022 3:33 PM] Krasavice Blasen#4574
How to utilise Zero-Knowledge proofs in Ergo-script to create something like a private transaction?


[01/10/2022 3:40 PM] Krasavice Blasen#4574
Or how to generally use zero-knowledge proofs on the blockchain, maybe another example like prove someone is the owner of a youtube account without them revealing their password.


[01/10/2022 3:41 PM] Krasavice Blasen#4574
Anything on the matter is appreciated thanks!


[01/10/2022 3:52 PM] Krasavice Blasen#4574
Does sigmaProp use ZKP by default? Like some box guarded with script ```alice || bob ``` is spent, is the default behavior that a third party doesn't know who spent the box?


[01/10/2022 3:53 PM] Krasavice Blasen#4574
Can third parties view the scripts guarding a box?


[01/10/2022 8:05 PM] abchris#8522
Correct and I think it is not just the default, it is always the case.


[01/10/2022 8:06 PM] abchris#8522
Yes for P2S boxes, but there are also P2SH (pay to script-hash) boxes which hide the script until they are spent.


[01/11/2022 1:25 AM] Krasavice Blasen#4574
I hear of applications where you can ZKPs to prevent front-running by hiding details of incoming swaps. How would this be done on Ergo? Through P2SH perhaps?


[01/11/2022 1:51 AM] abchris#8522
Possibly, but I'd rather wait for someone more informed than myself to answer that one üòâ Good question!


[01/12/2022 4:03 AM] Krasavice Blasen#4574
How does a third party view a script? I am looking to do this.


[01/12/2022 4:19 AM] abchris#8522
This may help: <https://discord.com/channels/668903786361651200/840313005064585246/857106367667896350
>


[01/12/2022 4:23 AM] abchris#8522
But I haven't tried it out yet.


[01/14/2022 4:50 PM] Luivatra#9076
Is it possible to have a utxo with a token with it's id set, but amount 0? Just wondering whether I need to check for amount besides id when looking for specific nft


[01/15/2022 3:19 AM] Krasavice Blasen#4574
No or at least I know that the node requires a positive asset value.

{Reactions}
üëç 

[01/16/2022 10:35 AM] HelixEvo#2120
Does anyone have a diagram/flow/fag packet on which the stack operates? Such as ergoscript on the top and that runs on whatever is underneath and the like? Almost like a block chain OSI model because my head is ü§¶‚Äç‚ôÇÔ∏è Need to see a drawing


[01/18/2022 3:10 AM] JOFLITO#9983
Ergo playground is down?


[01/22/2022 11:58 PM] Daniumy#5792
```For example, here is a script stating that the box can be spent by any 3 out of the following 6 possibilities: Alice, Bob, Charlie, David and Edie, Fran and George, Helen and Irene:
atLeast(3, Coll (pkA, pkB, pkC, pkD && pkE, pkF && pkG, pkH && pkI))```


[01/22/2022 11:59 PM] Daniumy#5792
What are the 6 possibilities?


[01/23/2022 12:00 AM] Daniumy#5792
The text is from the Whitepaper III advanced ergoscript


[01/23/2022 1:10 AM] Krasavice Blasen#4574
A, B, C, (D and E), (F and G), (H and I)


[01/23/2022 1:13 AM] Daniumy#5792
shit true I missed one of the commas, ty


[01/23/2022 2:54 AM] Daniumy#5792
WhitepaperIII - advanced ErgoScript is cool but will be cooler in spanish üá™üá∏  üòÜ

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/934642275483541544/unknown.png


[01/23/2022 4:09 AM] Daniumy#5792
Is it correct that the output produced with 60 tokens must be given to Alice? if so, why? wasnt Alice the one giving the 60 tokens?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/934661126124367932/unknown.png


[01/23/2022 7:13 AM] Krasavice Blasen#4574
Is it possible to access the CONTEXT.header class in ergoscript?


[01/23/2022 8:24 AM] Krasavice Blasen#4574
Does preHeader.parentId give previous block's id?


[01/23/2022 8:35 AM] Cheese Enthusiast#0548
ls


[01/24/2022 5:31 AM] lgd#5847
yeah i remember reading this when going over the paper, seems like it's just a typo. authors should confirm tho


[01/24/2022 5:51 PM] Luivatra#9076
I am currently looking at an error like this:
Failed to sign boxes due to Error in Evaluation.compile.evaluate(s90617 -> MethodCall(s90449, scalan.Base$Ref special.collection.Colls$Coll.apply(scalan.Base$Ref), [s578], true))


[01/24/2022 5:51 PM] Luivatra#9076
any tips on how to approach it?


[01/24/2022 9:47 PM] Krasavice Blasen#4574
Likely your script is accessing an undefined value


[01/24/2022 9:55 PM] Luivatra#9076
Yeah I found the discussion from some days ago, guess I will have to rethink my understanding of of else statements in ergoscript


[01/25/2022 7:52 AM] greenhat#6562
I'm just treating `if`, `AND`, `OR` as non-lazy due to the AOT costing always running through both branches.


[01/25/2022 7:54 AM] Luivatra#9076
So how to avoid referencing tokens/boxes/registers that in some cases dont exist?


[01/25/2022 8:01 AM] greenhat#6562
I wrap access to them with `if` checking if they exist first.


[01/25/2022 8:03 AM] Luivatra#9076
Then I am confused how nonlazy if statements are


[01/25/2022 8:12 AM] greenhat#6562
It might not be exactly 'laziness' term for IF. I meant that costs are always measured for both branches.


[01/25/2022 8:13 AM] Luivatra#9076
Ok, I think I understand, this will help a lot to understand the errors


[01/25/2022 9:14 PM] Luivatra#9076
So I am not sure how to fix this issue, it happens in this block:
```
if (SELF.R6[Long].get > OUTPUTS(0).R6[Long].get && INPUTS.size >= 3) { // Unstake
         // Stake State (SELF), Stake, Stake Key Box => Stake State, User Wallet
         val timeInWeeks = (blockTime - INPUTS(1).R6[Long].get)/1000/3600/24/7
         val penalty =  if (timeInWeeks > 8) 0L else 
                         if (timeInWeeks > 6) INPUTS(1).tokens(1)._2*5/100 else 
                         if (timeInWeeks > 4) INPUTS(1).tokens(1)._2*125/1000 else 
                         if (timeInWeeks > 2) INPUTS(1).tokens(1)._2*20/100 else
                         INPUTS(1).tokens(1)._2*25/100
         sigmaProp(allOf(Coll(
             selfReplication,
             //Stake State
             OUTPUTS(0).R4[Long].get == SELF.R4[Long].get-INPUTS(1).tokens(1)._2,
             OUTPUTS(0).R5[Long].get == SELF.R5[Long].get,
             OUTPUTS(0).R6[Long].get == SELF.R6[Long].get-1L,
             OUTPUTS(0).R7[Long].get == SELF.R7[Long].get,
             OUTPUTS(0).R8[Long].get == SELF.R8[Long].get,
             OUTPUTS(0).tokens(1)._2 == SELF.tokens(1)._2+1,
             //User wallet
             OUTPUTS(1).propositionBytes == INPUTS(2).R5[Coll[Byte]].get, // <---- error here
             OUTPUTS(1).tokens(1)._1 == INPUTS(1).tokens(1)._1,
             OUTPUTS(1).tokens(1)._2 == INPUTS(1).tokens(1)._2 - penalty
         )))
     } else {
         sigmaProp(false)
     }
```
In a transaction with only 2 INPUTS. when I replace INPUTS(2).R5[Coll[Byte]].get with INPUTS(2).propositionBytes it runs fine. When I wrap it in an if (INPUTS(2).R5[Coll[Byte]].isDefined) it fails. How can I guard from this. It seems referencing a register on a non existing box makes it non-lazy. Scastie link https://scastie.scala-lang.org/2IBVFLaOTgi38qo53zXwnw


[01/25/2022 9:19 PM] Cheese Enthusiast#0548
Maybe before checking for INPUTS(2), make sure INPUTS.size > 2. That way it should say script reduced to false if the box is not there, and it should evaluate correctly if the box is present.


[01/25/2022 9:19 PM] Luivatra#9076
Yeah but I am already checking for that in the if statement at the start


[01/25/2022 9:22 PM] Cheese Enthusiast#0548
So I'm not quite understanding here, if the transaction requires INPUTS.size >= 3, why are you trying to run it with 2 inputs?


[01/25/2022 9:23 PM] Luivatra#9076
This is only a part of the script, there is more if statements before this


[01/25/2022 9:25 PM] Cheese Enthusiast#0548
I see, and where are you wrapping the entire statement with R5.isDefined?


[01/25/2022 9:26 PM] Cheese Enthusiast#0548
Around the entire allOf statement?


[01/25/2022 9:28 PM] Luivatra#9076
not in this example, just something I tried, but nothing is working


[01/25/2022 9:28 PM] Luivatra#9076
```
val mahBox = if (false) INPUTS.getOrElse(2,SELF) else SELF
         sigmaProp(allOf(Coll(
             selfReplication,
             //Stake State
             OUTPUTS(0).R4[Long].get == SELF.R4[Long].get-INPUTS(1).tokens(1)._2,
             OUTPUTS(0).R5[Long].get == SELF.R5[Long].get,
             OUTPUTS(0).R6[Long].get == SELF.R6[Long].get-1L,
             OUTPUTS(0).R7[Long].get == SELF.R7[Long].get,
             OUTPUTS(0).R8[Long].get == SELF.R8[Long].get,
             OUTPUTS(0).tokens(1)._2 == SELF.tokens(1)._2+1,
             //User wallet
             OUTPUTS(1).propositionBytes == mahBox.R5[Coll[Byte]].get,
             OUTPUTS(1).tokens(0)._1 == INPUTS(1).tokens(1)._1,
             OUTPUTS(1).tokens(0)._2 == INPUTS(1).tokens(1)._2 - penalty
         )))
```


[01/25/2022 9:28 PM] Luivatra#9076
this fails as well


[01/25/2022 9:31 PM] Cheese Enthusiast#0548
One thing I've been doing to ensure I don't run into errors like this is to pre-check all registers, collection sizes, etc before using them. I'm not sure if you already do this, but for example this is what's in one of my contracts.

```scala
val selfValid = allOf(Coll(
        SELF.R4[Coll[(Coll[Byte], Coll[Long])]].isDefined,        // Last consensus
        SELF.R5[Coll[(Coll[Byte], Coll[Byte])]].isDefined,  // Current members
        SELF.R6[Coll[(Coll[Byte], Int)]].isDefined,         // Pool fees
        SELF.R7[Coll[Long]].isDefined,                       // Pool Information
        SELF.R8[Coll[(Coll[Byte], Coll[Byte])]].isDefined,  // Pool operators
        INPUTS(0) == SELF
      ))

val commandValid =
        if(commandExists){
          allOf(Coll(
            INPUTS(1).R4[Coll[(Coll[Byte], Coll[Long])]].isDefined,       // New consensus
            INPUTS(1).R5[Coll[(Coll[Byte], Coll[Byte])]].isDefined, // New members list
            INPUTS(1).R6[Coll[(Coll[Byte], Int)]].isDefined,        // New Pool fees
            INPUTS(1).R7[Coll[Long]].isDefined,                      // New Pool Information
            INPUTS(1).R8[Coll[(Coll[Byte], Coll[Byte])]].isDefined  // New Pool operators
          ))
        }else{
          false
        }

      val newMetadataExists = OUTPUTS(0).propositionBytes == SELF.propositionBytes
      val newMetadataValid =
        if(newMetadataExists){
          allOf(Coll(
            OUTPUTS(0).R4[Coll[(Coll[Byte], Coll[Long])]].isDefined,
            OUTPUTS(0).R5[Coll[(Coll[Byte], Coll[Byte])]].isDefined,
            OUTPUTS(0).R6[Coll[(Coll[Byte], Int)]].isDefined,
            OUTPUTS(0).R7[Coll[Long]].isDefined,
            OUTPUTS(0).R8[Coll[(Coll[Byte], Coll[Byte])]].isDefined,
            OUTPUTS(0).value == SELF.value,
            OUTPUTS(0).tokens.size == 1
          ))
        }else{
          false
        }
```


[01/25/2022 9:32 PM] Cheese Enthusiast#0548
I also wrap them all in an if statement so that if one of the pre-conditions evaluates to false, the entire statement is not evaluated and instead evaluates to false. I have yet to run into any unexpected if-statement based errors since going about things in this way.


[01/25/2022 9:33 PM] Luivatra#9076
any cases where you have less than 2 inputs?


[01/25/2022 9:37 PM] Cheese Enthusiast#0548
When I have less than two inputs it evaluates to false. I am not showing the full contract here cause its kinda big but there is a check for INPUTS.size >= 2


[01/25/2022 9:39 PM] Cheese Enthusiast#0548
It can have inputs above that number as well. I separated the logic so that a different contract handles the boxes above that required 2. Maybe that's helping my contract evaluate a little better and crash less often.


[01/25/2022 9:42 PM] Luivatra#9076
Yeah, I can put the logic in another contract, but that contract will occur multiple times in some transactions so I am trying to minimize the size, guess I will have to


[01/25/2022 9:44 PM] Luivatra#9076
still seems like a bug in the interpreter though


[01/26/2022 10:52 PM] kushti#0978
works for me : https://scastie.scala-lang.org/dMErrDNqTJi6hOTiZa91lw

{Embed}
https://scastie.scala-lang.org/dMErrDNqTJi6hOTiZa91lw
Scastie - An interactive playground for Scala.
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
import org.ergoplatform.Pay2SAddress
import sigmastate.eval.Extensions._ 
import scorex.crypto.hash.{Blake2b256}


///////////////////////////////////////////////////////////////////////////////...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[01/27/2022 1:56 AM] davidcodes#2138
I am using the scala simulator, I am trying to pass a script as a parameter for compiling another script. Any hints? I am trying something along the snippet below

```
val contractADef = """..
   ...
""" 

val contractBDef = """
   ...
   someBox.propositionBytes == contractA
   ...
"""

val contractA = ErgoScriptCompiler.compile(Map(), contractADef)

// this does not work
ErgoScriptCompiler.compile(Map("contractA" -> contractA), contractBDef)

```


[01/27/2022 10:13 AM] Telefragged#8068
Maybe you could simply use string substitution instead of that parameter map?


[01/31/2022 10:51 PM] kushti#0978
someBox.propositionBytes == contractA

well, you need to compare with contractA bytes I guess (or its hash), please ping if you need for a solution for this


[02/03/2022 9:32 AM] Luivatra#9076
is the change output box part of OUTPUTS? I want to make sure some tokens are burned as part of a tx


[02/03/2022 9:38 AM] Luivatra#9076
Yes it is, just tested it üôÇ


[02/06/2022 2:16 AM] Krasavice Blasen#4574
When using something like CONTEXT.headers or CONTEXT.preHeader, does it matter if the context changes after the tx has been submitted to mempool? When I submit the tx the current CONTEXT allows the script to be spent, but after 1 block passes the CONTEXT changes so if the script used this new context it is false. My scripts using these headers have been getting removed from mempool and I was wondering if this was the reason


[02/06/2022 2:17 AM] Krasavice Blasen#4574
Similar story with dataInputs. When I submit the tx the dataInput used is in UTXO, but my tx isnt mined quick enough then the dataInput is no longer in UTXO, will my tx still go through?


[02/06/2022 2:38 PM] Huginn#2291
Hi, I am lost a bit as why this `println(Blake2b256("1234".getBytes()) == Blake2b256("1234".getBytes()))` evaluates to false, if someone could direct me please. Because then every time I try to hash the same contract it has different hash.

Second question is it possible to get hash directly from the script of the propositionBytes where I dont have to simulate a Box creation as in Heads or Tails game example. I would imagine I have to create an ErgoTree and hash that one if I understand that correctly and assume that box creation creates an ErgoTree for guarding the box?

Edit: Trying to write my first example, using scastie playground


[02/07/2022 6:37 AM] greenhat#6562
I believe the CONTEXT is built from the block in which the tx was included. So, yes, it changes depending on in which block tx is included.


[02/07/2022 6:55 AM] greenhat#6562
1. Could you show the script (scastie link)? I see ErgoTree IR node (Blake2b256) along with Scala's println and strings and it's hard to figure out what is happeining here.
2. Yes, `blake2b256(box.propositionBytes)` should do the job. `propositionBytes` is the serialized ErgoTree. Upon box creation you have to explicitly set the guarding script (`ergoTree` property).


[02/07/2022 12:18 PM] Huginn#2291
Sorry for late answer, not much time during the week, here is a link https://scastie.scala-lang.org/TRlCsWeoRIiZQo71kGijAw . There are 2 comments starting with `HELP` to navigate through the code, first try doing something so sure there might be many stupid ways of doing things. 
Thank you for your help!

{Embed}
https://scastie.scala-lang.org/TRlCsWeoRIiZQo71kGijAw
Scastie - An interactive playground for Scala.
// Rock Paper Scissors game
//    First player chooses one option
//    Second player plays his move
//    Then we evaluate the winner or return funds to the first player
//    0 = Rock, 1 = Paper, Scissors = 2

// Required import for the Ergo Playground
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.u...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/07/2022 5:30 PM] greenhat#6562
Blake2b256 produces an `Array` for which `==` means referential equality (see Java). You want `array1.sameElements(array2)` for equality check.
`contract.ergoTree.bytes` should give you serialized bytes.

{Reactions}
üëç 

[02/08/2022 3:43 PM] Huginn#2291
Thank you, just tried and works as expected. Sorry for me not checking it returns an array.


[02/08/2022 3:44 PM] greenhat#6562
No problem. It's a tricky thing imported from Java. üôÇ


[02/09/2022 7:08 PM] Ch1n3du#7350
I'm not really sure what's causing the error

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/941047908730560542/Screenshot_60.png
https://cdn.discordapp.com/attachments/849659724495323206/941047909141585950/Screenshot_61.png
https://cdn.discordapp.com/attachments/849659724495323206/941047909552648272/Screenshot_62.png


[02/10/2022 6:30 AM] greenhat#6562
I believe it's '0.5'. There is no floating point type in ErgoScript.


[02/10/2022 8:34 AM] Ch1n3du#7350
What would be the proper way to handle fractional values?


[02/10/2022 8:35 AM] greenhat#6562
Making them integer somehow. Through a constant multiplier, i.e. 0.5 * 100 = 5.


[02/10/2022 12:14 PM] SoCool#6419
this would be: `amount: 5; decimals: 1;` - is that an appropriate understanding of the decimals use in ergo? Also same as `amount: 50; decimals: 2;` ?


[02/10/2022 12:27 PM] greenhat#6562
I'm not familiar with this form. I meant using 5 in the script, but 5/10 in the external code.


[02/10/2022 12:29 PM] SoCool#6419
forgive me - it's just the way I keep seeing fractions in the ergo platform API's inside of boxes etc; erg always has 9 decimals listed, tokens specify their own along with their amounts etc - your reference to ergoscript only supporting integers would explain why decimals and amounts are separated in all the data presentations of values


[02/10/2022 1:54 PM] AggerGakker#4449
Hey guys. We are coming up on the hackathon and we were wondering if anyone has a few moments to go through our proposal for our first smart contract.
https://github.com/GuapSwap/guapswap/blob/v0.1.0/src/main/scala/contracts/GuapSwapErgoDexSwapSellProxyContract.scala

{Embed}
https://github.com/GuapSwap/guapswap/blob/v0.1.0/src/main/scala/contracts/GuapSwapErgoDexSwapSellProxyContract.scala
guapswap/GuapSwapErgoDexSwapSellProxyContract.scala at v0.1.0 ¬∑ Gua...
GuapSwap CLI for the everyday Ergo miner. Contribute to GuapSwap/guapswap development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/HrTu15w0yoOONxnSSe_W9IGbncsZclH5FncCGKJQFe0/https/opengraph.githubassets.com/38536032e558009b6b5119e75c099a2d91a564e17b9f75e0f8683a80d4f0dffe/GuapSwap/guapswap


[02/10/2022 7:18 PM] lgd#5847
Does this method: 
def substConstants[T](scriptBytes: Coll[Byte], positions: Coll[Int], newValues: Coll[T]): Coll[Byte]

need to be called multiple times with different newValues: Coll[T] and different T if I want to replace constants in an ergoscript that have different types?


[02/10/2022 8:46 PM] Cheese Enthusiast#0548
I believe you can only substitute constants for the same type so yes


[02/10/2022 8:58 PM] lgd#5847
Thanks lol


[02/11/2022 11:20 AM] Ch1n3du#7350
Thank you


[02/11/2022 2:35 PM] morphic#4133
@Cheese Enthusiast There is no strict requirement for all new values to be of the same type. However this condition is checked for each new value https://github.com/ScorexFoundation/sigmastate-interpreter/blob/e1af1878fcb6ece28114d65b878cdc913c0e7bf3/sigmastate/src/main/scala/sigmastate/serialization/ErgoTreeSerializer.scala#L345
Which means, the type should be preserved.


[02/11/2022 2:39 PM] morphic#4133
Also, this is not supported by  ErgoScript Compiler, but is supported by ErgoTree if it can be created directly (e.g. in Scala)


[02/11/2022 3:08 PM] lgd#5847
But the signature is here, at the very bottom: https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md


[02/11/2022 3:11 PM] morphic#4133
Right, but you need to provide a collection of new values, and the collection should have some type.


[02/11/2022 3:11 PM] morphic#4133
if we are talking about ErgoScript


[02/11/2022 3:12 PM] lgd#5847
Yeah okok. So in this case the values must be if the same type correct?


[02/11/2022 3:12 PM] morphic#4133
Right, but this is limitation comes from ErgoScript static typing compiler, not from ErgoTree


[02/11/2022 3:14 PM] morphic#4133
You can try Coll[Any](1.toByte, 2.toShort, 3) in ErgoScript. Chances are it will work


[02/11/2022 3:15 PM] lgd#5847
Okok. So im not sure if what I did is valid then. I called the function multiple times, replacing the input script with the output from the previous call, and using new values with a different type, with different position as well.


[02/11/2022 3:15 PM] morphic#4133
This is ok, should work

{Reactions}
üëç 

[02/11/2022 3:16 PM] morphic#4133
It is not the most efficient way, however


[02/11/2022 5:37 PM] HelixEvo#2120
Man‚Ä¶ Reading this channel just proves I‚Äôm too old to start back coding. What happened to if, else, then and while/for loops üôÉ


[02/12/2022 6:55 AM] kii#8888
Never too old to learn!


[02/12/2022 8:47 AM] Huginn#2291
Would anybody please check my code in scastie, what's wrong? I suppose it's how I assign the array into R4 register. Link: https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/200

{Embed}
https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/200
Scastie - An interactive playground for Scala.
// Head and Tails multistage game
// 0 = Head, 1 = Tails

// Required import for the Ergo Playground
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
// import ErgoBox and hash function
import org.ergoplatform.appkit.ErgoType
import java.util....
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/12/2022 9:34 AM] zargarzadehmoein#2928
https://github.com/ErgoGravity/gateway-proxy/blob/9cbf72b934b08e258457367e366050a1734f1050/app/gateway/Adaptor.scala#L269

Maybe this could help you

{Embed}
https://github.com/ErgoGravity/gateway-proxy/blob/9cbf72b934b08e258457367e366050a1734f1050/app/gateway/Adaptor.scala
gateway-proxy/Adaptor.scala at 9cbf72b934b08e258457367e366050a1734f...
Wrapper of Ergo Node to work with Gravity.tech. Contribute to ErgoGravity/gateway-proxy development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/81cCV4rTgsXZNY8RovIePoQcc6IvDEIUkBOVM2zlP-w/https/opengraph.githubassets.com/a46e6317164bdae9a7e81a86dcc2760056d7583ccd5fa2e815b27b5ad17c5189/ErgoGravity/gateway-proxy


[02/12/2022 9:35 AM] Huginn#2291
Thank you, gonna check it out!

{Reactions}
üëç 

[02/12/2022 9:41 AM] HelixEvo#2120
Why is there things like: val test = ‚Äú‚Äù‚Äùs


[02/12/2022 9:41 AM] HelixEvo#2120
Why are there 3 ‚Äú


[02/12/2022 9:50 AM] Huginn#2291
I'm new but I expect to be able to write string into multiple lines


[02/12/2022 10:12 AM] HelixEvo#2120
Like an array of strings then?


[02/12/2022 10:16 AM] Huginn#2291
found out something, maybe will help you https://docs.scala-lang.org/overviews/scala-book/two-notes-about-strings.html#:~:text=A%20second%20great%20feature%20of,fathers%20...%22%22%22&text=Because%20this%20is%20what%20you,way%20to%20create%20multiline%20strings.

{Embed}
https://docs.scala-lang.org/overviews/scala-book/two-notes-about-strings.html
Two Notes About Strings
This page shares two important notes about strings in Scala.
https://images-ext-2.discordapp.net/external/NimeBpuQwVZP68LG6VcPgxr_MFcLZ9m_oh3uR_FPyS8/https/docs.scala-lang.org/resources/img/scala-spiral-3d-2-toned-down.png

{Reactions}
üëç 

[02/12/2022 10:34 AM] Huginn#2291
I have switched from `Array` to `Seq` but is it needed (I see you have `Seq` instead of an `Array`) as I already had `Array`?

In that case I am having problem importing Utils (`not found: value utils`), which I suppose is `import helpers.Utils` but I am not able to import them and idk if I should change something in the sbt settings or not, few guesses didnt help.

If I dont have to convert it to `Array` I suppose I just need the one line you provided but update it for my needs, as I have `Array[SigmaProp]` I should convert it like 
`ErgoValue.of(array, ErgoType.collType(ErgoType.sigmaPropType)))` is that correct?

I would like to point out that I have zero experience with Scala, but would like to try a parallized contract.
Current link: https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/226

{Embed}
https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/226
Scastie - An interactive playground for Scala.
// Head and Tails multistage game
// 0 = Head, 1 = Tails

// Required import for the Ergo Playground
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
// import ErgoBox and hash function
import org.ergoplatform.appkit.{ErgoType, ErgoValue, Java...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/12/2022 10:57 AM] HelixEvo#2120
What? So you can put code of that size into a variable?  So the variable is, I guess dynamic?


[02/12/2022 10:57 AM] HelixEvo#2120
Taxi!!!!


[02/12/2022 11:42 AM] zargarzadehmoein#2928
no, in your case you need
`ErgoValue.of(array, ErgoType.sigmaPropType))`


[02/12/2022 11:44 AM] Huginn#2291
even that does not allow to sign the transaction


[02/12/2022 11:50 AM] Huginn#2291
Maybe I am adding pubKeys incorrectly into the array then?


[02/12/2022 12:14 PM] zargarzadehmoein#2928
No, your code it's ok, I think this is because playground don't support  Array[T] (Array[SigmaProp]).
maybe you could send a PR for support that https://github.com/ergoplatform/ergo-playgrounds/blob/defae2bd4250a3ec7a721621fe565a4cd9fe650a/playground-env/src/main/scala/org/ergoplatform/playgroundenv/dsl/BoxDsl.scala#L57

{Embed}
https://github.com/ergoplatform/ergo-playgrounds/blob/defae2bd4250a3ec7a721621fe565a4cd9fe650a/playground-env/src/main/scala/org/ergoplatform/playgroundenv/dsl/BoxDsl.scala
ergo-playgrounds/BoxDsl.scala at defae2bd4250a3ec7a721621fe565a4cd9...
Run contracts + off-chain code in the browser. Contribute to ergoplatform/ergo-playgrounds development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/XP1VZJRPgaXtST_72tbTAkzqfCh8Zk2C8NtXlnGpzo0/https/opengraph.githubassets.com/ed02d528a9fc2b3c65325f67a416a329bb3228f71914e4dd8f0bbe10e33635e2/ergoplatform/ergo-playgrounds


[02/12/2022 12:15 PM] Huginn#2291
Oh, so that's where should be Array[SigmaProp] be included?


[02/12/2022 12:16 PM] Huginn#2291
Because I wanted to create a simple example where I would store each players pubKey so to circumvent this problem I may try to hash their pubKeys and use that instead? Now sure if that will be demonstrative enough


[02/12/2022 12:17 PM] zargarzadehmoein#2928
yes

{Reactions}
üëç 

[02/12/2022 12:20 PM] Huginn#2291
and in case I would try to redo that to hash of the pubKey, which is Coll[Coll[Byte]] would that be possible here?


[02/12/2022 12:20 PM] zargarzadehmoein#2928
you need convert pubKey to arrayByte and put it in register but for multi pubKeys I think this will be a problematic solution.


[02/12/2022 12:21 PM] Huginn#2291
So something converting to Coll[Coll[Byte]] wont be doable?


[02/12/2022 12:21 PM] Huginn#2291
in the playground*


[02/12/2022 12:22 PM] zargarzadehmoein#2928
for a simple solution you can put each of them in one registers (If you can limit them)


[02/12/2022 12:22 PM] zargarzadehmoein#2928
no


[02/12/2022 12:23 PM] zargarzadehmoein#2928
@greenhat Do you have any suggestion?


[02/12/2022 12:23 PM] Huginn#2291
hmm, that I might try, but I will have to do it for 4 players max then, but if it works I will be happy. Thank you for your help would you mind if I tag you in case of another problem?


[02/12/2022 12:25 PM] zargarzadehmoein#2928
sure, you're free

{Reactions}
üëç ergo_white 

[02/12/2022 1:14 PM] greenhat#6562
You're right, that's the place.


[02/12/2022 3:46 PM] Huginn#2291
@zargarzadehmoein Sorry for another question, but I suppose, `Array[Long]` should work as well right (I can see that it is in the link you posted)? Because it is causing issues and when I replace it with the other array that is `Array[Byte]` and comment conditions for that register it works.

When I want to process the lobbyContract further, I create 2 Boxes in `createGameBox` and there I assign to `R7 -> Array[Long]`, which causes problem. When I instead leave that and comment the conditions in lobbyContract about `R7` it signs the transaction.
https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/446

{Embed}
https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/446
Scastie - An interactive playground for Scala.
// Head and Tails multistage game
// 0 = Head, 1 = Tails

// Required import for the Ergo Playground
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
// import ErgoBox and hash function
import org.ergoplatform.appkit.{ErgoType, ErgoValue}
impo...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/12/2022 4:33 PM] zargarzadehmoein#2928
please update `ergo-playground-env` in build settings to latest publish `"org.ergoplatform" %% "ergo-playground-env" % "0.0.0-97-defae2bd-SNAPSHOT"`


[02/12/2022 4:34 PM] zargarzadehmoein#2928
https://scastie.scala-lang.org/rSqURQq1Rma95OKnksJJbA

{Embed}
https://scastie.scala-lang.org/rSqURQq1Rma95OKnksJJbA
Scastie - An interactive playground for Scala.
// Head and Tails multistage game
// 0 = Head, 1 = Tails

// Required import for the Ergo Playground
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
// import ErgoBox and hash function
import org.ergoplatform.appkit.{ErgoType, ErgoValue}
impo...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/12/2022 4:35 PM] Huginn#2291
Thank you!

{Reactions}
üëç 

[02/12/2022 7:47 PM] Huginn#2291
@zargarzadehmoein Sorry for another question, but do you have any idea, why when I execute `firstMoveScript` with box, that is `secondMoveScript` it does the else part of condition, where if checks whether it is `secondMoveScript`, when it obv is. As it also goes through the `expired` and then fails, as those registers contains different types.
Edit: updated minor issue, still the same problem https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/609

{Embed}
https://scastie.scala-lang.org/The-Huginn/R7MQNunpRKKk5XqADMrDeA/609
Scastie - An interactive playground for Scala.
// Head and Tails multistage game
// 0 = Head, 1 = Tails

// Required import for the Ergo Playground
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
// import ErgoBox and hash function
import org.ergoplatform.appkit.{ErgoType, ErgoValue}
impo...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/12/2022 8:05 PM] Huginn#2291
Also, why doesnt it simply evaluate the `expired` to `false` if it gets there as `if (HEIGHT < SELF.R6[Coll[Long]].get(0)) false` should cause it to


[02/12/2022 8:12 PM] Cheese Enthusiast#0548
I believe this is an affect of the current AOT costing method used by ErgoScript. All branches of if statements are evaluated, so you should add multiple if statements to make sure everything is defined before using them. This should be changed in v5.0 soft fork when Ergo switches to JIT costing.


[02/12/2022 8:14 PM] Huginn#2291
I was afraid that iis the problem, but how should I check that properly, because .isDefined will work if there is stored something different?


[02/12/2022 8:15 PM] Huginn#2291
and even if I add if statements wont it still go through them as it's currently the problem?


[02/13/2022 7:35 AM] fateme.r#4033
When a register is not defined at all in one branch it won't have any errors. but when you have different data types in different situations in the same register, it gets evaluation error. It's not a solution but I made a standard for data types of registers on all boxes so they all look the same with different data.


[02/13/2022 7:37 AM] fateme.r#4033
for example you can store all needed long values in all boxes R4[Coll[Long]] register, or storing all byte arrays in R5[Coll[Coll[Byte]]

{Reactions}
üëç 

[02/13/2022 7:53 AM] Huginn#2291
Yes, I have tried to recreate it this way to avoid the problems, but thank you for the explanation, didnt know that they dont evaluate if they are empty.


[02/14/2022 12:03 PM] Ch1n3du#7350
What would be the right way to convert a scala list to an ergoscript collection?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/942752797391224892/Screenshot_78.png
https://cdn.discordapp.com/attachments/849659724495323206/942752797835812944/Screenshot_79.png


[02/14/2022 12:41 PM] kii#8888
use this: import special.collection.Coll


[02/14/2022 12:43 PM] kii#8888
What Im doing that works is taking an Array or List, and then convert it using:

where elements = Array[Long]
```
val longColl = JavaHelpers.SigmaDsl.Colls.fromArray(elements)
      ErgoValue.of(longColl, ErgoType.longType())
```


[02/14/2022 12:44 PM] kii#8888
I haven't dealt with Long, Long. However a Coll[Long] => Array[Long] 
is done in the above example


[02/14/2022 12:54 PM] Ch1n3du#7350
Thank you, solved my problem exactly


[02/14/2022 1:04 PM] kii#8888
Contract Audit Request for ErgoLend:
https://github.com/Ergo-Lend/ergo-lend-documentation/blob/main/contracts/SingleLender/contracts.scala

üôÇ

{Embed}
https://github.com/Ergo-Lend/ergo-lend-documentation/blob/main/contracts/SingleLender/contracts.scala
ergo-lend-documentation/contracts.scala at main ¬∑ Ergo-Lend/ergo-le...
Documentation. Contribute to Ergo-Lend/ergo-lend-documentation development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/9SNTSeXmaL1--d2t8sgzsrizITno8o_cq8LK81CBTpo/https/opengraph.githubassets.com/851032d6148e0be4b8455259a141322d3e85050da3b81e6260f4552ef9c752bc/Ergo-Lend/ergo-lend-documentation

{Reactions}
ergo_black 

[02/15/2022 4:38 AM] 6directions#1089
im trying to sign a message like so
```
val message = "some message"
val signedMessage = senderProver.signMessage(senderProver.getP2PKAddress, message.getBytes, HintsBag.empty)
val signedMessageBytes = Colls.fromArray(signedMessage)
```
I want to include it in a register of an output box so I can later verify the signature from a contract.
are there any contract examples that do this that I could look at for reference?


[02/15/2022 6:23 AM] zargarzadehmoein#2928
maybe these could help you
sign function based on schnorr protocol -> https://github.com/ErgoGravity/gateway-proxy/blob/9cbf72b934b08e258457367e366050a1734f1050/app/gateway/Adaptor.scala#L391

verify contract -> https://github.com/ErgoGravity/gateway-proxy/blob/9cbf72b934b08e258457367e366050a1734f1050/app/gateway/GatewayContracts.scala#L33


[02/15/2022 6:29 AM] 6directions#1089
Thank you, I will take a look.

{Reactions}
üëç 

[02/15/2022 6:37 AM] 6directions#1089
Interesting.
I noticed you guys don't use the `signMessage` method offered by appkit's `ErgoProver`.

Instead it looks like you implement the method to `sign` with off chain code, and to `verify` from the contract.

Is there a particular reason for this approach?


[02/15/2022 6:38 AM] zargarzadehmoein#2928
That's right, as far as I can remember, it was not yet implemented in Appkit at the time!


[02/15/2022 6:40 AM] 6directions#1089
Ah, that makes sense!
Would using the now available method yield the same result?

Moreover, in order to verify from the contract, is there a native method supported by ErgoScript that abstracts verification logic, or would I need to implement it myself?


[02/15/2022 6:43 AM] 6directions#1089
I know of the existence of `proveDlog` `proveDHTuple` methods available in the script context, but I must admit I'm not sure how to use them properly, or how they work. Unfortunately this starts to get into knowledge territory I am not yet familiar with.


[02/15/2022 6:45 AM] zargarzadehmoein#2928
I did not test this new method, I need more time to test it in my free time.
also we did not find any pre-verification implementation (In our case we had multi-sign), maybe @kushti can help about that.


[02/15/2022 6:49 AM] 6directions#1089
Ah, I see. Alright, appreciate your help!

{Reactions}
üëç 

[02/15/2022 8:04 AM] Ch1n3du#7350
https://scastie.scala-lang.org/Ch1n3du/LJMAdsebQP6IUuLEk2wawg/64 I'm getting a type error but not sure what it is

{Embed}
https://scastie.scala-lang.org/Ch1n3du/LJMAdsebQP6IUuLEk2wawg/64
Scastie - An interactive playground for Scala.
import org.ergoplatform.playgroundenv.models.TokenAmount
import org.ergoplatform.DataInput
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
import org.ergoplatform.Pay2SAddress
import sigmas...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/15/2022 2:34 PM] morphic#4133
No, there is no high level function in ErgoScript for verification.

{Reactions}
üòÆ üëç 

[02/16/2022 6:06 PM] 6directions#1089
if a contract is passed a public key as a constant, and it wants to verify that an output is going to an address that belongs to the provided public key, what would the check for that look like?
is this correct?
```
OUTPUTS(0).propositionBytes == pubKey
```


[02/16/2022 6:09 PM] 6directions#1089
had a feeling it wasn't üò¨  this gives me a contract compilation error


[02/16/2022 6:17 PM] Cheese Enthusiast#0548
You can do pubKey.propBytes


[02/16/2022 6:20 PM] Cheese Enthusiast#0548
You can look here for an indepth view of all ErgoScript methods and types

{Reactions}
üëç üëÄ 

[02/16/2022 6:20 PM] Cheese Enthusiast#0548
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/spec/spec.pdf

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/spec/spec.pdf
sigmastate-interpreter/spec.pdf at develop ¬∑ ScorexFoundation/sigma...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/spec.pdf at develop ¬∑ ScorexFoundation/sigmastate-interpreter
https://images-ext-2.discordapp.net/external/yF3xpaMVw_x7RnlLTMzTSuZ5lX1m4FJWejTtVmH88_U/https/opengraph.githubassets.com/e5e7499aae9be80d0adf11b46820e9618a17d8ddec6059a16541b2df564ad4c0/ScorexFoundation/sigmastate-interpreter

{Reactions}
‚ù§Ô∏è 

[02/16/2022 6:21 PM] Cheese Enthusiast#0548
Page 26 has SigmaProp.propBytes method. You should be able to use that to check equality between a PK and an Output's guarding script


[02/16/2022 6:30 PM] 6directions#1089
Ah, was not aware I could do that. Thanks, and also for the document!


[02/18/2022 8:19 PM] 6directions#1089
hey there.
I'm trying to do this from a script
```
val in = INPUTS(0)
val expectedRegistersAreEmpty = in.R4[Coll[Byte]].isEmpty && in.R5[Long].isEmpty && in.R6[Coll[Byte]].isEmpty
```
but am getting this compilation error
```
Cannot find method 'isEmpty' in in the object (plus a bunch more stuff)
```
I got the idea of calling `.isEmpty` from here https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md

But also when I look at the breakdown of the `Box` type on pages 26-29 of this doc, I can find mention of that method
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/spec/spec.pdf

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/944327336013221938/unknown.png


[02/18/2022 9:23 PM] Cheese Enthusiast#0548
Registers are options so you wanna look at Option methods. From what I can tell, isEmpty is not a method for Options in ErgoScript right now. Idk why it's in the LangSpec, maybe it was supposed to be implemented but never was.


[02/18/2022 9:24 PM] Cheese Enthusiast#0548
I would just check `!(in.R4[Coll[Byte].isDefined)`

{Reactions}
üëç (2) 

[02/18/2022 9:55 PM] 6directions#1089
ah, I see. yeah that makes sense. thank you.


[02/19/2022 11:16 AM] morphic#4133
yes, indeed, thanks for pointing out,  cleaned up LandSpec

{Reactions}
üëç ergo_orange 

[02/21/2022 11:35 AM] SoCool#6419
If an ergo script contract has no tokens in its box, can it place a token into an output box? Would this be effectively minting that token when the box is spent? I'm still trying to understand the fundamentals of what ergo script can do vs. what the code interacting with the chain must do for it


[02/21/2022 12:38 PM] SoCool#6419
Yeah, I'm misunderstanding ergoscript, reading more makes that clear. It's more predicates than imperatives.


[02/21/2022 12:38 PM] SoCool#6419
I just need to RTFM


[02/21/2022 12:46 PM] SoCool#6419
Addresses are ergotrees? Am I reading that right? Would explain why dex swaps always come from crazy addresses..


[02/22/2022 11:53 AM] HazeyOneKenobi#2091
Is there a resource somewhere  detailing Ergoscript syntax?


[02/22/2022 11:55 AM] HazeyOneKenobi#2091
Nvm it's linked like ten messages above!


[02/22/2022 1:27 PM] glasgowm#9381
more here: https://docs.ergoplatform.com/dev/scs/ergoscript/

{Reactions}
üëçüèª 

[02/22/2022 11:39 PM] lgd#5847
I'm trying to use substConstants() in ErgoScript, but I keep getting this error and I'm not sure what it means/how to fix this:

`scalan.Base$StagingException: Error in Evaluation.compile.evaluate(s1924 -> MethodCall(s8, scalan.Base$Ref special.sigma.SigmaDsl$SigmaDslBuilder.substConstants(scalan.Base$Ref,scalan.Base$Ref,scalan.Base$Ref), [s1912, s740, s1923], true))`

`Caused by: org.ergoplatform.validation.ValidationException: Validation failed on ValidationRule(1008,Check the non-primitive type code is supported or is added via soft-fork) with args WrappedArray(-51)
`


[02/23/2022 5:20 AM] greenhat#6562
@morphic ^


[02/23/2022 12:01 PM] morphic#4133
This error happens during deserialization of type descriptor (see SType and TypeSerializer classes). Most probably the bytes being deserialised are botched.

{Reactions}
üëç 

[02/23/2022 8:55 PM] ergodevv#2308
Hi guys, is there a way to store public addresses in registers of a Box and then use those addresses in future transactions?


[02/23/2022 8:56 PM] ergodevv#2308
I don't know if it's the scala syntax or what, but for some season I just can't get this simple scenario to work


[02/23/2022 8:59 PM] ergodevv#2308
https://scastie.scala-lang.org/ergodevv/nZKa2JDRT96aTMJaiZVldg This is what I'm working with, can anyone help out?

{Embed}
https://scastie.scala-lang.org/ergodevv/nZKa2JDRT96aTMJaiZVldg
Scastie - An interactive playground for Scala.
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
import org.ergoplatform.Pay2SAddress
import sigmastate.eval.Extensions._
import scorex.crypto.hash.{Blake2b256}

////////////////////////////////////////////////////////////////////////////////...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[02/23/2022 11:21 PM] lgd#5847
so i tried it two different ways. i substituted the constants outside the contract, and it worked. i was able to produce a contract that could swap with ergodex and everything worked. for added safety, i want to perform the same operation within the contract and compare the two. the issue is something going wrong with substConstants() within the ergoscript contract. for both cases, i'm using the same values.


[02/24/2022 10:21 AM] lgd#5847
The substConstants() function call executes for the first time without issue (I call it four times in my ErgoScript contract, and feed the input of the previous call into the next), the problem occurs with the second call. (I tried reversing the order of the first and second call such that the values were reversed as well, but the same problem arose).
The error is with a value called r: SigmaByteReader, for some reason the reader for the scriptBytes returned after the first execution of substConstants() has something wrong with it and causes r to have a typecode (ucode) of 205 (when converted to its byte form it has value -51, which is what the error shows when thrown to the console), but this doesn't correspond to any of the STypes that it checks for, hence the error. So it must be, for some reason, the bytes returned from the function call which causes the problem, as far as I can tell.


[02/24/2022 12:31 PM] morphic#4133
This may be because of the bug in substituteConstants https://github.com/ScorexFoundation/sigmastate-interpreter/blob/e1af1878fcb6ece28114d65b878cdc913c0e7bf3/sigmastate/src/main/scala/sigmastate/serialization/ErgoTreeSerializer.scala#L306
You need to make sure the scriptBytes have isConstantSegregation flag set to 1.


[02/24/2022 12:33 PM] lgd#5847
Okok. But since it substituted constants on the first call but failed on the second, does this mean the output bytes from the first call would have it set to 0?


[02/24/2022 12:36 PM] morphic#4133
When the flag is not set, then resulting bytes coming out of substituteConstants contain invalid ErgoTree, which cannot be parsed


[02/24/2022 12:40 PM] lgd#5847
Ok thanks


[02/24/2022 11:12 PM] lgd#5847
so the flag is already set to true...


[02/27/2022 12:45 PM] morphic#4133
then, I don't know, maybe the bytes are botched in some other way


[02/27/2022 8:12 PM] lgd#5847
I changed my contract such that i only need to call substConstants once, so everything works by doing that. The issue seems to be with the output bytes from the function, which can't be used again in another call with substConstants(). Idk


[03/02/2022 1:31 PM] kii#8888
Yes you can. You get the addresses bytes and then store it in the register as coll[byte]


[03/06/2022 4:03 PM] quokka#1273
#‚ùì‚îÇergoscript-support lookin for someone who can audit a couple of contracts at SkyHarbor!

{Reactions}
Siren2 üëçüèª 

[03/07/2022 6:21 PM] ergodevv#2308
Hi guys, as I learn more about Ergo and eUTXO in general it seems to me that there are some design patterns which would require scanning of the eUTXO set offline. While I could write a manual scanner, I wanted to know if there are any utilities already present which do that and are easy to extend/modify.


[03/08/2022 11:51 AM] glasgowm#9381
https://github.com/ergoplatform/scanner

{Embed}
https://github.com/ergoplatform/scanner
GitHub - ergoplatform/scanner: Ergo Blockchain Scanner
Ergo Blockchain Scanner . Contribute to ergoplatform/scanner development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/iHn9ETflm_LoNHK-H_gEDjaXUF_MVOX6Rcn1_S0MR8s/https/opengraph.githubassets.com/97a521185cbabc9b16c7683bde69c6685de33ed75a860c036d39e76c980724e0/ergoplatform/scanner


[03/11/2022 2:51 PM] Luivatra#9076
Started building test cases for a new vesting contract
https://github.com/ergo-pad/ergopad-api/blob/nft-locked-vesting/app/test/test_vesting.py

{Embed}
https://github.com/ergo-pad/ergopad-api/blob/nft-locked-vesting/app/test/test_vesting.py
ergopad-api/test_vesting.py at nft-locked-vesting ¬∑ ergo-pad/ergopa...
backend. Contribute to ergo-pad/ergopad-api development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/sS7ir4atCzvd6QQ23hHhfnJxPVnU-PquAjCDb8gDxxA/https/opengraph.githubassets.com/bf6163f625f32072b099bfecf9238d84f17cd03ed9b2cae48b8b9b2103f35586/ergo-pad/ergopad-api

{Reactions}
üëç (2) üëçüèª 

[03/11/2022 3:46 PM] ergodevv#2308
perfect, thanks


[03/15/2022 8:14 AM] MrStahlfelge#0042
wow you really made use of the python bridge üôÇ I love this class https://github.com/ergo-pad/ergopad-api/blob/nft-locked-vesting/app/ergo/appkit.py


[03/15/2022 8:38 AM] Luivatra#9076
Yeah when it is a bit more fleshed out we will separate it so it is easy to reuse for others

{Reactions}
ergo_orange (2) 

[03/16/2022 2:26 PM] morphic#4133
Awesome! Just curious, why ErgoValueT is needed? Any issues with using ErgoValue from Appkit directly?


[03/16/2022 2:37 PM] Luivatra#9076
Some issues with types not matching. Python uses int for everything so ErgoValue.of(myInt) will fail cause it doesnt know wh7ch type to pick. Might be something in the appkit we can use instead of ErgoValueT though


[03/16/2022 2:41 PM] morphic#4133
Ah, using overloaded method names was a bad idea for interoperability. You can construct ErgoValue directly using generic constructor https://github.com/ergoplatform/ergo-appkit/blob/8f904abee8f6bd41c5f23a2273c5e9dbe499c233/common/src/main/java/org/ergoplatform/appkit/ErgoValue.java#L27


[03/16/2022 2:55 PM] Luivatra#9076
Ok, cool will have a look if that makes more sense


[03/19/2022 8:58 AM] Ch1n3du#7350
I wanted to ask it I have an ergoscript where I try to access a value in R4-R9 of a box and it doesn't exist does the script automatically fail


[03/19/2022 8:59 AM] Ch1n3du#7350
Asking because I'm trying to understand the use of .isDefined


[03/19/2022 10:41 AM] SoCool#6419
I think it will evaluate the whole script straight to to false, I believe I read someone commenting they had to use lots of ifs to protect against situations like that. Cannot confirm, am not ergoscript person


[03/19/2022 3:23 PM] Ch1n3du#7350
Thank you


[03/19/2022 3:29 PM] Ch1n3du#7350
I wanted to ask anyone could please review my code ```scala {
    // Ergoscript for a shared donation Address
    // Only allows withdrawal if box is spent according to agreed upon ratios to
    
    // @notice Total sum of share ratios
    val ratioTotal = $total
    
    // @desc Pairs of Address Hashes(Coll[Byte]) and their share ratio (Long)
    val pairs = $pairs

    // @desc Donor Address in case of
    val donorRefund = SELF.R4[SigmaProp].get

    // @notice Check to ensure correct no of outputs
    val validNoOfOutputs = OUTPUTS.size >= pairs.size

    // @notice Check if individual output is valid
    def isValidOutput = { (blob: (Box, (Coll[Byte], Long))) => 
        val outBox = blob._1
        val pair   = blob._2

        val correctAddress = pair._1 == blake2b256(outBox.pubKey)
        val correctAmount  = outBox.value >= ((pair._2 * SELF.value) / ratioTotal)

        correctAmount &&
        correctAddress
    }

    val allOutputsValid = {
        OUTPUTS.zip(pairs).forall(isValidOutput) &&
        validNoOfOutputs
    }

    SigmaProp(allOutputsValid || donorRefund)
}
```


[03/21/2022 6:06 PM] ilya | dappstep#9261
A question. If someone can create a transaction like that from his wallet to a smart contract that, lets say, mint a token. Can he reverse the transaction once the token has minted and sent to the address? Should SC do extra checks to protect from those scenarios? Is it a right chat to ask about that üòÖ

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/955527751006298112/62FAED76-C042-42FB-A4F4-D0B4FA0F9E0F.jpg


[03/21/2022 7:00 PM] Pulsarz#9208
If I'm reading it correctly, the box simply can't be spent by the user in the first 24h but someone with the other private key CAN spend it instead of the user (so the pool owner can spend the boxex themselves in the first 24h)


[03/21/2022 7:01 PM] Pulsarz#9208
Pretty sure it wouldn't work when creating a tx like that and send it to a smart contract, since the box can't be spent by it


[03/21/2022 7:01 PM] Pulsarz#9208
no spending -> no interaction


[03/21/2022 7:01 PM] Pulsarz#9208
"reversible" isn't really the best term for such a thing I think


[03/25/2022 4:47 PM] pgwada#0227
Can we use stainless framework for verification of Ergo script contract? Any handy examples?

{Reactions}
üëç (2) 

[03/28/2022 2:08 AM] Krasavice Blasen#4574
Is it possible to simply check if a register is defined in ergoscript with unknown type?


[03/28/2022 7:01 AM] greenhat#6562
@PG I'm glad you asked. üôÇ Two years ago I spent a few months prooving some properties of the contracts in Stainless - https://github.com/ergoplatform/ergo-contracts 
I had success with some simple properties but failed with more complex ones. The main obstacle was ErgoScript ops have to be prooved first.

{Embed}
https://github.com/ergoplatform/ergo-contracts
GitHub - ergoplatform/ergo-contracts: Contracts for Ergo with verif...
Contracts for Ergo with verified properties. Contribute to ergoplatform/ergo-contracts development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/OZ_yiQm-T2SXddBD5nAktA8tI8XKp0pIyt_Y9XmgUuE/https/opengraph.githubassets.com/348fbec2f3fdafc9ffcf6baffe6e9bdc94d21cdef796f18f909415a715a43dd2/ergoplatform/ergo-contracts

{Reactions}
üëç (2) 

[03/28/2022 12:52 PM] Krasavice Blasen#4574
nvm I see the Any type can be used


[03/29/2022 5:49 AM] pgwada#0227
Thanks a lot. I think i will be implementing my validator design first on Ergo. If i can formally verify my contract on Ergo then i can move the design to Cardano. Atleast that way i can be certain that the design is flawless (i should say atleast not criticial flaws üôÇ )


[03/31/2022 7:16 PM] Galim81#0252
I am looking for an Ergo Script dev to do some paid consultancy work over the next few weeks. 

What I am looking for is a breakdown of how complicated it will be to create 2 smart contracts and a trading bot. (Time taken to code, cost, complexity etc..) 

Short version of the project is bringing something akin to Olympus pro to Ergo. (Smart contract 1) Smart contract 2 is an evolution of that process that offers more flexibility to projects around building treasury and liquidity. 

I have funding, business development, community, and web development resources in place. Ergo script expertise is the final piece of the puzzle to progress this.  

The information from this consultation will be used to complete the pitch deck and feed into the business plan. The Dev that does the consultancy work will be first refusal to take up the lead dev position on the project and receive a revenue share. 

There will not be a token created for this project. Ever.

{Reactions}
üëçüèª 

[04/05/2022 10:52 PM] kushti#0978
P2S address encodes an ergo tree indeed

{Reactions}
üôè üëç 

[04/05/2022 10:55 PM] kushti#0978
possible to store pubkeys or scripts in registers


[04/06/2022 12:17 AM] kushti#0978
"We have a Coll of Ints and iterate top of it using forall but raised this exception in sign tx:

scalan.Base$StagingException: Error in Evaluation.compile.evaluate(s653 -> Placeholder(BaseElemLiftable<Int>))

The Script is:

  val UTPs: Coll[Coll[Byte]] = SELF.R4[Coll[Coll[Byte]]].get
  val selectedIndices = UTPs.indices.slice(1, UTPs.size)
  val checkAllBoxes = selectedIndices.forall {
    (index: Int) => {
      val box: Box = OUTPUTS(index - 1)
      val UTP: Coll[Byte] = UTPs(index)
      val isBoxUTP = true // box.R4[Coll[Coll[Byte]]].get == Coll(UTP)
      val isBoxContract = box.propositionBytes == OUTPUTS(0).propositionBytes
      if(box.R4[Coll[Coll[Byte]]].isDefined){
          (box.R4[Coll[Coll[Byte]]].get == Coll(UTP))
      } else {
        false
      }
    }
  }

The problem occurs when using int as index for UTPS or OUTPUTS with iterable function (forall and map tested)"

@morphic why is that? Short type also does not work


[04/06/2022 1:59 AM] Krasavice Blasen#4574
Yeah I had the same issue as this some time ago


[04/06/2022 9:11 AM] morphic#4133
it is hard to tell the root cause of the exception without a stack trace, but most likely it is due to non-constant index expression. Accessing collection of boxes is only possible using constant indexes or context variables like  `OUTPUTS(getVar[Int](1).get)`


[04/06/2022 9:12 AM] morphic#4133
Limitation of AOT costing in v4


[04/08/2022 7:13 AM] 6directions#1089
Where/how is the ErgoTree stored on chain?

Also, is a P2PK address an encoded PK?


[04/08/2022 2:00 PM] MrStahlfelge#0042
It is the address that is the encoded ergotree.
Yes, p2pk address is encoded public key.

{Reactions}
üëç (2) üôè 

[04/10/2022 12:38 AM] 6directions#1089
Is there a way of working with date/time in ErgoScript other than with block height?


[04/10/2022 12:43 AM] Cheese Enthusiast#0548
Each block header has a timestamp in milliseconds after the unix epoch

{Reactions}
üëç (3) üôè 

[04/10/2022 1:59 AM] 6directions#1089
is there a way to reference constants in scripts from the ergoscript playground? https://wallet.plutomonkey.com/p2s/


[04/10/2022 2:09 AM] Cheese Enthusiast#0548
You can probably emulate them by just hardcoding them into the contract. The value of the constants change the script address anyway, so I'm not sure that there is any use in trying to get the P2S address from playground.


[04/10/2022 2:13 AM] 6directions#1089
gotcha. and fair point. was just tinkering with the playground and wondered about that.

{Reactions}
üëç 

[04/11/2022 9:29 AM] MrStahlfelge#0042
Check the auction house contract for an example


[04/11/2022 10:04 AM] kii#8888
```
let script = template
        .replace('$userAddress', userTree)
        .replace('$ergAmount', ergAmount)
        .replace('$toAddress', userTree)
        .replace('$artworkType', encodedAssetType)
        .replace('$curHash', artworkHash64)
        .replace('$issueAmount', quantity)
        .replace('$timestamp', moment().valueOf())
        .replaceAll('\n', '\\n');
    return p2s(script);
```

Using moment().valueOf()?


[04/11/2022 10:09 AM] MrStahlfelge#0042
It is the Unix timestamp in milliseconds


[04/15/2022 3:06 PM] Omnia#7128
hello, does ergoscript support iterator? now that in ergoscript loop and recurse are not allowed, how can I sum one of the register's value of all inputs in one transaction to verify something? thanks.


[04/15/2022 3:22 PM] scalahub#2618
See the section functional programming https://node.stokvel.africa/a-quick-primer-on-ergoscript

{Embed}
https://node.stokvel.africa/a-quick-primer-on-ergoscript
A Quick Primer on ErgoScript
https://images-ext-2.discordapp.net/external/mxHg1-atIAtjXksB6aAV3Wrr5CiOVVBS0OOD2gKfkxY/%3Fcolor%3D%2523F77D05%26logo%3Dhttps%253A%252F%252F2242232434-files.gitbook.io%252F~%252Ffiles%252Fv0%252Fb%252Fgitbook-x-prod.appspot.com%252Fo%252Fspaces%25252F-Ml61MTY6C6-fCHzZprE%25252Ficon%25252F8EFhQ1nK2qhoFDh6p4G4%25252Fergo2.png%253Falt%253Dmedia%2526token%253D1679fe06-4538-45a4-b1c5-ffcb72160477%26theme%3Dnone/https/app.gitbook.com/share/space/thumbnail/-Ml61MTY6C6-fCHzZprE.png


[04/15/2022 3:28 PM] Omnia#7128
thanks, it seems fold function works.

{Reactions}
üëç 

[04/15/2022 6:43 PM] Pulsarz#9208
wow, this is really usefull


[04/15/2022 6:43 PM] Pulsarz#9208
thanks


[04/15/2022 6:55 PM] glasgowm#9381
What is this website? ü§î Seems to be mostly the Ergo git wiki + some other wee things added


[04/15/2022 6:55 PM] glasgowm#9381 (pinned)
https://docs.ergoplatform.com/dev/scs/ergoscript/


[04/15/2022 6:56 PM] glasgowm#9381
Pinned a message.


[04/17/2022 2:25 AM] Omnia#7128
hello, does ergo utxo support script reference? the utxo contains a reference to a script stored in another place on chain rather than directly contains the script code.


[04/17/2022 10:00 AM] MrStahlfelge#0042
I have a question regarding usage of data inputs. The data input boxes are only valid when unspent. What is when there is a transaction in mempool spending the box that I want to use as data input? is a transaction I submit with this box as data input still valid as long as the transaction spending it is not confirmed, or should I better use (in case of an oracle) the new box?
Since oracles renew their box fairly often, this case can happen a lot


[04/17/2022 1:57 PM] scalahub#2618
Not sure who owns it.. found it via Google search


[04/17/2022 2:02 PM] scalahub#2618
If the box is unspent at time of usage, it should be fine.. good point about the  Oracle pool. Maybe we can add "receipt" boxes that live forever


[04/17/2022 2:34 PM] Omnia#7128
the data input is designed to be used many times, isnt it?


[04/17/2022 4:11 PM] Omnia#7128
if the address in R1 is p2sh, where is the real guardscript stored?


[04/17/2022 5:03 PM] scalahub#2618
yes multiple times, in same block in many transactions


[04/17/2022 5:03 PM] scalahub#2618
For p2sh, the script is not stored, only the  hash is stored. Script should be supplied at spending


[04/17/2022 11:42 PM] Omnia#7128
yes, I mean when spending, how and where to supply this script? in the transaction or anywhere else?


[04/18/2022 7:02 AM] soysor#6001
is there plans to add support for import statements and stuff? Came across this: https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/sigmastate/src/main/scala/sigmastate/lang/syntax/Core.scala#L63


[04/18/2022 8:42 AM] scalahub#2618
Its supplied in the tx as a context variable.


[04/18/2022 9:28 AM] Omnia#7128
can you tell me which context variable I should put in, thanks


[04/18/2022 10:20 AM] scalahub#2618
I think its variable with id 0.. but I've not played with p2sh.. Hope someone else can comment.. @morphic ?


[04/18/2022 10:24 AM] Omnia#7128
do you know any place to find the whole spec for context data?


[04/18/2022 1:26 PM] scalahub#2618
See if anything can be found here https://ergoplatform.org/docs/ErgoTree.pdf or else would need to look at source code and tests


[04/18/2022 2:25 PM] Omnia#7128
this paper has nothing related to context, just the bytecode alike things


[04/18/2022 2:30 PM] Omnia#7128
but still thank you and I will be searching in this paper for more clues.


[04/18/2022 2:33 PM] Omnia#7128
just so curious about where to load the script for a input box using p2sh when verifying the spending.


[04/18/2022 5:31 PM] morphic#4133
No concrete plans. How imports would be useful?


[04/18/2022 5:34 PM] morphic#4133
At the time of spending the script should be in context variable 1 (i.e. accessible as  getVar[Coll[Byte]](1).get)

{Reactions}
üëç 

[04/18/2022 5:39 PM] morphic#4133
Each input of a signed transaction is represented by this class https://github.com/ScorexFoundation/sigmastate-interpreter/blob/b3695bdb785c9b3a94545ffea506358ee3f8ed3d/sigmastate/src/main/scala/org/ergoplatform/Input.scala#L34
It contains ContextExtension https://github.com/ScorexFoundation/sigmastate-interpreter/blob/83c428146d07b070a1fd4c52cc488258d1222d96/sigmastate/src/main/scala/sigmastate/interpreter/InterpreterContext.scala#L23
See description.


[04/18/2022 11:29 PM] Omnia#7128
so the script will be automatically loaded and executed when verifying the input box based on the p2sh?


[04/19/2022 2:54 AM] soysor#6001
I haven't used ergoscript a lot so not sure if the following is valid but some ideas

I imagine it would be useful for sharing common functionality - devs won't need to copy+paste or reimplement functions, less possiblity for bugs. In ETH there's projects that allow importing solidity scripts from github/npm, we could have a repo that contains common functions that are known to be implemented correctly that can be easily shared

I ask because I had an idea to create a ergoscript bundler (like webpack for ergoscript) that would support things like imports and namespacing. But yeah, not sure how useful it would be to Ergo


[04/19/2022 3:13 AM] Omnia#7128
imo, the import statement should be supported in the appkit and now is supported using scala, all the on-line code are constants, values, no variables, so all the code can be determined when building the transaction. so there is no need for the ergoscript to use import statement, because you can do this like you are using a template to build a dynamic web page,all the work is off-chain using the appkit. ergoscript is not solidity, all you do in the ergoscript is to prove something, secure the action you did off-chain is correct.


[04/19/2022 3:18 AM] Omnia#7128
but a wrapper for producing the real ergoscript from some common design patterns is indeed needed, I think. just like the template and render engine in the webpage.

{Reactions}
üëç (2) 

[04/19/2022 3:37 AM] soysor#6001
Yeah good point, templating contracts is probably a easier route than supporting import statements

To be clear how I imagined the import statement working was at compile time the compiler resolved the imports and included them in the final ergotree, imports wouldn't happen on-chain or whatever


[04/19/2022 3:42 AM] Omnia#7128
Yeah, understood


[04/19/2022 3:46 AM] Omnia#7128
but if using a import or include method, how to assign the real value to those variables in the included functions or anything else, that is a question, maybe a tag is still needed and then its a template again.


[04/19/2022 3:48 AM] Omnia#7128
or just import them without change?


[04/19/2022 4:10 AM] soysor#6001
i think importing them without change could work if import resolution is one of the first stages in compilation, time to make `ergoscript-linker`  üò¨


[04/19/2022 4:22 AM] soysor#6001
Global ergo variables should just work in imports (like `OUTPUTS`), I think they're set at eval time

If there's custom variables required by imports at compile time then I guess its up to the user to ensure they exist


[04/19/2022 5:37 AM] Omnia#7128
if so, a template is really more suitable for this situation imo.ü§î


[04/19/2022 6:44 AM] lgd#5847
If anyone uses VS Code as an editor, I made an unofficial VS Code extension. It's super basic and only does syntax highlighting:
https://marketplace.visualstudio.com/items?itemName=guapswap.vscode-ergoscript-language-support

You can also search for "ErgoScript Language Support" in the Extension tab of the desktop app.

{Embed}
https://marketplace.visualstudio.com/items?itemName=guapswap.vscode-ergoscript-language-support
ErgoScript Language Support - Visual Studio Marketplace
Extension for Visual Studio Code - Language support features for ErgoScript in VS Code
https://images-ext-2.discordapp.net/external/VAnlZ23f6BeUGAHJNZ2YpyQ-rj8sRY18ZbqZHyvBc6o/https/guapswap.gallerycdn.vsassets.io/extensions/guapswap/vscode-ergoscript-language-support/0.2.0/1650346070489/Microsoft.VisualStudio.Services.Icons.Default

{Reactions}
üëçüèª 

[04/19/2022 8:32 AM] Omnia#7128
the ergoscript is mostly wrapped by "", the syntax highlighting still work?


[04/19/2022 8:33 AM] lgd#5847
you don't wrap it in "" for this. you can add it after you finish writing the contract


[04/19/2022 8:38 AM] Omnia#7128
so this plugin now only works in a single ergoscript file? still great work for ergo


[04/19/2022 8:40 AM] lgd#5847
yeah, you could make a file with .ergoscript for example, and write your contract. then put "" and use in your project wherever. super basic for now, not perfect


[04/19/2022 8:41 AM] Omnia#7128
great


[04/19/2022 9:09 AM] morphic#4133
yes, the exact logic of verification Pay2SH address is here https://github.com/ScorexFoundation/sigmastate-interpreter/blob/48cc739a77ca884456ed56759ce7b09f816a140b/sigmastate/src/main/scala/org/ergoplatform/ErgoAddress.scala#L160
Note, that Ergo protocol has no idea about Pay2SH addresses, in fact it has no idea about ANY address. Each box contains ErgoTree which should be evaluated to `true` in order for the box to be spent. 
Addresses is just a representation convenience. Some of the ErgoTrees we call Pay2PK address, some of them (see the url) we call Pay2SH address and everything else we call Pay2Script. This is for convenience of app development and due to bitcoin terminology. We can come up with new types of addresses, which reflect some Ergo specific features and my be usefull in app developement.


[04/19/2022 9:11 AM] morphic#4133
As an example, we can introduce Pay2SigmaProp address, which is generalisation of Pay2PK, where simple simple ProveDlog proposition is generalized to arbitrary sigma proposition provable via sigma protocol (aka SigmaBoolean proposition)
This is very specific kind of ErgoTrees.


[04/19/2022 9:22 AM] Omnia#7128
thanks for this detailed explanation, can you tell more about "getVar[Coll[Byte]](1).get"? especially the id number (maybe called index) "1",why "1"? as I understand, all the input utxo's raw serialized original script bytes are stored in context var and could be loaded an executed automatically, but what "1" means? does every input uxto have its own context or all the utxos share the same context? thanks...


[04/19/2022 9:51 AM] morphic#4133
id number 1 was chosen arbitrarily, the exact id is not important for the logic of the contract. But, if you use another scriptId then you will not be able to use Pay2SHAddress class as a convenience wrapper about the specific ErgoTree.


[04/19/2022 9:52 AM] morphic#4133
This is what you have in each UTXO box https://github.com/ScorexFoundation/sigmastate-interpreter/blob/0fa0448ee41012891a28eaca92bcc768234bd08f/sigmastate/src/main/scala/org/ergoplatform/ErgoBox.scala#L51


[04/19/2022 9:52 AM] morphic#4133
And this is what is available in the context https://github.com/ScorexFoundation/sigmastate-interpreter/blob/9e96cf4f3815b1a8a711c1e4969158b86f3857ee/sigmastate/src/main/scala/org/ergoplatform/ErgoLikeContext.scala#L52


[04/19/2022 9:54 AM] morphic#4133
The boxes are stored in UTXO, the context is created on the fly for each input of a transaction and never stored. It is synthetic data structure.


[04/19/2022 9:55 AM] morphic#4133
Each ErgoTree can be thought of as a function from Context to SigmaProp https://github.com/ScorexFoundation/sigmastate-interpreter/blob/83c428146d07b070a1fd4c52cc488258d1222d96/sigma-api/src/main/scala/special/sigma/SigmaDsl.scala#L268


[04/19/2022 9:58 AM] morphic#4133
context variables (see ContextExtension) are stored in transaction (as part of SignedInput) and automatically added to the Context when it is created for the input being verified.


[04/19/2022 9:58 AM] Omnia#7128
yeah, I am looking through the ErgoLikeContext.scala, and I find the context is constructed for each input utxo, the order or sequence of the input and output utxos in each context is assigned at the same time. but I am not sure whether this understanding is right.


[04/19/2022 10:03 AM] morphic#4133
Well, if you see it in the sources then your understanding is right. Sigma and Ergo sources is the ultimate source of truth. üôÇ


[04/19/2022 10:09 AM] morphic#4133
BTW, if you find something unclear in the Sigma source, you can write your question directly in the source code as a TODO. (like `// TODO question: what is the meaning of this field?`)
Then you can create a PR with all the questions. I will merge it first and then answer in a separate PR by adding necessary clarifications.
This way others will benefit in future.

{Reactions}
üëç (6) 

[04/19/2022 10:21 AM] Omnia#7128
It seems I am wrong, hah, the sequence of boxes are defined in the process of building transaction and the context for each input utxo is constructed in the runtime. thanks.


[05/05/2022 8:22 PM] SoCool#6419
This is rather primitive but where in the output box do you put the address to send the box? ErgoTree?


[05/05/2022 8:22 PM] SoCool#6419
I really need to just stop being a lazy shit and read the ergoscript docs


[05/05/2022 8:29 PM] Cheese Enthusiast#0548
The address is just a representation of the contract, which eventually boils down into an ErgoTree


[05/05/2022 8:30 PM] Cheese Enthusiast#0548
Its stored in one of the registers of the box, but in something like appkit you'd usually just do .setContract or something similar


[05/05/2022 8:30 PM] SoCool#6419
Right, so I realized before addresses are ErgoTrees (which are contracts - thanks to the tiny bit of reading in the docs I did do). I guess I should have realized then that to send to an address simply means to place the ErgoTree onto the box


[05/05/2022 8:30 PM] SoCool#6419
One of the registers? Really? Perhaps I misunderstood then, though I'm looking at the JSON representations


[05/05/2022 8:30 PM] Cheese Enthusiast#0548
Yea, think of an address as as a way to find boxes with the same guard script / ergo trees.


[05/05/2022 8:30 PM] SoCool#6419
ErgoTree is independent in the JS representation


[05/05/2022 8:31 PM] Cheese Enthusiast#0548
It's one of the non-arbitrary registers, something that must be set for each box for it to be valid. Its like R1 or R2 I believe


[05/05/2022 8:32 PM] SoCool#6419
Cool, thanks! So that's two pieces of information I'll try (and fail) to retain; ErgoTree is the address to send to, and in the primitive ErgoScript you put that into R1 or R2 (read docs to find out)


[05/05/2022 8:35 PM] Cheese Enthusiast#0548
Yeah in general you never actually set R0 - R3, the node usually handles that stuff. I would say the address is more a representation of the ErgoTree rather than the ErgoTree itself, but that's more a technicality


[05/05/2022 8:37 PM] SoCool#6419
Right, I was just looking at making a TX from scratch to submit to the node and wasn't certain where to put the address to send the boxes in the TX


[05/10/2022 1:21 AM] lgd#5847
is this a recursive definition so T1 or T2 could also be `(_,_)`?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/973379195843530792/Screen_Shot_2022-05-09_at_8.20.41_PM.png


[05/10/2022 3:54 AM] Cheese Enthusiast#0548
Yea, you can treat it similar to a Coll, in that you can have Coll's of Coll's. Likewise you can have pairs of pairs.

{Reactions}
üëç (2) 

[05/18/2022 8:33 AM] ilya | dappstep#9261
Hi! what would be a *safe* way to work with time in ergo script?
I have 3 steps smart contract:
First TX user locks an asset with `R6` storing the height delta. Let's say `3`
In second I modify the locked box by adding  `R8` which includes `HEIGHT + R6` 
This is how I do it currently:
`OUTPUTS(0).R8[Int].get == INPUTS(0).R6[Int].get + HEIGHT`

And third step is unlock the box once `INPUTS(0).R8[Int].get < HEIGHT` which is an easy part

`OUTPUTS(0).R8[Int].get == INPUTS(0).R6[Int].get + HEIGHT` from the step two seems not working for me correctly. probably because of `HEIGHT` changes fast. (?? not sure this is the reason)
I was thinking to have some kind of range, something like `OUTPUTS(0).R8[Int].get > INPUTS(0).R6[Int].get + HEIGHT - offset && OUTPUTS(0).R8[Int].get < INPUTS(0).R6[Int].get + HEIGHT + offset` 

1. Is it a correct approach? If yes, what would be the good offset? How many blocks is there in an hour/day
Are there any better ways to do that?


[05/18/2022 9:04 AM] ilya | dappstep#9261
Also what's the difference between creationHeight and settlementHeight?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/976394741526700062/unknown.png


[05/18/2022 9:12 AM] MrStahlfelge#0042
check out how ergo auctions contract works with time. there is a timestamp available which saves you from thinking in block times.


[05/18/2022 9:15 AM] MrStahlfelge#0042
when a box is created off-chain, it needs to have set a block height. this height must not be higher than the current's preheader height but it may be lower. this happens for example when using the cold wallet: the block height is set to the height when the transaction is built, but until the user signs and uploads to the network new blocks might be mined.
also, any the transaction could wait before included into blocks and might not be included in the next block. in all these cases, settlement height is higher than creation height

{Reactions}
üôè 

[05/18/2022 9:22 AM] ilya | dappstep#9261
Thank you @MrStahlfelge I'll check


[05/18/2022 10:40 AM] ilya | dappstep#9261
@MrStahlfelge Not sure I can use the timestamp in a trustless way.
This is my flow
1. first tx - Owner list a token "for rent" So there is R6 with **delta** time representing the rent period. 
2. second tx - Renter send ERG to the owner and edit the token box by adding R7 with current timestamp + delta from R6. this is how the rent starts. 

I can't trust the renter that the timestamp he used in the rent transaction is the real current timestamp and not something in a far future.


[05/18/2022 10:58 AM] MrStahlfelge#0042
true, I would suggest that you work with a grace period. currentTimeStampByRenter < CONTEXT.preHeader.timestamp + gracePeriod


[05/18/2022 11:58 AM] ilya | dappstep#9261
Oh, cool, I can basically work with timestamps but validate that the rentPeriodEndTimestamp is not higher then CONTEXT.preHeader.timestamp + gracePeriod + R6rentPeriod


[05/18/2022 9:11 PM] ilya | dappstep#9261
Getting  type error when doing this

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/976577813861765200/unknown.png


[05/18/2022 9:11 PM] ilya | dappstep#9261


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/976577915946926200/unknown.png


[05/18/2022 9:12 PM] ilya | dappstep#9261
Please advice


[05/19/2022 3:18 AM] Krasavice Blasen#4574
Try putting CONTEXT.preHeader.timestamp in its own val, like
```
val time = CONTEXT.preHeader.timestamp
val leftRange = INPUTS(0).R6[Long].get + time - gracePeriod```


[05/19/2022 3:28 AM] Krasavice Blasen#4574
Im looking to exponentiate a value in the following way:
x ^ (2^n)
Ive drawn inspiration from a similar post here by cheese enthusiast: https://discord.com/channels/668903786361651200/849659724495323206/919623211728125952
Which allowed me to write the following solution:
```val myCol = OUTPUTS(0).R4[Coll[Byte]].get // Collection of n dummy values
val ans = myCol.fold(x, {(z: Long, base:Int) => z * z}) // Square x n times ```
However, notice that the collection is pretty useless. (Its only used to specify how many operations on z I would like to do, using the collection size)
Is it possible to do a repeated action (like squaring, modulo operations or anything you might want to repeat) without instantiating a collection of n dummy values? 
Using a collections also limits me to only 255 repeated actions (since I think the max collection size is 0xff), so another method could open up more possibilities.


[05/19/2022 6:13 AM] ilya | dappstep#9261
That helped! Thanks!


[05/19/2022 6:21 AM] ilya | dappstep#9261
Is it possible to check the NFT mint address from the SC?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/976716166825377802/unknown.png


[05/19/2022 6:21 AM] ilya | dappstep#9261
If I want SC to guard only tokens with specific mint address


[05/19/2022 6:25 AM] Krasavice Blasen#4574
Not really, but you can check the issuance address


[05/19/2022 6:26 AM] Krasavice Blasen#4574
i.e. the address that issued the token which may or may not be the mint address


[05/19/2022 6:31 AM] ilya | dappstep#9261
@Krasavice Blasen Can you give an example please when issuance address would be different from mint address?


[05/19/2022 6:32 AM] ilya | dappstep#9261
Let's say I mint a token on AH. What would be issuance address in that case?


[05/19/2022 6:32 AM] Krasavice Blasen#4574
Anything minted on AH. The issuance address is the AH smart contract but the mint address is the first p2pk that paid the AH contract


[05/19/2022 6:33 AM] ilya | dappstep#9261
Ah got you. So I can't rely on that issuance address will stay the same for future mints


[05/19/2022 6:33 AM] Krasavice Blasen#4574
Yeah issuance address on AH is unique for each mint due to the timestamp I think


[05/19/2022 6:34 AM] Krasavice Blasen#4574
In future, when we have the collection standard you should be able to evaluate whether an NFT belongs to a collection in Ergoscript


[05/19/2022 6:36 AM] ilya | dappstep#9261
Thanks for the explanation!


[05/19/2022 2:09 PM] Cheese Enthusiast#0548
I don‚Äôt think there is a way to loop this function without instantiating a collection at some point. 

The only possible thing I can think of is to create a self replicating box to exponentiate multiple times, but this seems like an overly complicated solution.


[05/19/2022 2:09 PM] Cheese Enthusiast#0548
However, I‚Äôm quite sure collections can hold more than 255 elements. For example, I‚Äôve dealt with contracts whose prop bytes are over 1200 bytes (or elements) long. With that in mind, using collections should let you perform a reasonable number of iterations on any code in your contract.


[05/19/2022 2:15 PM] Krasavice Blasen#4574
Self-replicating box? As in carrying out the calculations over multiple txs?


[05/19/2022 2:16 PM] Krasavice Blasen#4574
ah ok, I assumed that the max was 255 since I thought the encoding only allocated a single byte to define collection size, Ill check out if I can encode something bigger then


[05/19/2022 2:40 PM] Cheese Enthusiast#0548
Exactly, you could design a special contract that performs a function and requires an output of box with the same contract, along with registers that keep track of the number of times the contract has been executed. You may theoretically iterate an arbitrary amount of times while chaining the transactions (which are just iterations over the function of the box's smart contract) in order to quickly determine the end result. Unless I'm forgetting something, this is the only way to loop an arbitrary function *n* times, and I believe this method allows ErgoScript to be turing complete. 

Of course, you would have to pay transaction fees for each iteration, so this method is probably best when the function being iterated is particularly heavy in computation or transaction cost. Otherwise I would just stick to using collections.


[05/19/2022 2:45 PM] Cheese Enthusiast#0548
Collections themselves can definitely be over 255 elements in size. I am not sure if there is some limit or difference in how they end up being encoded after that point though. If I find a box with a large enough collection on the explorer I'll send it and you can analyze if theres an encoding difference.


[05/19/2022 3:15 PM] Krasavice Blasen#4574
Thanks thatd be great!


[05/19/2022 3:18 PM] Krasavice Blasen#4574
Yeah that makes sense, I was planning to do some self-replicating already, but am trying to get the most out each tx :) Thanks for confirming the necessity of the collection to repeat actions and for the insights!


[05/20/2022 6:41 AM] ilya | dappstep#9261
I want to reduce nesting in if statement. Trying to return false on some basic stuff
But seems the compiler doesn't like it

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/977083584647168100/unknown.png
https://cdn.discordapp.com/attachments/849659724495323206/977083584903004170/unknown.png


[05/20/2022 9:47 AM] greenhat#6562
I'm pretty sure we don't have return.


[05/20/2022 9:48 AM] ilya | dappstep#9261
Isn't it like scala? How do you stop the execution of the function in a middle? or it has to be fully wrapped in if..else


[05/20/2022 10:02 AM] greenhat#6562
Yes, but without the imperative parts. The only statement in ErgoScript is an assignment (`val`) everything else must be an expression. 
Yes, wrapping in if..else is one option, another, is to use AND/OR/etc. bool ops.


[05/20/2022 11:17 AM] ilya | dappstep#9261
Thanks for the explanation!


[05/20/2022 3:28 PM] nitram147#5106
Is there a simple way how to enforce burning of NFT contained in box via ErgoScript when spending this box (there are not assumptions about the box content - it can contain any amounts of different tokens together with the NFT)? üôÇ


[05/20/2022 4:29 PM] Cheese Enthusiast#0548
The box should require that 0 outputs in the spending tx have a token with the NFT's id.


[05/20/2022 4:37 PM] ilya | dappstep#9261
Getting this error when signing tx `Transaction signing error: Prover error (tx input index 0): Evaluation error: Not found: calling Option.get on None`
The exact same Tx works with a simple SC, so I assume it's because how SC is written. with inputs specifically.
Here are some definitions from sc
```
  val defined = OUTPUTS.size >= 3
  val isSendingToSeller = OUTPUTS(1).propositionBytes == INPUTS(0).R4[Coll[Byte]].get
  val isAmountOk = OUTPUTS(1).value == INPUTS(0).R5[Long].get
  // now check that the locked box was modified correctly
  val isOwnerStillSame = OUTPUTS(0).R4[Coll[Byte]].get == INPUTS(0).R4[Coll[Byte]].get
  val isAmountStillSame = OUTPUTS(0).R5[Long].get == INPUTS(0).R5[Long].get
  val isRentalPeriodSame = OUTPUTS(0).R6[Long].get == INPUTS(0).R6[Long].get
  val gracePeriod = 3600000L
  val timestamp = CONTEXT.preHeader.timestamp
  val leftRange =  timestamp + INPUTS(0).R6[Long].get - gracePeriod
  val rightRange = timestamp + INPUTS(0).R6[Long].get + gracePeriod

  val isRentENDHigher = OUTPUTS(0).R8[Long].get > leftRange
  val isRentENDLower = OUTPUTS(0).R8[Long].get < rightRange
  val isSettingEndTimeInAcceptableRange = isRentENDHigher && isRentENDLower
  
  // adding more registers to that box
  val isSettingTheRenter = OUTPUTS(0).R7[Coll[Byte]].get == OUTPUTS(1).propositionBytes
  
  // general purpose stuff
  val isHasRenter = INPUTS(0).R7[Coll[Byte]].isDefined

  val isRentingExpired = INPUTS(0).R8[Long].get < CONTEXT.preHeader.timestamp
  val isSentByOwner = OUTPUTS(1).propositionBytes == INPUTS(0).R4[Coll[Byte]].get

  val isLegitRentingTx = allOf(Coll(
    isSendingToSeller,
    isAmountOk,
    isOwnerStillSame,
    isAmountStillSame,
    isRentalPeriodSame,
    isSettingTheRenter,
    isSettingEndTimeInAcceptableRange
  ))
```


[05/20/2022 4:41 PM] ilya | dappstep#9261
And here is the first input

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/977234499991666778/message.txt


[05/20/2022 4:42 PM] ilya | dappstep#9261
Can anyone advise?
Here are the values I store in Rs
```
// R4 - Owner address
// R5 - Rent price for the whole period
// R6 - Rent period in timestamp delta (eg: month = 1000 * 60 * 60 * 24 * 30)
// R7 - Renter address
// R8 - Rent end timestamp (rent started timestamp + R6)
```


[05/20/2022 5:08 PM] Cheese Enthusiast#0548
You call
```scala
val isRentingExpire = INPUTS(0).R8[Long].get < CONTEXT.preHeader.timestamp
```
But the input box you provided shows that the only registers you have filled are R4 - R6. You need to make sure all the registers you reference in the contract are filled with the correct types and values before executing the contract.


[05/20/2022 5:20 PM] ilya | dappstep#9261
Thanks @Cheese Enthusiast . I want to define all vals in the top and keep the if-else block lean and readable.
Will
‚Äò‚Äô‚Äô
val isRentingExpire = INPUTS(0).R8[Long]. isDefined && INPUTS(0).R8[Long].get < CONTEXT.preHeader.timestamp
```
Make it more fail safe?


[05/20/2022 5:22 PM] Cheese Enthusiast#0548
Probably not, I believe AOT costing means that the .get will be called even if R8 is not defined in that statement. You'll want to make sure each Register you reference is filled with the correct values before spending the box.


[05/20/2022 6:01 PM] ilya | dappstep#9261
@Cheese Enthusiast I've checked and it actually did work. like in other langs if the left part of `&&` expression gets `false` it doesn't proceed to the right part


[05/20/2022 6:02 PM] ilya | dappstep#9261
This solves it. Thanks for the direction! Saved me a lot of time.
```
val isRentingExpire = INPUTS(0).R8[Long].isDefined && INPUTS(0).R8[Long].get < CONTEXT.preHeader.timestamp
```


[05/20/2022 6:26 PM] Cheese Enthusiast#0548
Interesting, didn't know that evaluation stops once it finds the first value to be false. Good to know! üôÇ


[05/20/2022 6:29 PM] C&D Cardboard Games#9820
Good ole and operator lol both have to be true to pass


[05/20/2022 6:29 PM] C&D Cardboard Games#9820
LOL


[05/20/2022 6:47 PM] ilya | dappstep#9261
Yeah the point was not about both have to be true but about whether in runtime it still executes the right hand if the lefhand is false üôÇ


[05/20/2022 6:47 PM] C&D Cardboard Games#9820
Aww. I see.


[05/20/2022 9:02 PM] ilya | dappstep#9261
Assuming my INPUT(0).R4 is storing an nft owner address and `OUTPUT(1)` is ERG that is sent to a this owner.
I want to check that the funds are being sent to a specific address (NFT owner) that is stored in R4. Is it the right way to do that?
`OUTPUTS(1).propositionBytes == INPUTS(0).R4[Coll[Byte]].get`


[05/20/2022 10:07 PM] C&D Cardboard Games#9820
Well I would assume yes.


[05/20/2022 10:07 PM] C&D Cardboard Games#9820
But I am not sure


[05/20/2022 10:43 PM] ilya | dappstep#9261
I‚Äôm just not quite sure what propositionBytes pointing to


[05/20/2022 10:54 PM] Cheese Enthusiast#0548
Proposition Bytes are the bytes representing an ErgoTree / script / address, so if you stored the proposition bytes (not the bytes of the address string) in R4 then this would be correct.


[05/20/2022 10:58 PM] ilya | dappstep#9261
@Cheese Enthusiast I've stored a tree like that. so it's correct?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/977329571529621524/unknown.png


[05/20/2022 10:59 PM] ilya | dappstep#9261
This is how it appear in the transaction


[05/20/2022 10:59 PM] ilya | dappstep#9261


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/977329825884807178/unknown.png


[05/20/2022 11:01 PM] ilya | dappstep#9261
Another question. is `propositionBytes` of output box is the "destination" address or the address or the address this box is currently stored at?


[05/21/2022 1:40 AM] Cheese Enthusiast#0548
You using JS? Not as experienced with that unfortunately. But at least in Scala, yes you can get the proposition bytes of an address by calling its ErgoTree..
If you call proposition bytes on an outbox, it is the address that the outbox will be under. Maybe a better way of saying it is that the propositionBytes represent a guard script attached to each box. If you call propositionBytes on an Outbox, you're simply getting the bytes representing that Outbox's guard script.


[05/21/2022 8:02 PM] liquid_phase#4605
Looking for an ergoscript mentor to bounce my workflow ideas off of to make sure they will work before attempting work on them


[05/21/2022 8:07 PM] ilya | dappstep#9261
Thank you!


[05/21/2022 8:09 PM] ilya | dappstep#9261
Not an expert, but I recently had my aha moment with Ergoscript, can try to help


[05/21/2022 8:14 PM] liquid_phase#4605
Okay thank you!

I am trying to understand the best first step for integrating an ergo payment button on my website, in it's simplest form. I've been given access to a public node, and done a successful GET request to that node to check that its good. Im wondering if i need anything else setup to do en ergo payment? 

my thoughts are thus:
1) enter ergo wallet address as a field on the CMS backend
2) call ergo wallet address into frontend via tags
3) create QR code of wallet address
4) person pays with ergo via their wallet of choice
5) Person is asked for the last 4 digits of their erg address, and then clicks 'I sent the erg' button, triggering GET request to the node confirming if a transaction for said amount came from that address
6)server then re-routes user to download page for the purchase


[05/21/2022 8:15 PM] liquid_phase#4605
would it be easier to do all these steps with a node internally rather than requesting an external node?


[05/21/2022 8:21 PM] ilya | dappstep#9261
What should happen when the user paid? You will allow him to download some digital product? BTW it might be not related to SC, but to ergo explorer. Did you see this repo? Might be exactly what you are looking for https://github.com/ThierryM1212/ergo-pay

{Embed}
https://github.com/ThierryM1212/ergo-pay
GitHub - ThierryM1212/ergo-pay: dApp to integrate ergo payments in ...
dApp to integrate ergo payments in website and application without blockchain knowledge - GitHub - ThierryM1212/ergo-pay: dApp to integrate ergo payments in website and application without blockcha...
https://images-ext-2.discordapp.net/external/_3oMWUYW5Pc9VDHVaOZgCp0bE5IYb4TjZXuEkXsEUeQ/https/opengraph.githubassets.com/c9567bb84c6d6815cc569db5f129d5937de34ffe6a281be0ac3e9a5863fcc89e/ThierryM1212/ergo-pay


[05/21/2022 8:24 PM] liquid_phase#4605
i saw that one - unfortunately their deployed option is a domain/url which no longer works and so it cannot be used in production. and As i am running a fairly custom stack of laravel mix, vue, alpine, etc - i dont want to muck about adding yet another third party javascript library just to run this


[05/21/2022 8:27 PM] ilya | dappstep#9261
Ok, got you. Anyway, let's move the conversation to dev-support. this channel is sc support. If you can just copy the question there üôÇ


[05/21/2022 8:27 PM] NoahErgo#4349
Try this https://thierrym1212.github.io/paymentportal/about.html


[05/21/2022 8:28 PM] liquid_phase#4605
i figured it was still relevant considering an ergoscript expert could analyze the workflow steps and provide a more elegant solution if there was one by running an internal node.


[05/21/2022 8:28 PM] liquid_phase#4605
i will ask there. thank you


[05/21/2022 8:28 PM] NoahErgo#4349
The old link stopped working but this one does ^

{Reactions}
üî• üëçüèª ü•≥ 

[05/22/2022 4:21 PM] nitram147#5106
How to embed fixed data into ErgoScript to make resulting P2S address unique?


[05/22/2022 4:22 PM] nitram147#5106
```scala
{
val unique = something
other part of smartcontract
}
```


[05/22/2022 4:22 PM] nitram147#5106
Because if unique isn't used anywhere it's probably removed by some optimizer when compiled into ErgoTree


[05/22/2022 4:25 PM] nitram147#5106
For example:
```scala
{
  val purpose = something
  sigmaProp(PK("address"))
}
```


[05/22/2022 4:27 PM] nitram147#5106
Should be address on which user will expect some box to be which will indicate something. But it should be unique for every purpose so I want the resulting P2S address to be dependent on the purpose variable


[05/22/2022 6:35 PM] Cheese Enthusiast#0548
So do you need a unique P2S for some arbitrary constant inserted when compiling the script? I've made a sort of hack to do something like this before, this should give a unique script depending on `uniqueConstant` which I assume to be a Coll[Int] in this script (though should work for any type).

```scala
{
  val dummyConstant = Coll(0)
  val uniqueConstant: Coll[Int] = const_uniqueConstant // Inserted at compile time
  val uniqueBool = uniqueConstant == dummyConstant || true // Always evaluates to true
  sigmaProp(uniqueBool) && myPK
}
```


[05/22/2022 6:39 PM] Cheese Enthusiast#0548
Can also play around with it here, to see that changing values in `uniqueConstant` produces unique P2S addresses each time: 
https://wallet.plutomonkey.com/p2s/?source=ewp2YWwgZHVtbXlDb25zdGFudCA9IENvbGwoMCkKdmFsIHVuaXF1ZUNvbnN0YW50ID0gQ29sbCgwLDgsMiw0LDYsNSwwLDApCnZhbCB1bmlxdWVCb29sID0gdW5pcXVlQ29uc3RhbnQgPT0gZHVtbXlDb25zdGFudCB8fCB0cnVlCnNpZ21hUHJvcCh1bmlxdWVCb29sKSAmJiBQSygiOWdiOUh5U3NYcmo3ODE3b1ZXYWlZMk4xaVpUNzhtcDVubVUxd1d2TldQaXJKVXZZM2pCIikKfQ==


[05/22/2022 8:14 PM] nitram147#5106
Yeah, this is what I needed


[05/22/2022 8:15 PM] nitram147#5106
Is it however guaranteed that this ErgoScript will always compile to the same P2S address, or somebody can change the compiler optimizer in the future, thus the compilation of this ErgoScript would result in different ErgoTree (with same semantic)... ? ü§î


[05/22/2022 8:21 PM] Cheese Enthusiast#0548
I think changes that modify existing P2S address compilation could have the potential to break certain projects, so I‚Äôd hope not.


[05/22/2022 8:26 PM] Cheese Enthusiast#0548
I guess it‚Äôd be unlikely that constant comparisons like this would be reduced into boolean values at compile time though. I think that‚Äôd cause issues if someone wanted to use the substConstants method


[05/24/2022 9:43 AM] bombibus#2765
I am new to smart contract using the eutxo model. I am trying to make a SC which mints two tokens A and B, proportiannaly to the amount of ergs deposited. e.g if you sent 100 ergs to the SC, you receive 100 A and 100 B. How would that work ? Can someone give me concrete code ?


[05/24/2022 11:20 AM] MrStahlfelge#0042
smart contracts on ergo are guarding scripts, they don't do anything. so you can have a guarding script checking of not more tokens are minted than allowed based on the amount, but the minting transaction has to be build off chain


[05/24/2022 5:49 PM] bombibus#2765
so first the user mint A and B, then sends all the As, Bs, and the approriate amount of erg to the SC. Then if amount is correct, what happens ? The user can spend the box  ?


[05/24/2022 6:07 PM] MrStahlfelge#0042
I think what you really want is:
You mint a certain amount of tokens and store it on a contract. This contract will allow someone to withdraw x token for y erg. Basically like the AgeUSD contract does.


[05/24/2022 8:00 PM] ilya | dappstep#9261
Hi, would love to get some feedback on that contract, that allows the following operations:
1. Owner to list NFT for rent - basically lock token with R4 - owner address, R5 - renting price, R6 - renting period
2. Owner to withdraw token - if not rented or if renting period has expired.
3. Owner to update listing - if not rented
4. Renter to rent NFT - basically add  to the locked NFT R7 with renter address, R8 - renting period expiration timestamp (NOW + R6), if the correct amount (R5) has been sent to the owner.
5. Renter to renew renting by paying additional rent to the owner. R8 gets updated with (NOW + R6)

https://play.dappstep.com/rent-nft-contract
Any feedback about the current implementation would be helpful as it's my first SC. üôè

{Reactions}
üî• 

[05/25/2022 1:22 PM] glasgowm#9381
@rrd-ergoscript-support


[05/31/2022 3:06 PM] Luivatra#9076
oof, feeling so much frustration that a line like this:
```
val remainingStakePoolTokensAndEmissionDust: Long = stakePoolBox.tokens(1)._2 + (if (SELF.tokens.size >= 2) SELF.tokens(1)._2 else 0L)
```
throws an error when SELF only has 1 token


[05/31/2022 3:18 PM] Cheese Enthusiast#0548
Have you tried using `.getOrElse`? Been using it recently on collections and has been working great for me in terms of how ergoscript handles the conditional


[05/31/2022 3:22 PM] Cheese Enthusiast#0548
For example, I did this to check if a token exists on an OutBox that may or may not have a token on it. Might be able to do something similar in your case.
```scala
OUTPUTS(indexInOutputs).tokens.map{ (token: (Coll[Byte], Long)) => token._2 }.getOrElse(0, -1L) >= tokenAmount
```


[05/31/2022 3:27 PM] Ergo Tipper Bot[BETA]#0902
@Luivatra sent a tip of 10.0 thisguyfucks to @Cheese Enthusiast: awesome, it works!!

{Reactions}
üî• 

[05/31/2022 3:27 PM] Luivatra#9076
just wish I knew before lol


[05/31/2022 3:28 PM] Cheese Enthusiast#0548
Yeah I didn't even know this method existed until like a week ago, would've saved me lots of trouble beforehand


[05/31/2022 3:28 PM] Luivatra#9076
now I need to go through my contracts again and see where I jumped through insane hoops to avoid evaluate errors


[05/31/2022 4:25 PM] MrStahlfelge#0042
man, I spent 2 hours yesterday for this exact case


[05/31/2022 4:25 PM] MrStahlfelge#0042
btw, it is interesting that map works. loops are forbidden, and map is kind of a loop


[05/31/2022 4:30 PM] Cheese Enthusiast#0548
I guess the difference is, it's much easier to calculate the cost on these collection methods vs the cost of a loop. These collection methods all have a set limit on the number of iterations, the size of the collection. But with for and while loops there's always the risk of bad code creating an infinite loop.


[05/31/2022 4:31 PM] MrStahlfelge#0042
yeah, sure, that is the reason. but a map over all boxes can run a long time as well.


[05/31/2022 4:32 PM] Cheese Enthusiast#0548
Heh true, but I guess there has to be some kind of looping mechanism. Imagine trying to code contracts without any sort of looping at all, that sounds like a pain lol

{Reactions}
üíØ 

[05/31/2022 6:10 PM] MrStahlfelge#0042
yeah - morphic told me about the map possibility because I asked him how to design a contract with a flexible outbox order


[05/31/2022 9:55 PM] Luivatra#9076
Can also use fold


[06/22/2022 7:09 PM] George208H#4655
Hello. I would like to create a dapp on Ergo. I have used solidity and remix on Ethereum to deploy contracts. How can I start here?


[06/22/2022 7:29 PM] ilya | dappstep#9261
What‚Äôs your stack?


[06/24/2022 6:59 AM] Krasavice Blasen#4574
Best way to remove a single element from a collection in ergoscript?


[06/24/2022 7:15 AM] greenhat#6562
`Coll` is immutable, so `filter`?


[06/24/2022 7:17 AM] Krasavice Blasen#4574
Yeah, but I only want to remove exactly one instance of the element (there may be duplicates), I know theres probably a way to still do this with `filter` but felt it might be a little messy


[06/24/2022 7:18 AM] Krasavice Blasen#4574
I was thinking of using `updated` but I would need to have the replacement element be None. Is that possible?


[06/24/2022 7:22 AM] greenhat#6562
Nope. It should be the value of element type.


[06/24/2022 7:23 AM] Krasavice Blasen#4574
Alright, I will use `filter` then thanks üôÇ

{Reactions}
üôå 

[06/26/2022 8:10 AM] kii#8888
Trying to compare 2 boxes using a lambda function:
```
    // 1. Repayment Details Check
    def repaymentInputOutputCheck(inputBox: Box, outputBox: Box): Boolean = {
        allOf(Coll(
            outputBox.R4[Coll[Long]].get        == inputBox.R4[Coll[Long]].get,
            outputBox.R5[Coll[Coll[Byte]]].get  == inputBox.R5[Coll[Coll[Byte]]].get,
            outputBox.R6[Coll[Byte]].get        == inputBox.R6[Coll[Byte]].get,
            outputBox.R7[Coll[Byte]].get        == inputBox.R7[Coll[Byte]].get,
            outputBox.R8[Coll[Byte]].get        == inputBox.R8[Coll[Byte]].get,
            outputBox.R9[Coll[Long]].get        == inputBox.R9[Coll[Long]].get
        ))
    }
```

But getting error:
```
Don't know how to evalNode(Lambda(List(),Vector((inputBox,SBox), (outputBox,SBox)),SBoolean,Some(AND(ConcreteCollection(WrappedArray(EQ(Select(Select(Ident(outputBox,SBox),R4,Some(Option[Coll[SLong$]])),get,Some(Coll[SLong$])),Select(Select(Ident(inputBox,SBox),R4,Some(Option[Coll[SLong$]])),get,Some(Coll[SLong$]))), EQ(Select(Select(Ident(outputBox,SBox),R5,Some(Option[Coll[Coll[SByte$]]])),get,Some(Coll[Coll[SByte$]])),Select(Select(Ident(inputBox,SBox),R5,Some(Option[Coll[Coll[SByte$]]])),get,Some(Coll[Coll[SByte$]]))), EQ(Select(Select(Ident(outputBox,SBox),R6,Some(Option[Coll[SByte$]])),get,Some(Coll[SByte$])),Select(Select(Ident(inputBox,SBox),R6,Some(Option[Coll[SByte$]])),get,Some(Coll[SByte$]))), EQ(Select(Select(Ident(outputBox,SBox),R7,Some(Option[Coll[SByte$]])),get,Some(Coll[SByte$])),Select(Select(Ident(inputBox,SBox),R7,Some(Option[Coll[SByte$]])),get,Some(Coll[SByte$]))), EQ(Select(Select(Ident(outputBox,SBox),R8,Some(Option[Coll[SByte$]])),get,Some(Coll[SByte$])),Select(Select(Ident(inputBox,SBox),R8,Some(Option[Coll[SByte$]])),get,Some(Coll[SByte$]))), EQ(Select(Select(Ident(outputBox,SBox),R9,Some(Option[Coll[SLong$]])),get,Some(Coll[SLong$])),Select(Select(Ident(inputBox,SBox),R9,Some(Option[Coll[SLong$]])),get,Some(Coll[SLong$])))),SBoolean)))))
sigmastate.lang.exceptions.CosterException: 
```

Is this the right way to write a lambda function/comparing boxes?


[06/28/2022 7:20 AM] greenhat#6562
Only one argument is supported. Please, use a tuple. `t: (Box, Box)` as argument and `val inputBox = t.0; val outputBox=t.1` in the body.

{Reactions}
‚ù§Ô∏è (2) üëç (2) 

[06/28/2022 7:22 AM] greenhat#6562
We need to catch this error earlier, preferably on parsing, and give a clear error message.


[07/04/2022 12:23 AM] Cheese Enthusiast#0548
I am trying to get the input boxes from index 3 until index 6, and then concatenate their R4[Coll[Byte]] registers together. I have tried multiple times and no matter what I do it seems to fail unless I hardcode in what boxes I need to use. Specifically, no matter what type of filtering or slicing I do on INPUTS, it seems that when I try to get R4 on the boxes in the collection, it attempts to traverse the entire INPUTS rather than the filtered/sliced collection. 

For example, this code with multiple redundancies inside of it:

```scala
// NOTE: INPUTS(3) to INPUTS(6) have same unique propBytes
val slicedInputs = INPUTS.slice(3, 6).filter{ (box: Box) => box.propositionBytes == INPUTS(3).propositionBytes }

def getProof(p: Box): Coll[Byte] = {
    if(p.id != SELF.id){
      if(p.propositionBytes == INPUTS(3).propositionBytes){
        p.R4[Coll[Byte]].get
      }else{
        Coll[Byte]()
      }
    }else{
      Coll[Byte]()
    }
}
val initProof: Coll[Byte] = Coll[Byte]()

val proof: Coll[Byte]         = slicedInputs.fold(initProof, {
    (z: Coll[Byte], p: Box) =>
      z.append( getProof(p) )
  })
```

Despite the code above, whenever I try to run the transaction, I get the following error:
```
Caused by: java.lang.IllegalArgumentException: requirement failed: Unexpected register type found at register #4: GeneralType(special.sigma.AvlTree), expected CollType(PrimitiveType(Byte,[B@6594402a))
```

The only box in the transaction with an AvlTree in R4 is `INPUTS(0)` which is also `SELF`. Interestingly, if I change `slicedInputs` to equal `Coll( INPUTS(3), INPUTS(4), INPUTS(5) )` the code works fine. I have tried various other methods as well, but it seems that the only thing that works is hardcoding in the boxes. Any attempt to get them programmatically (via indices, filtering, or slicing) does not work at all.


[07/05/2022 7:03 AM] greenhat#6562
This one makes me scratch my head. üôÇ I suppose it might be a quirk of AOT costing. Could you try wrapping R4 access in `p.R4[Coll[Byte]].isDefined`?


[07/05/2022 8:10 PM] Cheese Enthusiast#0548
Yeah I tried this but it did not work either. I ended up putting the proof bytes into a context variable anyway so it isn't too big of a deal. Though now I'm running into another issue related to `byteArrayToLong`


[07/07/2022 5:10 PM] lgd#5847
If I just want to retrieve the output index, which index should I use in the `Coll[Byte]`? Is it just `somebox.creationInfo._2(1)` or some other index?

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/994636606197727352/Screenshot_2022-07-07_120936.png


[07/07/2022 5:22 PM] Cheese Enthusiast#0548
A txid should be 32 bytes, so I'd imagine that its something like this:
```
creationInfo._2.slice(32, creationInfo._2.size)
```
I guess if your transaction is under 128 outputs, you could probably just get the last byte only.
I'm not sure if output index is a long or integer or short so idk what you'd do if the transaction is over 128 outputs. I could be wrong on this so someone else may want to chime in as well.


[07/07/2022 5:24 PM] lgd#5847
thanks


[07/07/2022 5:24 PM] lgd#5847
yeah good point about what if the tx is more than 128 outputs


[07/07/2022 5:30 PM] Cheese Enthusiast#0548
If it's a long, you can use `byteArrayToLong` on all 8 bytes. If it's something smaller, you would need to concatenate some part of it I guess. I did something similar earlier where I loaded an int(4 bytes) from an Avl Tree.

```scala
val prefix: Coll[Byte] = Coll(0.toByte, 0.toByte, 0.toByte, 0.toByte)
val intAsLong = byteArrayToLong( prefix.append(_intBytes))
```

But I ran into some occasional issues with this that I'm not sure how to fix.


[07/07/2022 5:44 PM] lgd#5847
yeah in my case i think it will be a long


[07/07/2022 5:46 PM] lgd#5847
did you ever figure out how to downcast a numeric type?


[07/07/2022 5:47 PM] Cheese Enthusiast#0548
You can cast between most numeric types properly, only one I ran into issues with was BigInt


[07/07/2022 5:47 PM] lgd#5847
yeah i think i might need to go from BigInt to Int for something. The number starts off as BigInt but then the value gets used as an index in an Coll so needs to be Int type. The value will also fall within Int range after taking the modulo


[07/07/2022 5:52 PM] Cheese Enthusiast#0548
Yeah my biggest issue was with downcasting from BigInt. I'm not too sure how to deal with it at the moment. If there was a `bigIntToByteArray` method that would give you some control to do it manually, but I only see `byteArrayToBigInt`


[07/10/2022 7:26 AM] kii#8888
Wanted to create stackoverflow for ergoscript but got this:

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/995576711037059193/Screen_Shot_2022-07-09_at_11.25.49_PM.png


[07/10/2022 7:29 AM] kii#8888
that aside, 
When inserting a string into registers in Ergo, I have this code

    val byteColl = Javahelpers.SigmaDsl.Colls.fromArray(String.getBytes("utf-8"))
    ErgoValue.Of(byteColl, ErgoType.byteType())

However, when I'm trying to compare the CollByte within the ErgoBox, with say, a token Id. I'm not getting the right String. 

For example, for SigUSD, The id is: 03faf2cb329f2e90d6d23b58d91bbb6c046aa143261cc21f52fbe2824bfcbf04
However I'd get:
[B@7a1b8a46

I'm doing println(inputBox.getRegisters.get(0).getValue.asInstanceOf[Coll[Byte]].toArray) to get the value, however I believe that value should be the same when evaluating ErgoScript?

How can I compare tokenId vs a stored string when evaluating within ErgoScript?


[07/10/2022 7:39 AM] kii#8888
Or may I shouldnt be storing it the way i stored


[07/10/2022 7:39 AM] kii#8888
@Ilya | Spectrum I saw that ergodex deals with something similar in this:
https://github.com/ergoplatform/eips/blob/eip14/eip-0014.md#buy-order-erg---token-1

How did you guys handle that issue/store the data?

{Embed}
https://github.com/ergoplatform/eips/blob/eip14/eip-0014.md
eips/eip-0014.md at eip14 ¬∑ ergoplatform/eips
Ergo Improvement Proposals. Contribute to ergoplatform/eips development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/9kWMj-6sK_A1abo6ljG5p6xQklJiTwWDsg1BpKvJZPI/https/opengraph.githubassets.com/44e0c10f1dc9a6f51d32ad465cc3265d0d9d3580ee35e153b507f56ae3984a42/ergoplatform/eips


[07/10/2022 7:51 AM] MrStahlfelge#0042
do you have the link to the question?


[07/10/2022 7:51 AM] kii#8888
I wanted to create ergoscript tag, but i dont have enough reputation point


[07/10/2022 7:53 AM] kii#8888
So the answer is no, I dont have a link to the question because I couldnt create it


[07/10/2022 7:58 AM] MrStahlfelge#0042
sad, I could have edited it and added the tag when it was available


[07/10/2022 8:03 AM] kii#8888
Is it available? Do you have 1500 reputation points on Stackoverflow? Having questions asks in Stackoverflow will be a huge benefit


[07/10/2022 8:03 AM] MrStahlfelge#0042
no - I can only add tags by creatig a  question or editing a question üôÇ
yes I have more than 1,500


[07/10/2022 8:04 AM] kii#8888
What if....


[07/10/2022 8:04 AM] kii#8888
I send you the deatils of the question and you post it and you answer it üòÑ


[07/10/2022 8:04 AM] kii#8888
Then stackoverflow will now have ergoscript


[07/10/2022 8:05 AM] kii#8888
Oh, or i can just add scala as the tag


[07/10/2022 8:05 AM] kii#8888
let me do that


[07/10/2022 8:06 AM] kii#8888
https://stackoverflow.com/questions/72926725/how-can-we-convert-ergovalue-of-a-collbyte-to-standardcharsets-utf-8

{Embed}
https://stackoverflow.com/questions/72926725/how-can-we-convert-ergovalue-of-a-collbyte-to-standardcharsets-utf-8
How can we convert ErgoValue of a Coll[Byte] to StandardCharsets.UT...
When inserting a string into registers in Ergo, I have this code
val byteColl = Javahelpers.SigmaDsl.Colls.fromArray(String.getBytes("utf-8"))
ErgoValue.Of(byteColl, ErgoType.byteType())
https://images-ext-1.discordapp.net/external/VbfwnzN2MM794XNccNxDzrB1YeuPrxR53y11bwRfflY/%3Fv%3D73d79a89bded/https/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon%402.png


[07/10/2022 8:09 AM] MrStahlfelge#0042
üòî

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/995587457015873557/unknown.png


[07/10/2022 8:09 AM] kii#8888
NOOOOOOOO


[07/10/2022 8:09 AM] kii#8888
üò¶


[07/10/2022 8:09 AM] kii#8888
The question will be forever tagged wrongly üò¶


[07/10/2022 8:10 AM] MrStahlfelge#0042
no, I will try again tomorrow


[07/10/2022 8:11 AM] kii#8888
Do you know the answer to that question though?


[07/10/2022 8:20 AM] MrStahlfelge#0042
I think so, posted an answer so that the aggressive stackoverflow mods won't delete


[07/10/2022 8:22 AM] MrStahlfelge#0042
could edit now. let's see what happens


[07/10/2022 8:30 AM] kii#8888
I replied to your question on stackoverflow


[07/10/2022 8:35 AM] MrStahlfelge#0042
answered


[07/10/2022 8:36 AM] kii#8888
newb question is tokens(0)._1 a base16 string or the ErgoValue.of(sigusdIdAsString.getBytes(StandardCharsets.UTF_8))? I'm assuming its the latter haha


[07/10/2022 8:38 AM] kii#8888
Ahh, the latter one is, I should just insert into the registers as pure bytes

{Reactions}
üëç 

[07/10/2022 8:44 AM] kii#8888
Thank you for the help!


[07/10/2022 9:29 AM] MrStahlfelge#0042
don't forget to mark as answered on SO üòâ


[07/11/2022 6:31 AM] kii#8888
New Question on StackOverflow:
https://stackoverflow.com/questions/72934106/box-that-only-has-1-token-cant-pass-an-if-else-statement-when-the-if-condition

I have a guardscript that checks 2 tokens to see if its full. However, this can't compile due to the box not have a 2nd token.
```
val checkTokens: Boolean                 =
    if (SELF.tokens.size < 2) true
    else {
        SELF.tokens(1)._1 == _tokenId.get && SELF.tokens(1)._2 < x
    }
```
How can we deal with this kind of situation?

{Embed}
https://stackoverflow.com/questions/72934106/box-that-only-has-1-token-cant-pass-an-if-else-statement-when-the-if-condition
Box that only has 1 token can't pass an if else statement when the ...
I have a guardscript that checks 2 tokens to see if its full. However, this can't compile due to the box not have a 2nd token.
val checkTokens: Boolean                 =
    if (SELF.tokens.size &l...
https://images-ext-1.discordapp.net/external/VbfwnzN2MM794XNccNxDzrB1YeuPrxR53y11bwRfflY/%3Fv%3D73d79a89bded/https/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon%402.png


[07/11/2022 6:49 AM] kii#8888
I found a hack. But it's a pretty weird approach. 

I had a expression that went through that looked like this:
```
        val totalInputTokenAmount: Long     =
            if (SELF.tokens.size > 1) {
                paymentBox.tokens(0)._2 + SELF.tokens(1)._2
            } else paymentBox.tokens(0)._2
```
So I was curious if the contract evaluates the first item to see if its compilable. And i added this to my expression in the SO question:

```
    val RepaymentNotFullyFunded: Boolean            =
        if (SELF.tokens.size > 1) {
            SELF.tokens(0)._1 == _SLTRepaymentTokenId && SELF.tokens(1)._1 == _loanTokenId.get && SELF.tokens(1)._2 < _repaymentAmountGoal
        }
        else true
```

Which basically checks the tokens(0) before checking tokens(1). This seems to bypass the error and compiles fine.


@MrStahlfelge @kushti is this a bug or a feature? hahaha


[07/11/2022 8:42 AM] MrStahlfelge#0042
does it not compile or does it not reduce? that's  difference


[07/11/2022 11:45 PM] lgd#5847
would it be worth it to implement it in the contract itself?


[07/12/2022 12:26 AM] lgd#5847
i think index is Int only always


[07/12/2022 1:03 AM] kii#8888
Reduce. Compiles fine üôÇ


[07/12/2022 7:50 AM] MrStahlfelge#0042
Then you have not compile errors but errors in aot costing


[07/12/2022 3:58 PM] Cheese Enthusiast#0548
That sounds complicated to implement but I guess its possible


[07/12/2022 3:59 PM] Cheese Enthusiast#0548
If its just an int then you'll only need the last 4 bytes along with a 4 byte prefix of 0's.


[07/12/2022 5:31 PM] ilya | dappstep#9261
Added support for variables with automatic code snippet generation for replacement
https://twitter.com/dappstepjs/status/1546892972284846081

{Embed}
dAppstep Ergo (@dappstepjs)
https://twitter.com/dappstepjs/status/1546892972284846081
Contract playground https://t.co/Gs0zLhbwYb is now supports variables. Just use $ prefix to get a field on the left + a code snippet ready to use in your code. Check the demo and Proxy contract on the website.

@ergoplatformorg 
Soon will be recording a course on dapp development
https://images-ext-2.discordapp.net/external/klS5syDq-P_LatwJlGAfTnU2oF1T4Qw1OnSR-jbSnxo/https/pbs.twimg.com/ext_tw_video_thumb/1546891924354867200/pu/img/ok0lmWY5SBQYsNWG.jpg
Twitter

{Reactions}
üíØ (2) 

[07/13/2022 1:38 AM] lgd#5847
is it possible to make general purpose ergoscript playground (adding custom vars) in the browser, would be cool for quickly testing scripts


[07/13/2022 2:11 AM] curbsideprophet#5083
not really a support question and don't know where else to comment but i will put it here: solo learning ergoscript and absolutely love the flexibility, simplicity and versatility of it. also kudos to @lgd for help answering my questions


[07/13/2022 3:05 AM] ilya | dappstep#9261
Amm you mean like the one here but empty?

https://play.dappstep.com/proxy-contract

All snippets on the left are editable, the new contract is compiled and address generated on the fly


[07/13/2022 3:36 AM] lgd#5847
oh cool lol, i didn't notice that üòÖ


[07/13/2022 3:44 AM] lgd#5847


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/996608064025264149/bigIntToByteArray.txt


[07/25/2022 11:35 AM] ilya | dappstep#9261
Hey, I have a timezones issue in a smart contract. I'm not sure 100% but this is my best guess 
I have this condition:

```
      val gracePeriod = 3600000L // 1 hour
      val timestamp = CONTEXT.preHeader.timestamp

      val leftRange =  timestamp + INPUTS(0).R6[Long].get - gracePeriod
      val rightRange = timestamp + INPUTS(0).R6[Long].get + gracePeriod

      val isRentENDHigher = OUTPUTS(0).R8[Long].isDefined && OUTPUTS(0).R8[Long].get > leftRange
      val isRentENDLower = OUTPUTS(0).R8[Long].isDefined && OUTPUTS(0).R8[Long].get < rightRange

      val isSettingEndTimeInAcceptableRange = isRentENDHigher && isRentENDLower

      sigmaProp(isSettingEndTimeInAcceptableRange)

```

- When a token is listed for rent it stores R6 with is delta milliseconds of the renting period.
- When someone want to rent a plot he is setting R8 - renting end date, to `INPUTS(0).R6[Long].get` + `new Date().getTime()`  // current timestamp on users browser.

On the contract, I'm checking that the R8 is somewhere in between CONTEXT.preHeader.timestamp +/- 1 hour.

I was able to successfully rent a plot, but a person from a US timezone couldn't do it.

My guess is that
`new Date().getTime()`  takes a local timestamp but the node uses `CONTEXT.preHeader.timestamp`  which may be 8,9 hours ahead. On other hand timestamps are UTC as far as I know so it shouldn't play a role.

Any ideas?


[07/25/2022 11:51 AM] MrStahlfelge#0042
System.currentTimeMillis


[07/25/2022 11:52 AM] MrStahlfelge#0042
according to the docs it should be the same as Date().getTime() - and it should be the same no matter what time zone

{Reactions}
üëç 

[07/26/2022 6:51 AM] ilya | dappstep#9261
The same person was able to rent with different wallet, so i guess the issue is not in timezone


[07/26/2022 3:52 PM] Quwin#6226
Hey guys I was looking into Ergoscript but one thing I found interesting was not supporting mutable variables, is there a reason that was done? How is everyone building complex logic without mutable variables?


[07/26/2022 3:54 PM] Quwin#6226
Also I assume I am able to store text/struct data on an NFTs and change that within a dApp, but I couldn‚Äôt find an example of it


[07/26/2022 4:07 PM] Krasavice Blasen#4574
I dont think you can change the metadata of an NFT after its been minted. But, depending on your goal I am sure you can find some equally valid solution. Perhaps you could instead burn and remint the NFT through some service to modify the metadata. To allow for this modification service you would need to mint the original NFTs with this in mind so that you could use some smart contract/ collection EIP (coming soon) to ensure the reminted NFT is just as valid (in terms of the mint address, collection, royalties) as the original. Perhaps your metadata for the modified NFT could include a reference to the original NFT too. These are just my ideas though, you may find some of your own creative ways, maybe even make an EIP out of it üôÇ


[07/26/2022 4:09 PM] Krasavice Blasen#4574
Its good to start with some simple contracts and familiarise yourself with the UTXO model and go from there imo. You can creatively use register data and multi-stage contracts (contracts which span over multiple txs) to come up with some complex logic.

{Reactions}
üëç 

[07/27/2022 2:27 PM] ilya | dappstep#9261
What's your dev stack and what are you trying to achieve from user perspective with those NFTs?


[07/27/2022 2:27 PM] ilya | dappstep#9261
It is possible that you don't need to change any metadata on the nft itself


[07/27/2022 3:06 PM] Quwin#6226
Something like an NFT with data of let's say a video game item, with the capabilities of changing that data in the future.


[07/27/2022 5:06 PM] Quwin#6226
~~`sorry for the nooby questions but does anyone know how to convert an Output/Input `OUTPUTS(0).R4[Byte].get` into a string/int so I can do some functions?~~

Also I've been playing with the `ergosript-by-example` github to learn, but all of the examples are 1-2 years old. Are they outdated or fine?


[07/27/2022 5:34 PM] zargarzadehmoein#2928
Hi, which SDK? appkit?


[07/28/2022 3:12 AM] Quwin#6226
Okay I think I understand how ergo dApps work now, its like both way more complex than I expected (network side) and very simple (ergoscript) lmao. 
Is there a recommended platform for working on the actual smart contract logic? I've seen Appkit and Sigma-Rust, but I'm wondering if there's a prefered standard for development


[07/28/2022 5:24 AM] greenhat#6562
sigma-rust does not have ErgoScript compiler yet, so for developing smart contracts appkit would be a better choice.


[07/29/2022 11:47 AM] haileypdll#3353
Hi,
I'm wondering if some of you could understand this behavior better than me... to try to improve the time of my transaction to be mined:
 - I have a transaction for which the correct output depends on CONTEXT.headers(0).id value
 - Depending on the CONTEXT value, 1 of 4 transaction possible is valid
 - I'm trying to sign the 4 transactions, only one succeed, this one is sent to the mempool
 - It usually correctly appears in the mempool soon (for the first one), but is extremly slow to be mined
 - It may eventually disappear from the mempool
 - At the same time, while it is not confirmed, the application keep sending one of the 4 correct transaction, depending on the current CONTEXT.headers(0).id value
 - Those new transactions sometimes replace the old one in the mempool
 - At some point, the transaction is mined, it usually takes between 10 and 20 blocks from the first send

Taking the context from explorer and sending the transaction to the mempool of the same explorer should be ok for me.
I'm doing something wrong ? Or it is expected that some transaction stay for long in the mempool ?

At the end it works, and spamming the correct transaction allows for it to be mined.


[07/31/2022 5:15 PM] Ch1n3du#7350
Hi, I get this weird error when i try to use `Coll.exists` I think it might be something wrong with the `correctPayout` function

{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/1003335172671946824/Screenshot_from_2022-07-31_17-11-21.png


[07/31/2022 7:11 PM] Ch1n3du#7350
Also I wanted to ask, if call `Box.R5[Coll[Byte]].get` does it fail the script if the register is `undefined` or doesn't match the type


[07/31/2022 7:11 PM] Ch1n3du#7350
Or do I have to handle that explicitly?


[07/31/2022 7:52 PM] jozinek#0918
I would explicitly use types inside exists function `OUTPUTS.exists(b: Box => correctPayout(b))`. I also think you need to change `orderOwner` to be of type Boolean, currently `Coll[Byte]`


[07/31/2022 8:33 PM] Ch1n3du#7350
thanks


[07/31/2022 8:33 PM] jozinek#0918
Did it help?


[07/31/2022 8:35 PM] Ch1n3du#7350
I called .exists on the OUTPUTS collection directly and stored that in correctpayout


[07/31/2022 8:36 PM] Ch1n3du#7350
and it worked, also thanks for the sigmaprop thing


[07/31/2022 8:37 PM] Ch1n3du#7350
do you know the answer to this?


[07/31/2022 8:57 PM] jozinek#0918
Unfortunately not. Haven't gone down this rabbit hole (yet).

{Reactions}
üëç 

[07/31/2022 8:58 PM] jozinek#0918
But you can still go with Option. I mean before you call `.get` you can make sure you have register filled with some value:
```
val orderTokenId = SELF.R5[Coll[Byte]
val result = 
  if (orderTokenId.isDefined)
    orderTokenId.get == outbox.tokens(0)._1
  else
    false
```

{Reactions}
üëç 

[08/05/2022 3:48 PM] Krasavice Blasen#4574
Hey, I am looking to check if the tokenId's of an Output match a list of tokenIds. 
This is one way I have tried.

```
{
  val outTokens    = OUTPUTS(0).tokens
  val tokenIndices = outTokens.indices

  val listOfTokenIds = SELF.R4[Coll[Coll[Byte]]].get

  tokenIndices.forall{
    (idx : Int) => outTokens(idx)._1 == listOfTokenIds(idx)
  }
}
```
But, this always leads to a compilation error.

Yet, explicitly checking each token works fine, i.e.
```
{
  val outTokens    = OUTPUTS(0).tokens
  val tokenIndices = outTokens.indices

  val listOfTokenIds = SELF.R4[Coll[Coll[Byte]]].get
  
  allOf(Coll(
     outTokens(0)._1 == listOfTokenIds(0),
     outTokens(1)._1 == listOfTokenIds(1),
     outTokens(2)._1 == listOfTokenIds(2),
  ))
}
```
I have used this design pattern before (forall over a collection of indices) to evaluate different things, but it seems to break down as soon as nested elements are involved. 

Perhaps, there is an issue with loop level, but the error output on the node does not say this which makes me think it could just be some bug?

Regardless, if anyone has as alternate solution to my problem or any suggestions I would appreciate it üôÇ


[08/05/2022 3:50 PM] lgd#5847
Try zipping both the list and the outtokens


[08/05/2022 3:50 PM] lgd#5847
Then forall and check equality with both elements in the tuple


[08/05/2022 3:52 PM] Krasavice Blasen#4574
sure, ill give that a go


[08/05/2022 3:53 PM] lgd#5847
outTokens == listOfTokenIds might work too lol


[08/05/2022 3:54 PM] Krasavice Blasen#4574
listOfTokenIds is just a coll[coll[byte]] so that wouldnt match the tuple of outtokens (and I cant construct this tuple sicne I dont know how many tokens there will be)


[08/05/2022 3:55 PM] Quwin#6226
I was doing this earlier gimmie a sec


[08/05/2022 3:56 PM] Quwin#6226
Here's an example:
```scala
SELF.tokens.forall { 
       (token: (Coll[Byte], Long)) => OUTPUTS(1).tokens.exists {
        (id: (Coll[Byte], Long)) => id == token
      }
    }
```


[08/05/2022 3:57 PM] lgd#5847
Just use map or flatMap so you get the id only

{Reactions}
üî• 

[08/05/2022 3:58 PM] Krasavice Blasen#4574
I think this will work, thanks! I will let you know when I try it tomorrow

{Reactions}
üëç 

[08/05/2022 4:00 PM] Krasavice Blasen#4574
This is also quite good, I can adjust some things and can likely use this too!


[08/05/2022 4:11 PM] Cheese Enthusiast#0548
It's weird, but apparently there's some issues with iterating over indices in AOT costing. I believe its fixed in 5.0


[08/05/2022 4:15 PM] Quwin#6226
~~I'm having issues hashing a token quantity in ergoscript, I'd compare the raw numbers but ergoscript doesn't support numbers over `Int.MaxValue` (which is kinda dumb because BigInt and Long exist but don't work)

```scala
val tokenQuantity: Long = SELF.tokens(0)(1)

val correctAmount = longToByteArray(tokenQuantity)
```
This doesn't work because `SELF.tokens(0)(1)` has No Type apparently~~

Edit I ran it again and it works now?


[08/05/2022 4:22 PM] lgd#5847
What you want is: SELF.tokens(0)._2


[08/05/2022 4:23 PM] lgd#5847
You use ._1 and ._2 to access one of the paired elements in a tuple


[08/05/2022 4:25 PM] Quwin#6226
It seems to work the same for me, that wasn't the issue


[08/05/2022 4:25 PM] Quwin#6226
A separate unrelated issue is why is the max number supported by Ergoscript Long.MaxValue lol, here a link: https://wallet.plutomonkey.com/p2s/?source=ewogIHZhbCB0b29CaWcgPSAyMTQ3NDgzNjQ4CgogIHNpZ21hUHJvcCgKICAgIHRydWUKICApCn0=


[08/05/2022 4:28 PM] Quwin#6226
I feel like it should be much higher, especially when you're dealing with ERG quantities (2147483647 = 2.15 ERG)


[08/05/2022 4:28 PM] lgd#5847
Huh? That's the wrong syntax tho


[08/05/2022 4:30 PM] Quwin#6226
Do I have to explicitly set types for number values? I assumed they conform to the type of the value name

Nvm I looked up scala number syntax, how did I go so far without running into this and wtf is this syntax


[08/05/2022 5:29 PM] Cheese Enthusiast#0548
To fix your script, simply do this:
```scala
{
  val tooBig = 2147483648L

  sigmaProp(
    true
  )
}
```

I added an `L` at the end of your number, all that means is that it's a Long


[08/05/2022 5:34 PM] anon_real#2768
@morphic Hi, one question. Is there any way to make sure an ErgoTree that is stored in a register signs the contract? Something like:
```{
  val tree = SELF.R4[Coll[Byte]].get
  proveDlog(toGroupElement(tree))
}```


[08/05/2022 5:38 PM] Cheese Enthusiast#0548
I believe you can use `decodePoint` to convert a `Coll[Byte]` representation of a GE to to the `GroupElement` type. `proveDlog` should then work afterwards.

{Reactions}
üëç 

[08/05/2022 5:39 PM] Cheese Enthusiast#0548
I don't know if this works for just any ErgoTree propBytes though


[08/06/2022 1:09 AM] Krasavice Blasen#4574
This ended up working perfectly well üôÇ


[08/06/2022 1:54 PM] Omnia#7128
hello, I have a problem when reading the demo project. if  I want to secure there is only one utxo box for one address to contain a bool variable representing true or false, how should I writte the guarding ergoscript?


[08/06/2022 6:08 PM] anon_real#2768
I'm not sure if the input to that should be ergo tree bytes. @morphic can you confirm this?


[08/06/2022 6:12 PM] Cheese Enthusiast#0548
I think it'd specifically have to be a GroupElement bytes, don't think ErgoTree will work. If this is just about signing I guess GroupElement bytes would be fine though depending on what you're trying to do.


[08/06/2022 6:16 PM] Cheese Enthusiast#0548
One thing I'm curious about is if we can insert any SigmaProp into something like a register and have it be executed. I thought this was possible but I've struggled to get it working in AppKit. ProveDLogs seem to work, but I'm more interested in being able to execute SigmaProps made from scripts by inserting them into registers or even grabbing them from the registers of a data input.


[08/06/2022 6:18 PM] anon_real#2768
Well you can directly put GroupElement in registers so decodePoint won't be necessary I guess. My use-case is to use ergo tree bytes. I'm pretty sure that if you get rid of first three bytes of ergo tree, you can cast it to GroupElement but I think there should be cleaner solutions.


[08/06/2022 6:18 PM] anon_real#2768
Yes, this is possible, you can look for it in ergo forum; there should be some examples there.

{Reactions}
üî• 

[08/06/2022 6:22 PM] anon_real#2768
@Cheese Enthusiast one example from @kushti: https://www.ergoforum.org/t/updateable-multisig-pattern/3356

{Embed}
https://www.ergoforum.org/t/updateable-multisig-pattern/3356
Updateable Multisig Pattern
In the light of ErgoHack III going on, I am revising different known contracts regarding privacy.  One of the most unknown things still, unfortunately, is how treasury contract is done. And there are some interesting things here. One of them is updateable threshold scheme, which can be interesting per se.  Treasury contract is done in ErgoTree, ...


[08/06/2022 6:26 PM] Cheese Enthusiast#0548
This is great, thanks!

{Reactions}
üëç 

[08/06/2022 8:57 PM] password1#4253
Noob question. Why do I get a match error every time I try to store something that isn't bytes in a register? I need to store a long. Works with bytes in register, but nothing else. Bonus noob question why do I get "overloaded method value" whenever I try to store something in more than one register? I have tried figuring this out by myself for an embarrassingly long amount of time, any help is appreciated. 
https://scastie.scala-lang.org/Gkl36sUiRdaZeLL3GuHRKg

{Embed}
https://scastie.scala-lang.org/Gkl36sUiRdaZeLL3GuHRKg
Scastie - An interactive playground for Scala.
import org.ergoplatform.compiler.ErgoScalaCompiler._
import org.ergoplatform.playgroundenv.utils.ErgoScriptCompiler
import org.ergoplatform.playground._
import sigmastate.eval.Extensions._

val trueScript = s"""
  sigmaProp(true)
""".stripMargin
val trueContract = ErgoScriptCompiler.compile(Map(), trueScript)


/////////////////////////////////...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[08/08/2022 5:18 AM] greenhat#6562
ergo-playgrounds-env lib is too old. Try `0.0.0-88-a781666a-SNAPSHOT` in build settings.


[08/08/2022 5:32 PM] password1#4253
Thank you.  I appreciate the help.


[08/08/2022 6:54 PM] anon_real#2768
@morphic is not responsive currently it seems. @kushti @scalahub maybe you guys have some ideas?


[08/08/2022 7:23 PM] Quwin#6226
You can just make the register hold your desired GroupElement:

```scala
val signer = SELF.R4[GroupElement].get
proveDlog(signer)
```


[08/08/2022 7:44 PM] Quwin#6226
How long is too long for my ErgoScript contract lol? I can't paste the script because it's too long but here's the P2S addy: `49nTxQx4RDn1jEzc69rYCRaWVBQBTGXtczJfTxRYDtSzoxbZTyV2RbQrsztGaCvw3bZe2NUB3bVjHcwxpA61bH2AARMCsefQDTCxHMAbDpEZ8358x9N46n8MLL7QsSUzz4ngu1re7D2CMLUzH4g5KecxfG1Y76HAP42z8ZHhKcLNBiEE6KWHvxqMY5VdKD9btiKuQ15peSUvgdx6C9t428c1Tj2KXTYQsp85FcmaGU6LDLHnBrmZGXrPyPqfT8cHxy4Zy7sXRpFSQTD3kVwGZnyqU8AXVkWyMibKCMSbmbx8kjMbcPvHZBazZaqSJD3ymLxp4XEGDhxBw9NSnR6aopJdUk3ooaqvhy6rWmUKPiRxf3pEaN87HKithcqHqu9HgywGGQEHUXj1psSNudenuctB5vyxqR2wFCsZnj6qiyq2eJJzvzwvCQNaraMMMgDXvWNtytz668LwQo4QPNDxSnArNBgeAARDWbu6MTteKDKfDXsfLmwu7ZNnTwuVrWjr7jhFqmfa2uVJhdHaCcJQRZdkdLnEDpRphzDLjcb4TSdwuZWwDAvHwghXLwzgAR4URQv3noCu2dijSdCi17HBarUtC7WWqEQMMc89pocCC2VMPe2wf99vjcWJFgK1VoagKmrdL7hoWukokmfhxkMsXFehxRwot1kXCSKgpG3BpAtCMnrwkhpruUDgC52EPmAQucgHySMsUrWxKqLHNzWAEvgvoHH4jjDF6V6vLB5kirEP1tCZLaMDWK2gk2C91tcBhqo43MxkE3vWQCtjQgCqCtroigjxwuRcRXNd`


[08/08/2022 8:48 PM] anon_real#2768
This is not my question. I'd like to have ErgoTree not GroupElement as I'm outlining in my script.


[08/08/2022 8:57 PM] Quwin#6226
Can ErgoTrees sign transactions? Wouldn't the signer of a given transaction always be from a P2PK address not a P2S address?


[08/08/2022 10:01 PM] anon_real#2768
My ErgoTree is from P2PK!


[08/09/2022 11:21 PM] anon_real#2768
@morphic @kushti any idea why these two are semantically different in ergo script?
`SELF.tokens.slice(0, SELF.tokens.size) == newVote.tokens.slice(0, SELF.tokens.size)`
`SELF.tokens == newVote.tokens.slice(0, SELF.tokens.size)`

It seems they should be the same but the second one fails (script reduces to false)


[08/10/2022 2:21 AM] Krasavice Blasen#4574
I think ive done something exactly the same but I was getting compile error on the second one.


[08/10/2022 3:36 AM] anon_real#2768
No, it is fine compiler-wise. The semantics are different though -- which obviously shouldn't be.


[08/10/2022 7:28 AM] Omnia#7128
does ergo script support recursive function def?


[08/10/2022 7:49 AM] Cheese Enthusiast#0548
It doesn't, for / while loops and recursion aren't allowed. You can still use collection methods like fold, map, filter, etc. to iterate code. Fold is probably the most versatile, can do a lot of different things with it.


[08/10/2022 7:52 AM] Cheese Enthusiast#0548
Speaking of loops, I had a question.

What happens if you have the following contract:

```scala
{ SELF.R4[SigmaProp].get }
```

And in the box's R4, you place the exact same contract's SigmaProp. Wouldn't it just keep referencing SELF.R4? Or would costing eventually render the transaction invalid?


[08/10/2022 8:22 AM] Omnia#7128
yes, I have the same question too, though for/while loop not support, but recursion may still presents as self reference. so how to handle this? compile failure or transaction failure?


[08/10/2022 8:25 AM] Omnia#7128
and as I investigated, cardano plutus support function recursion, but the doc says it is deterministic. idk why.


[08/10/2022 8:34 AM] Omnia#7128
so I can  not define a function with recursion and the compile will fail if so ?


[08/10/2022 10:22 AM] Omnia#7128
oh, cardano plutus has budget and transaction execution fee, and collateral, so the guarding script supports function recursion alike loop.


[08/10/2022 12:48 PM] glasgowm#9381
Trying out Discord new forum feature - please open any support requests in #dev-forum


[08/10/2022 2:22 PM] scalahub#2618
Does it have to be a group element or can it be just any sigmaprop bytes?


[08/10/2022 2:22 PM] scalahub#2618
because it is kind of implied that its a group element when you say  `proveDlog(toGroupElement(tree))`


[08/10/2022 5:48 PM] anon_real#2768
Yes. So basically I have ergo tree of a p2pk address.


[08/10/2022 7:07 PM] anon_real#2768
It will fail due to costing I suppose.


[08/10/2022 7:13 PM] Cheese Enthusiast#0548
I wonder if this could be made in such a way to allow some form of recursion


[08/10/2022 7:39 PM] anon_real#2768
You could write a `forall` loop for some predefined number of indices.


[08/10/2022 11:57 PM] Omnia#7128
costing? no gas fee,just fee for storage, why costing exist?


[08/11/2022 2:38 AM] Omnia#7128
it seems this piece of code just return the value(ergotree) of the sigmaprop, and will not evaluate it. so no recursion in this code. so I think a wrap using function atLeast(1, SELF.R4[SigmaProp].get ) should be include to trigger this situation.


[08/11/2022 2:41 AM] Quwin#6226
you could also evaluate it with .isValid, or just return the SigmaProp value


[08/11/2022 2:42 AM] Quwin#6226
for example ```scala
{
  SELF.R4[SigmaProp].get
}
```
is a valid script with the P2S address `4MQxzVFVjmhg73C6`


[08/11/2022 2:43 AM] Omnia#7128
so this code just return true or false? not the raw ergotree?


[08/11/2022 2:44 AM] Quwin#6226
this will just return true/false depending on R4, but if you make the SigmaProp in SELF.R4 the same thing it might break? I can test a transaction real quick


[08/11/2022 2:47 AM] Omnia#7128
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md in this doc, I didn't find the description about type SigmaProp, but I thougt Ri[T].get just return the value storeed in Ri as type T.           Learnt.

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md
sigmastate-interpreter/LangSpec.md at develop ¬∑ ScorexFoundation/si...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/LangSpec.md at develop ¬∑ ScorexFoundation/sigmastate-interpreter
https://images-ext-1.discordapp.net/external/k0gzKtKJChdxhI4zYzxk0nZf-krsrssX4acMyvPros8/https/opengraph.githubassets.com/b977079e4d8adbf09f60bf249c0ce4442e95482c38fed3dd1f3a459a587dd04d/ScorexFoundation/sigmastate-interpreter


[08/11/2022 2:52 AM] Quwin#6226
SigmaProp functions aren't in the main LangSpec (which is kinda annoying since there's a few other semi-useful stuff not there as well) but basically two functions you wouldn't know:
`isValid` which just returns true/false and `propBytes` which returns the propositionBytes of the SigmaProp


[08/11/2022 2:53 AM] Quwin#6226
Here's the code with all the functions for each Type: https://github.com/ScorexFoundation/sigmastate-interpreter/blob/6d384ec4fb5efc6d18dffec83c546128b6744db4/sigma-api/src/main/scala/special/sigma/SigmaDsl.scala

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/6d384ec4fb5efc6d18dffec83c546128b6744db4/sigma-api/src/main/scala/special/sigma/SigmaDsl.scala
sigmastate-interpreter/SigmaDsl.scala at 6d384ec4fb5efc6d18dffec83c...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/SigmaDsl.scala at 6d384ec4fb5efc6d18dffec83c546128b6744db4 ¬∑ ScorexFoundation/sigmastate-int...
https://images-ext-1.discordapp.net/external/k0gzKtKJChdxhI4zYzxk0nZf-krsrssX4acMyvPros8/https/opengraph.githubassets.com/b977079e4d8adbf09f60bf249c0ce4442e95482c38fed3dd1f3a459a587dd04d/ScorexFoundation/sigmastate-interpreter


[08/11/2022 3:04 AM] Omnia#7128
so SELF.R4[T] just return the value, but SELF.R4[T].get will evaluate the value by its type?


[08/11/2022 3:07 AM] MGpai#4313
anyone know whats up here


[08/11/2022 3:07 AM] MGpai#4313


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/1007108069286740068/unknown.png


[08/11/2022 3:09 AM] Quwin#6226
`SELF.R4[T]` returns `Option[T]`, which can either = `None` or `Some(A)`

`SELF.R4[T].get` returns whatever is stored there A, and fails if A's type  != T or A is not defined


[08/11/2022 3:12 AM] Quwin#6226
The error says `configBox.tokens(0)._1`'s type != `configBoxNFTId`'s type`


[08/11/2022 3:13 AM] Quwin#6226
Are you sure the type of `configBoxNFTId` is a `Coll[Byte]`?


[08/11/2022 3:15 AM] Omnia#7128
thanks. I am confused by the "SELF.R4[T].get", it will directly evaluate the Some(A) by default? just like SigmaProp.isValid?


[08/11/2022 3:19 AM] Quwin#6226
It will not evaluate whatever is inside, only return the value inside. Earlier when my script was only `SELF.R4[SigmaProp].get` I did not have to explicitly evaluate it because ErgoScript (and Scala in general) will automatically evaluate the last item if it is not defining a `val` or `def`

for example the script ```scala
{
  true
}
```
runs but not ```scala
{
  val thisIsTrue = true
}
```
but ```scala
{
  val thisIsTrue = true

  thisIsTrue
}
```
runs


[08/11/2022 3:20 AM] Quwin#6226
and in ErgoScript terms code block 1 & 3 are the exact same


[08/11/2022 3:23 AM] Omnia#7128
ok, got it. for sigmaprop, Ri[SigmaProp].get returns the code block's final result.


[08/11/2022 3:25 AM] MGpai#4313
yes, it turns out I put it as a string


[08/11/2022 3:25 AM] MGpai#4313
I get this now


[08/11/2022 3:25 AM] MGpai#4313


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/1007112449431982180/unknown.png


[08/11/2022 3:25 AM] Quwin#6226
yep that returns a SigmaProp, its up to you if you want that SigmaProp to be the final check for the script though, so you can do complex stuff with that


[08/11/2022 3:26 AM] Omnia#7128
but how can I get the sigmaBytes? SELF.R4[SigmaProp].propBytes?


[08/11/2022 3:27 AM] Quwin#6226
It seems like you're defining `configBoxNFTId` outside the scope of Line 5, is it defined within your Appkit code or within the script?


[08/11/2022 3:28 AM] Quwin#6226
I'm not sure what you're referring to by "sigmaBytes" but SigmaProp.propBytes == Box.propositionBytes so you can compare those. What are you trying to do?


[08/11/2022 3:28 AM] MGpai#4313
appkit code


[08/11/2022 3:28 AM] MGpai#4313
```
        configBoxNFTId = ErgoToken(configBoxNFTId, 1).getId()
        serviceTokenId = ErgoToken(serviceTokenId, 2000).getId()
        return self._ctx.compileContract(ConstantsBuilder.create().item("configBoxNFTId", configBoxNFTId).item("serviceTokenId", serviceTokenId).build(), contract)
```


[08/11/2022 3:34 AM] Omnia#7128
got it . I mean how to get the sigmaProp.propBytes if its stored in a register of the box.


[08/11/2022 3:35 AM] Quwin#6226
in your code the type of `configBoxNFTId` is Array[Byte] not Coll[Byte] (it gets really annoying trust me) 

Here's some fixed code:```scala
        configBoxNFTId = ErgoToken(configBoxNFTId, 1).getId()
        serviceTokenId = ErgoToken(serviceTokenId, 2000).getId()
        return self._ctx.compileContract(ConstantsBuilder.create().item("configBoxNFTId", JavaHelpers.collFrom(configBoxNFTId)).item("serviceTokenId", serviceTokenId).build(), contract)
```

if you haven't you also need to add `import scala.collection.JavaConverters._` to the top of your file

That import might be for something else try without it too lol


[08/11/2022 3:37 AM] MGpai#4313
I get this error


[08/11/2022 3:37 AM] MGpai#4313


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/1007115583256526958/unknown.png


[08/11/2022 3:39 AM] Quwin#6226
oh change `configBoxNFTId = ErgoToken(configBoxNFTId, 1).getId()` to `configBoxNFTId = ErgoToken(configBoxNFTId, 1).getId().getBytes()`


[08/11/2022 3:39 AM] Quwin#6226
or do `JavaHelpers.collFrom(configBoxNFTId.getBytes())` either works


[08/11/2022 3:40 AM] MGpai#4313
the former worked


[08/11/2022 3:40 AM] MGpai#4313
thanks!


[08/11/2022 3:40 AM] Quwin#6226
np üëç


[08/11/2022 3:43 AM] Omnia#7128
I think this is what I want SELF.R4[Coll[Byte]].get, this returns the raw ergotree  stored in the R4.


[08/11/2022 3:44 AM] Quwin#6226
So if you want the specific prop bytes of a box, it's a lot simpler. You can just do `SELF.propositionBytes` (or `INPUTS(x).propositionBytes` or `OUTPUTS(x).propositionBytes`)

The example I had earlier is really niche I doubt you'd need it


[08/11/2022 3:46 AM] Quwin#6226
The `Box` Type lets you gets its proposition bytes as a `Coll[Byte]` just with that function `propositionBytes` readily defined for you


[08/11/2022 3:48 AM] Quwin#6226
you can also store propbytes in a register if that's necessary directly as a `Coll[Byte]`, storing a `SigmaProp` type is pretty niche I don't have a specific use for it off the top of my head


[08/11/2022 3:50 AM] Omnia#7128
this question is raised by the recursion using  self reference of sigmaprop, then I was confused by the use of  Option.get method. thanks for your patience.


[08/11/2022 3:52 AM] Quwin#6226
oh yeah lol lemme test if the recursion works real quick

My guess is probably that it's impossible to use the Box tbh


[08/11/2022 3:54 AM] Omnia#7128
does ergoscript have a cost definition? I thought there is no gas fee, so also no cost, just the storage fee for box's byte.


[08/11/2022 3:54 AM] Omnia#7128
I mean evaluating cost of the box's guarding script.


[08/11/2022 3:56 AM] Quwin#6226
The ErgoScript is stored as data and so counts as the cost. Not sure how exactly gas works though tbh


[08/11/2022 3:58 AM] Quwin#6226
and IDK how to build a SigmaProp in Appkit ü§∑üèª‚Äç‚ôÇÔ∏è


[08/11/2022 4:01 AM] Omnia#7128
idk either. this is raised by Cheese.  It seems impossible. so this question is over.üòÖ


[08/11/2022 4:18 AM] Omnia#7128
and directly evaluate a sigmapropBytes or ergotree is not allow in ergoscript.


[08/11/2022 4:24 AM] Quwin#6226
There's probably a way to force it but that's too much work lol


[08/11/2022 4:24 AM] Quwin#6226
maybe some other day


[08/11/2022 5:02 PM] dusek#6153
can you even turn an arbitrary ergotree into a sigmaprop


[08/11/2022 5:02 PM] dusek#6153
I thought SigmaProp was something/some combination of sigma protocols like proveDlog, proveDHTuple, atLeast, etc


[08/11/2022 5:03 PM] dusek#6153
so I don't think that recursive contract would be possible?


[08/11/2022 5:41 PM] Cheese Enthusiast#0548
You can, all contracts / scripts return a sigma prop at the end


[08/11/2022 5:42 PM] Cheese Enthusiast#0548
I think its just not possible via appkit atm, it only allows proveDlogs or proveDHTuples as sigma props that can be inserted into contracts and boxes


[08/11/2022 6:04 PM] morphic#4133
This is probably due to the bug in v4.x which is fixed in v5.0, but has not been described. Here is the description https://github.com/ScorexFoundation/sigmastate-interpreter/issues/824

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/issues/824
Fix equality of PairOfCols ¬∑ Issue #824 ¬∑ ScorexFoundation/sigmasta...
Background ErgoTree interpreter v4.x sometimes use optimized representation of collections of pairs, i.e. collections with elements of type (T1, T2), like Coll[(Coll[Byte], Long)]. When a collectio...
https://images-ext-2.discordapp.net/external/49Y0gLcWgDIh4V5z9sVgXs09mM54Z3g_LmtNBE1H5i8/https/opengraph.githubassets.com/0a8a927fb497029f20d9a71e214a8f2619d9eba87bff97670523b0a992d10a02/ScorexFoundation/sigmastate-interpreter/issues/824


[08/11/2022 6:08 PM] morphic#4133
decodePoint can parse bytes previously produced by GroupElement.getEncoded


[08/11/2022 6:23 PM] morphic#4133
Try using Coll.patch https://github.com/ScorexFoundation/sigmastate-interpreter/blob/d64fd2783c57e70a8ed045a24d2b195aad8eb1f7/library-api/src/main/scala/special/collection/Colls.scala#L224 with xs.patch(indexToRemove, Coll(), 1)

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/d64fd2783c57e70a8ed045a24d2b195aad8eb1f7/library-api/src/main/scala/special/collection/Colls.scala
sigmastate-interpreter/Colls.scala at d64fd2783c57e70a8ed045a24d2b1...
ErgoScript compiler and ErgoTree Interpreter implementation for Ergo blockchain - sigmastate-interpreter/Colls.scala at d64fd2783c57e70a8ed045a24d2b195aad8eb1f7 ¬∑ ScorexFoundation/sigmastate-interp...
https://images-ext-1.discordapp.net/external/k0gzKtKJChdxhI4zYzxk0nZf-krsrssX4acMyvPros8/https/opengraph.githubassets.com/b977079e4d8adbf09f60bf249c0ce4442e95482c38fed3dd1f3a459a587dd04d/ScorexFoundation/sigmastate-interpreter


[08/11/2022 6:27 PM] anon_real#2768
Does this mean we can not rely on the first approach that seemingly is working as well?


[08/11/2022 6:33 PM] morphic#4133
Where newVote box come from?


[08/11/2022 6:34 PM] anon_real#2768
An output box


[08/11/2022 6:36 PM] anon_real#2768
I see. I need to get GroupElement from an ergotree of a p2pk.
The following seem to work (ignoring 3 bytes of ergotree). Could you confirm this?
```{
        val ergotree = SELF.R4[Coll[Byte]].get
        val x = ergotree.slice(3, ergotree.size)
        proveDlog(decodePoint(x))
  }```


[08/11/2022 6:43 PM] morphic#4133
Yes, when p2pk address is serialized, the same GroupElementSerializer.serialize is used for the underlying GroupElement. So, once you offset to the correct position, you can deserialize them using decodePoint


[08/11/2022 6:44 PM] morphic#4133
yes, or you can also try SELF.tokens == newVote.tokens, both collections should have the same representation


[08/11/2022 6:47 PM] anon_real#2768
The latter won't work since newVote has more tokens. This helps a lot, thanks!


[08/11/2022 10:09 PM] Quwin#6226
With AvlTrees only the key has to be blakeb256 hashed right? Not both? And is the Digest of a AvlTree in that format already or should I hash the digest if I wanted to use it as a key


[08/11/2022 10:35 PM] Cheese Enthusiast#0548
The key doesn't necessarily need to be hashed, it just needs to be 32 bytes. All of the off-chain components that manage AVL Trees (AVLProver and/or Plasma Map) perform the hashing for you. It can however be useful to hash the key in case it does not follow the 32 byte constraint.


[08/11/2022 10:38 PM] Cheese Enthusiast#0548
A digest is already a blake2b256 hash, so no need to hash it again. It is already 32 bytes in the off-chain code, so no need to change anything, you should be able to use a digest as a key easily. This is not the case in the on-chain / ErgoScript code however.

 In ErgoScript, each digest is actually 33 bytes. It is the normal 32 byte hash along with one extra byte representing the tree height. So if you wish to use a digest as a key, just make sure to slice the `Coll[Byte]` returned from the `.digest()` method properly.


[08/11/2022 10:39 PM] Cheese Enthusiast#0548
This might help:
https://github.com/GetBlok-io/GetBlok-Plasma/blob/master/documents/AVL_Trees.MD

If you're using the plasma library to interact with the tree, then there is also an off-chain tutorial here in the README:
https://github.com/GetBlok-io/GetBlok-Plasma


[08/11/2022 11:33 PM] Quwin#6226
I actually was trying to use the plasma library earlier but the import didn‚Äôt work with sbt, I‚Äôll try again though.


[08/11/2022 11:35 PM] Cheese Enthusiast#0548
Make sure to include the right sonatype repo to pull from, you can see it in the Release section. If you still run into issues let me know and I can fix it.


[08/11/2022 11:48 PM] Quwin#6226
Oh yeah and do the values in an AvlTree have to be 32 bytes as well or only the key?


[08/11/2022 11:52 PM] Cheese Enthusiast#0548
You can optionally set a value size constraint in both the on-chain and off-chain code. Otherwise, it defaults to allowing values of any size


[08/11/2022 11:57 PM] Quwin#6226
Got it, Ty. Lemme do some more research before I plague the chat lol


[08/12/2022 12:28 AM] Omnia#7128
at first glance, i thought the plasma was the plasma in ethereum because a word layer2 was mentioned, but then i realized it is a library layered on appkitüòÖ


[08/12/2022 12:30 AM] Quwin#6226
Well plasma refers to a ‚Äúplasma chain‚Äù, basically a type of side chain like how zk rollups are a thing.


[08/12/2022 12:31 AM] Quwin#6226
So the one on ETH is probably similar lol. The plasma library is for helping to create a plasma chain on ergo


[08/12/2022 12:32 AM] Omnia#7128
so plasma here is really a layer2 chain? i thought it was a library


[08/12/2022 12:35 AM] Quwin#6226
U got it cheese lmao

{Reactions}
üòÇ 

[08/12/2022 12:36 AM] Cheese Enthusiast#0548
Plasma is a library originally made to help create a Plasma chain on Ergo. But in practice it became more of a general purpose tool to help integrate AVL Trees (similar to merkle trees in ETH, but more efficient) into dApps


[08/12/2022 12:38 AM] Cheese Enthusiast#0548
But yes, you could definitely use the library to make a Plasma chain, as you can easily create off-chain databases with it. After that you'd still need to create actual nodes that communicate with another and apply changes to the db. I'm not knowledgeable enough in the network layer yet, so I decided to not implement anything related to it.


[08/12/2022 12:41 AM] Omnia#7128
got it, just confused by the word Plasma. baecause eth and vitalik used the same name for his layer2 project ever.


[08/12/2022 12:43 AM] Omnia#7128
but I think now that there is ergo, a centralized off-chain service and database is enought, no need to make everything off-ergo-chain a blockchain.


[08/12/2022 3:48 AM] Quwin#6226
anybody got the syntax for `fold` in ErgoScript?


[08/12/2022 3:50 AM] Quwin#6226
nvm got it it's `Coll.fold(z, {(a: TYPE, b: TYPE) => B})`


[08/12/2022 4:15 AM] greenhat#6562
Not really. Only if the script reduces to sigma prop or boolean in which case it's wrapped into sigma prop.


[08/12/2022 4:17 AM] Quwin#6226
What does the combination of a SigmaProp + GroupElement resolve to?


[08/12/2022 4:37 AM] Cheese Enthusiast#0548
Interesting, didn't know this. What's the use of contracts that don't evaluate to SigmaProps?


[08/12/2022 4:42 AM] greenhat#6562
None. üôÇ At least to my knowledge. Here is the interpreter part checking for the result type of evaluated expression - https://github.com/ergoplatform/sigma-rust/blob/98898d62ff221eda8ae691a173c056dcb0ee83ce/ergotree-interpreter/src/eval.rs#L179-L189

{Embed}
https://github.com/ergoplatform/sigma-rust/blob/98898d62ff221eda8ae691a173c056dcb0ee83ce/ergotree-interpreter/src/eval.rs
sigma-rust/eval.rs at 98898d62ff221eda8ae691a173c056dcb0ee83ce ¬∑ er...
Alternative implementation of ErgoTree interpreter wallet-related features - sigma-rust/eval.rs at 98898d62ff221eda8ae691a173c056dcb0ee83ce ¬∑ ergoplatform/sigma-rust
https://images-ext-1.discordapp.net/external/6gKB4MBNipaOvWWLu4pU5h7SjVKZB660xyC0NG0Zd0Y/https/opengraph.githubassets.com/00c03226d1023a19a1e1705f7bc87b483de9247dd7ae9d08ac3547bd656ae671/ergoplatform/sigma-rust


[08/12/2022 4:44 AM] greenhat#6562
So the scripts returning other than sigma prop or boolean will give an error on evaluation.


[08/12/2022 5:40 AM] Omnia#7128
what is a sigmaprop on earth?


[08/12/2022 5:50 AM] Omnia#7128
so ergotree can not be explicitly evaluated in the ergoscript since no function support evaluating within the script. how dose zkpoof work?


[08/12/2022 4:47 PM] Quwin#6226
A token ID in ErgoScript is always 32 bytes right


[08/12/2022 5:36 PM] Cheese Enthusiast#0548
Yes, I believe all id's (box ids, blocks ids, tx ids, token ids) are 32 bytes

{Reactions}
üëç 

[08/12/2022 7:16 PM] 6directions#1089
is there an easy way to see why a script reduced to false? so far have been relying on process of elimination - remove conditions and slowly add them back to see which one causes the script to fail


[08/12/2022 7:21 PM] dusek#6153
you could try testing  the ergoscript conditions in your actual code


[08/12/2022 7:21 PM] dusek#6153
I don't think there's any way to very easily debug an ErgoTree


[08/12/2022 7:24 PM] Quwin#6226
ErgoScript would be so beautiful if there was a full Syntax checker with stuff like type checking and making sure values line up (like comparing Coll[Bytes])


[08/12/2022 8:12 PM] dusek#6153
An interpreter would be nice


[08/12/2022 8:12 PM] dusek#6153
So you could step line by line


[08/13/2022 12:46 PM] MrStahlfelge#0042
for real complicated situations, I launched the script in scala with attached debugger


[08/13/2022 1:45 PM] MGpai#4313
bro yes


[08/13/2022 1:46 PM] MGpai#4313
@Cheese Enthusiast you have something...like an extension right?


[08/13/2022 9:35 PM] Quwin#6226
https://discord.com/channels/668903786361651200/1008110655607418920/1008110655607418920


[08/14/2022 4:39 PM] 6directions#1089
how do you "launch the script in scala" ?


[08/14/2022 9:37 PM] MrStahlfelge#0042
set up a scala project with "specs"(aka unit tests) and calling the code there within a unit test


[08/14/2022 11:05 PM] 6directions#1089
But is it possible to actually set breakpoints and step through the ergoscript contract itself?


[08/14/2022 11:07 PM] MrStahlfelge#0042
No but ergoscript is very similar to Scala and you can set breakpoints in scala


[08/15/2022 9:14 AM] morphic#4133
ErgoScript is a text, usually placed in strings (in string literals to be precise). It is not possible to put a breakpoint in strings. 
However, ErgoScript is a subset of Scala (by design) and there is a comprehensive test suite (see SigmaDslSpecification) that checks ErgoScript - Scala equivalence.
There is an example in sigmastate-interpreter repo https://github.com/ScorexFoundation/sigmastate-interpreter/blob/83dc78b5c80b11dcab41ba8aa75a0a8a650e6473/sigmastate/src/test/scala/sigmastate/utxo/examples/AssetsAtomicExchange.scala#L29 which demonstrate debugging capability.
Put a breakpoint on the line above and then do debug run of this test https://github.com/ScorexFoundation/sigmastate-interpreter/blob/401d40a22430661ed5a397098633465b1e39e3bc/sigmastate/src/test/scala/sigmastate/utxo/examples/AssetsAtomicExchangeTests.scala#L46
It should stop on the breakpoint.

{Reactions}
üëç üôè 

[08/17/2022 10:06 AM] Luivatra#9076
anyone used tuples/pairs in their registers? Getting this when trying to sign:
```
Exception in thread "main" scalan.Base$StagingException: Error in Evaluation.compile.evaluate(s7440 -> Cast(SizePairElem<SizePair[(Long, AvlTree), Long, AvlTree]>, s7430))
Caused by: sigmastate.lang.exceptions.CosterException: Invalid cast Cast(SizePairElem<SizePair[(Long, AvlTree), Long, AvlTree]>, s7430): interface special.collection.SizePair is not assignable from class special.collection.CSizePrim
```


[08/18/2022 8:06 AM] morphic#4133
What is your contract?


[08/18/2022 8:20 AM] Luivatra#9076
I used to have R6 and R7 in on register, split them up now to move on. It could easily be a bug in my code/contract that caused it. https://github.com/ergo-pad/paideia-sdk/blob/main/src/main/resources/ergoscript/PlasmaStaking/latest/PlasmaStaking.es

{Embed}
https://github.com/ergo-pad/paideia-sdk/blob/main/src/main/resources/ergoscript/PlasmaStaking/latest/PlasmaStaking.es
paideia-sdk/PlasmaStaking.es at main ¬∑ ergo-pad/paideia-sdk
optimized calls to scala functions. Contribute to ergo-pad/paideia-sdk development by creating an account on GitHub.


[08/18/2022 8:44 AM] morphic#4133
I mean can you show the contract in which you try to access the pair in the register?


[08/18/2022 8:46 AM] Luivatra#9076
I changed it to avoid the error. I used to have R6[Coll[(Long,AvlTree)].get and access them through ._1 and ._2 so now I just split the register up into Coll[Long] and Coll[AvlTree]


[08/18/2022 8:49 AM] morphic#4133
yeah, if you can find a workaround it is the way to go until v5.0 is activated. The error above is from AOT costing of v4.x and will go away with v5.0


[08/18/2022 8:49 AM] Luivatra#9076
that is what I figured, thanks for confirming that


[08/18/2022 2:36 PM] Omnia#7128
why go away? in 5.0, the cost is different?


[08/18/2022 2:38 PM] glasgowm#9381
5.0 is a costing upgrade

https://ergoplatform.org/en/blog/2022-02-09-ergos-hybrid-method-for-counting-costs/


[08/18/2022 2:38 PM] morphic#4133
The error above is due to limitations of v4.x, basically shows AOT costing doesn't scale with complexity of contracts


[08/18/2022 4:01 PM] Omnia#7128
so 5.0 can estimate the cost more precisely?


[08/18/2022 6:09 PM] morphic#4133
No, v5.0 will work in many situations where v4.x just doesn't work (like the above case)

{Reactions}
üëç 

[08/19/2022 9:17 PM] nitram147#5106
Any help with AOT costing related error


[08/19/2022 9:17 PM] nitram147#5106
See


[08/19/2022 9:17 PM] nitram147#5106
https://scastie.scala-lang.org/eCqWg7VrSPSZEDT8uQBF8Q

{Embed}
https://scastie.scala-lang.org/eCqWg7VrSPSZEDT8uQBF8Q
Scastie - An interactive playground for Scala.
/* +----------------------------------+ */
/* |      EIP-0031 - Babel Fees       | */
/* |       eip31proposal.scala        | */
/* |   (c)copyright nitram147 2022    | */
/* +----------------------------------+ */

// This file contains reference implementation of EIP-0031 proposal in Scala & ErgoScript for "Ergo Playground"
// (Smartcontract t...
https://images-ext-2.discordapp.net/external/ShkQTgvvG8UjMiDn9S4Yln0qIL78mBqhFH5aLJnvGUY/https/scastie.scala-lang.org/public/sharing-image-small-red.png


[08/19/2022 9:17 PM] nitram147#5106
I wanted to upgrade babel fee box scripts, but no matter where I add checks to make evaluation "lazier", it still fails


[08/19/2022 9:18 PM] nitram147#5106
```Scala
{

    val babelFeeBoxCreator = SELF.R4[SigmaProp].get
    
    val isRecreatedBabelFeeBox = {(outputBox: Box) => (
        outputBox.propositionBytes == SELF.propositionBytes &&
        outputBox.R4[SigmaProp].get == SELF.R4[SigmaProp].get &&
        outputBox.R5[Long].get == SELF.R5[Long].get &&
        outputBox.tokens(0)._1 == tokenId &&
        outputBox.R6[Coll[Byte]].get == SELF.id
    )}

    val recreatedBox = OUTPUTS.filter(isRecreatedBabelFeeBox)(0)

    val nanoErgsDifference = SELF.value - recreatedBox.value
    val babelTokensBefore = if(SELF.tokens.size > 0){ SELF.tokens(0)._2 }else{ 0L }
    val babelTokensDifference = recreatedBox.tokens(0)._2 - babelTokensBefore
    val exchangeOK = babelTokensDifference * SELF.R5[Long].get >= nanoErgsDifference

    val allOK = { if(OUTPUTS.exists(isRecreatedBabelFeeBox)) { exchangeOK && (nanoErgsDifference >= 0) } else {false} }

    sigmaProp(
        babelFeeBoxCreator || allOK
    ) 
}
```


[08/19/2022 9:20 PM] nitram147#5106
In "normal" case it doesn't matter - when somebody construct bad transaction it will fail. However in owner withdrawal transaction (which is destroying the babel fee box), there wouldn't be any box fulfilling the isRecreatedBabelFeeBox condition, thus recreatedBox will fail (referencing first element of empty Coll).


[08/19/2022 9:20 PM] nitram147#5106
I wanted to prevent those reference by those condition in allOK (that there exists such a box otherwise it will became false)


[08/19/2022 9:21 PM] nitram147#5106
It doesn't work. I tried adding similar condition everywhere, tried also many different ways to write same behavior, however it always fails highly probably due to AOT costing


[08/19/2022 9:21 PM] nitram147#5106
Any help? üôÇ


[08/19/2022 9:26 PM] Cheese Enthusiast#0548
You could try `OUTPUTS.filter(isRecreatedBabelFeeBox).getOrElse(0, SELF)` and then add a condition such that `recreatedBox.id != SELF.id`


[08/19/2022 9:26 PM] Cheese Enthusiast#0548
So that it will fail gracefully


[08/19/2022 9:28 PM] Cheese Enthusiast#0548
I suppose second condition is technically not necessary


[08/19/2022 9:28 PM] Cheese Enthusiast#0548
Because it would be impossible to have SELF be in INPUTS and OUTPUTS


[08/19/2022 9:28 PM] Cheese Enthusiast#0548
But I would add it in just in case


[08/19/2022 9:38 PM] nitram147#5106
I don't like the idea of double checking, but this would also work


[08/19/2022 9:38 PM] nitram147#5106
```Scala
{

    val babelFeeBoxCreator = SELF.R4[SigmaProp].get
    
    val isRecreatedBabelFeeBox = {(outputBox: Box) => (
        outputBox.propositionBytes == SELF.propositionBytes &&
        outputBox.R4[SigmaProp].get == SELF.R4[SigmaProp].get &&
        outputBox.R5[Long].get == SELF.R5[Long].get &&
        outputBox.tokens(0)._1 == tokenId &&
        outputBox.R6[Coll[Byte]].get == SELF.id
    )}

    val recreatedBox = OUTPUTS.filter(isRecreatedBabelFeeBox).getOrElse(0, SELF)

    val nanoErgsDifference = SELF.value - recreatedBox.value
    val babelTokensBefore = if(SELF.tokens.size > 0){ SELF.tokens(0)._2 }else{ 0L }
    val babelTokensDifference = recreatedBox.tokens(0)._2 - babelTokensBefore
    val exchangeOK = babelTokensDifference * SELF.R5[Long].get >= nanoErgsDifference

    val allOK = { if(OUTPUTS.exists(isRecreatedBabelFeeBox)) { exchangeOK && (nanoErgsDifference >= 0) } else {false} }

    sigmaProp(
        babelFeeBoxCreator || allOK
    ) 
}
```


[08/19/2022 9:39 PM] nitram147#5106
Basically used your approach and let the exists constrain in the place


[08/19/2022 9:39 PM] nitram147#5106
What do you think @Cheese Enthusiast


[08/19/2022 9:41 PM] Cheese Enthusiast#0548
I would still add the id check just in case. I'm scared that someone could model a box in a certain way so that it mirrors parts of `SELF` and have the contract execute in a weird manner


[08/19/2022 9:41 PM] Cheese Enthusiast#0548
Maybe it's unnecessary but better safe than sorry imo


[08/19/2022 9:43 PM] nitram147#5106
Could you elaborate a bit more what you mean by the first message


[08/19/2022 9:43 PM] nitram147#5106
this


[08/19/2022 9:45 PM] Cheese Enthusiast#0548
If `recreatedBox` evaluates to `SELF`, but only parts of it are checked then there may be some ways to execute the contract so that only the parts that are checked cause it to evaluate to true


[08/19/2022 9:51 PM] Cheese Enthusiast#0548
Idk I could be wrong too, I just think it's better to be safe in this case


[08/19/2022 10:32 PM] nitram147#5106
I can try to recursively explain it to you and do "rubber duck debugging" üòÑ
There are two conditions check and it's enough for just one of them to evaluate to `true`.
Either the:
- `babelFeeBoxCreator` is `true` - owner can do anything, we can allow this box to be spend by any owner signed transaction
- `allOK` is `true`
So dive one level deeper, first it's checked whether there exist correctly recreated babel fee box (by correctly I mean that registers contains required values), if it's not it will fallback to `false`. If there exist such a box more conditions will be evaluated but this means that the `getOrElse ` will return the recreatedBox and not SELF, so all the upcoming checks will be done on reacreatedBox and not on SELF !!!
Checks check that the exchange was ok and also that it was swap buying ERGs for babel tokens and not vice verse (this is the reason for (nanoErgsDifference >= 0) condition).

{Reactions}
üëç 

[08/19/2022 10:32 PM] nitram147#5106
@Cheese Enthusiast


[08/19/2022 10:33 PM] nitram147#5106
Could you go through the code and check that my explanation is compliant with the code I've sent? üôÇ


[08/19/2022 10:34 PM] nitram147#5106
Read the message I've sent - this would never happen


[08/19/2022 10:47 PM] Cheese Enthusiast#0548
Probably, correct. I‚Äôm not at my computer right now so didnt have the time to check. Just assumed the id check might be a good idea


[08/19/2022 10:50 PM] Cheese Enthusiast#0548
If it helps, I can check it out more in depth later


[08/20/2022 5:04 PM] Quwin#6226
I'm trying to use a function with a parameter of `Option[Int]` but in Ergoscript `None` is of type `Option[NoType]` instead of `Option[Int]`. How do I fix that?


[08/20/2022 5:44 PM] morphic#4133
Option type is not fully implemented currently. In particular you cannot use None and Some in ErgoScript. 
What is your contract code BTW?


[08/20/2022 7:32 PM] Quwin#6226
Nothing too complex, I just wanted to use the global `avlTree()` function to save space because I want to store an AvlTree inside another AvlTree for reasons
```scala
{
val digest = SELF.R4[Coll[Byte]].get

val tree = avlTree(5.toByte, digest, 32, None)

...
}
```


[08/20/2022 7:47 PM] Cheese Enthusiast#0548
Depending on your implementation, you might be able to provide a placeholder tree, then use `updateDigest` to apply the correct digest to it.

{Reactions}
üëç 

[08/24/2022 10:01 AM] Luivatra#9076
anyone can see an issue here?
```
def byteArrayToLongArray(b: Coll[Byte]): Coll[Long] = {b.indices.filter{(i: Int) => (i%8)==0}.map{(i: Int) => byteArrayToLong(b.slice(i,i+8))}}
```


[08/24/2022 10:02 AM] Luivatra#9076
get this weird error when trying to use it:
scalan.Base$StagingException: Don't know how to evaluate(s17122 -> Placeholder(PairElem<(Coll[Byte], Coll[Byte])>))


[08/24/2022 10:51 AM] Luivatra#9076
nvm, it seems to be working fine elsewhere


[08/24/2022 12:12 PM] morphic#4133
doesn't look like the whole contract, why you think the issued in this code?


[08/24/2022 12:44 PM] Luivatra#9076
replacing a call to this function with (only needed the first element in this case):
```
Coll(byteArrayToLong(b.slice(0,8))
```
worked fine


[08/24/2022 12:45 PM] Luivatra#9076
anyways, I refactored the contract a bit and got it working


[08/24/2022 12:45 PM] Luivatra#9076
turns out the indices method is expensive anyways so had to take that out and precalculate it


[08/24/2022 12:47 PM] Luivatra#9076
is there an overview anywhere for function costs?


[08/24/2022 2:09 PM] morphic#4133
It is not the overview, but this table defines operation costs in v4.x https://github.com/ScorexFoundation/sigmastate-interpreter/blob/05bb3f0bf6d8d6a2add4053abe015ec00a7380a2/sigmastate/src/main/scala/sigmastate/utxo/CostTable.scala#L100

{Reactions}
üëç 

[08/24/2022 2:10 PM] Luivatra#9076
any known issues with fold? Cost seems to explode at some point


[08/24/2022 2:10 PM] morphic#4133
also, in v4.x ErgoTree has complexity measure defined by this table https://github.com/ScorexFoundation/sigmastate-interpreter/blob/e776b81605a65db3ec06f60b0105d7a9264c34f5/sigmastate/src/main/scala/sigmastate/utxo/ComplexityTable.scala#L13


[08/24/2022 2:11 PM] morphic#4133
fold is mostly broken in v4.x, suggest to wait for v5.0


[08/24/2022 2:12 PM] Luivatra#9076
ok, I will just test with smaller transactions for now.


[08/24/2022 2:13 PM] Luivatra#9076
will there be an appkit based on 5.0 at some point (I mean before we switch)


[08/24/2022 2:36 PM] morphic#4133
yeah, this is good idea, I can release Appkit 5.0 based on Sigma version currently used for v5.0 Ergo node release candidate


[08/24/2022 2:39 PM] morphic#4133
https://github.com/ergoplatform/ergo-appkit/issues/190

{Embed}
https://github.com/ergoplatform/ergo-appkit/issues/190
Prepare Appkit v5.0 ¬∑ Issue #190 ¬∑ ergoplatform/ergo-appkit
Should be based on Sigma version currently used for v5.0 Ergo node release candidate.
https://images-ext-1.discordapp.net/external/ZsN-XUGL_bO8i--y5SzW2VAOZmQJWK49BrN4PQynHb4/https/opengraph.githubassets.com/afc2f44892b2ffceeb96d0c9595cc57fb4b27ec0d3689cc87a0864b4d25ffb43/ergoplatform/ergo-appkit/issues/190

{Reactions}
üî• (5) 

[08/24/2022 2:57 PM] Luivatra#9076
that would be great!


[08/29/2022 11:56 AM] Luivatra#9076
Any thoughts on why this:
```
val currentStake: Coll[Long] = currentStakes(index)
val reward: Coll[Long] = rewards(index)
val newStake: Coll[Long] = currentStake.zip(reward).map{(ll: (Long,Long)) => ll._1+ll._2}
```
would give the following error:
```
Cause: scalan.Base$StagingException: Don't know how to evaluate(s22876 -> Placeholder(BaseElemLiftable<Int>))
  at scalan.Base.$bang$bang$bang(Base.scala:37)
  at sigmastate.eval.Evaluation.$anonfun$compile$1(Evaluation.scala:743)
  at sigmastate.eval.Evaluation.$anonfun$compile$8(Evaluation.scala:759)
  at scala.collection.IndexedSeqOptimized.foldLeft(IndexedSeqOptimized.scala:60)
  at scala.collection.IndexedSeqOptimized.foldLeft$(IndexedSeqOptimized.scala:68)
  at scala.collection.mutable.WrappedArray.foldLeft(WrappedArray.scala:38)
  at sigmastate.eval.Evaluation.$anonfun$compile$7(Evaluation.scala:758)
  at sigmastate.eval.IRContext.$anonfun$checkCostWithContext$1(IRContext.scala:130)
  at scala.runtime.java8.JFunction0$mcI$sp.apply(JFunction0$mcI$sp.java:23)
  at scala.util.Try$.apply(Try.scala:213)
  at sigmastate.eval.IRContext.checkCostWithContext(IRContext.scala:127)
  at sigmastate.eval.IRContext.checkCostWithContext$(IRContext.scala:126)
  at sigmastate.eval.RuntimeIRContext.checkCostWithContext(IRContext.scala:145)
  at sigmastate.interpreter.PrecompiledScriptReducer.$anonfun$reduce$2(PrecompiledScriptProcessor.scala:84)
  at org.ergoplatform.validation.ValidationRules$.trySoftForkable(ValidationRules.scala:375)
  at sigmastate.interpreter.PrecompiledScriptReducer.reduce(PrecompiledScriptProcessor.scala:81)
  at sigmastate.interpreter.Interpreter.fullReduction(Interpreter.scala:186)
  at sigmastate.interpreter.Interpreter.fullReduction$(Interpreter.scala:174)
```


[08/29/2022 4:27 PM] morphic#4133
The `index`, where is comes from?


[08/29/2022 4:52 PM] Luivatra#9076
It is inside a map over indices of a coll


[08/29/2022 5:00 PM] Cheese Enthusiast#0548
I think I remember running into AOT errors when doing certain functions over `.indices` üòÖ


[08/29/2022 5:26 PM] Luivatra#9076
I vote for banning the word AOT after 5.0 activation to prevent evaluation error induced ptsd


[08/29/2022 5:35 PM] morphic#4133
Ah, this is not supported. Lambda variable (function argument) cannot be in position of collection index.
Also AOT (it is not yet banned :)) have some bugs with nested lambdas.


[08/29/2022 5:38 PM] morphic#4133
It seems most of the problem you have has to do with AOT. Sorry for that, but until v5.0 you cannot think free. Try to simplify the contract as much as you can, and try to not use lambdas.


[08/29/2022 5:40 PM] morphic#4133
The countdown has already been started, hope after some time AOT will be buried in history.


[08/29/2022 5:42 PM] Luivatra#9076
It is working elsewhere, but its ok, wen 5.0 appkit? üòâ


[08/29/2022 5:44 PM] morphic#4133
Hope to finish review of Benjamin's huge PR today. Next up is Appkit 5.0

{Reactions}
üî• (3) 

[08/31/2022 5:48 PM] morphic#4133
Snapshot version is published https://github.com/ergoplatform/ergo-appkit/runs/8118511789?check_suite_focus=true#step:6:34

{Embed}
https://github.com/ergoplatform/ergo-appkit/runs/8118511789?check_suite_focus=true
Migrate to sigma v5.0 ¬∑ ergoplatform/ergo-appkit@cd2af8e
Appkit: A Library for Polyglot Development of Ergo Applications - Migrate to sigma v5.0 ¬∑ ergoplatform/ergo-appkit@cd2af8e
https://images-ext-1.discordapp.net/external/2RApfs96U027CQVs3YxI5aqVIrs88qXY-wpJqLpq3Gk/https/opengraph.githubassets.com/ed05418b765ffc910c2ee99e67eb2d57f8882b7dc728fbbf36e24cd4040f0d01/ergoplatform/ergo-appkit

{Reactions}
üî• 

[08/31/2022 6:56 PM] Luivatra#9076
so this one automatically adapts to the version of the node?


[08/31/2022 7:11 PM] morphic#4133
Yes, it should. Actually Appkit adapts since v3.x, so this part is not changed in this PR

{Reactions}
üëç 

[09/16/2022 4:45 PM] liquid_phase#4605
@kushti our 'mutual release of works' smart contract has been completed. Can this be security audited to ensure safety?


[09/17/2022 11:43 PM] zargarzadehmoein#2928
Hi
Nice to meet you

I saw your script, there's a problem in your script in line `41`,  you want to check R4 and R5 in the second input (INPUTS(1)) but there isn't INPUTS(1) in your tx (line `152`)


[09/18/2022 11:11 PM] MGpai#4313
```scala
  {
  //constants: winnerContractSingleton, ticketContractSingleton
    val winnerContract = INPUTS(0)
    val validSingleton = winnerContract.tokens(0)._1 == winnerContractSingleton
    val transferToWinnerContract = allOf(
    Coll(
        OUTPUTS(0).propositionBytes == winnerContract.propositionBytes,
        OUTPUTS(0).value == SELF.value - 1000000L
       )
       )
       
    val ticketContractToken = OUTPUTS(1).tokens(0)._1 == ticketContractSingleton //ensures ticket contract's singleton is in output
    val newPool = OUTPUTS(2).propositionBytes == SELF.propositionBytes //ensures output recreates pool
    if (!validSingleton) {
    sigmaProp(ticketContractToken && newPool)
    }
    else {
    sigmaProp(validSingleton && transferToWinnerContract)
    }
    
  }
```


[09/18/2022 11:12 PM] MGpai#4313
Been having issues using this contract


[09/18/2022 11:12 PM] MGpai#4313
If I remove the if/else statements and just leave `sigmaProp(ticketContractToken && newPool)`
it works


[09/18/2022 11:13 PM] MGpai#4313
Could this be an AOT issue? @morphic


[09/19/2022 9:36 AM] morphic#4133
Maybe, what is the error message?
Also, I think you can rewrite the condition without `if`.


[09/19/2022 11:01 AM] MGpai#4313
I had it as such initially `sigmaProp((validSingleton && transferToWinnerContract) || (ticketContractToken && newPool))`


[09/19/2022 11:02 AM] MGpai#4313
Not sure what the error message is since this happens in python


[09/19/2022 11:02 AM] MGpai#4313
https://media.discordapp.net/attachments/1009149445985800332/1020430041571676290/unknown.png

{Embed}
https://media.discordapp.net/attachments/1009149445985800332/1020430041571676290/unknown.png
https://media.discordapp.net/attachments/1009149445985800332/1020430041571676290/unknown.png


[09/19/2022 11:03 AM] MGpai#4313
https://media.discordapp.net/attachments/1009149445985800332/1020435337669001296/Screenshot_2022-09-16_164520.png

{Embed}
https://media.discordapp.net/attachments/1009149445985800332/1020435337669001296/Screenshot_2022-09-16_164520.png
https://media.discordapp.net/attachments/1009149445985800332/1020435337669001296/Screenshot_2022-09-16_164520.png


[09/19/2022 12:14 PM] morphic#4133
Yeah, this doesn't help much üôÇ


[09/19/2022 12:15 PM] morphic#4133
It still doesn't work?


[09/19/2022 12:25 PM] MGpai#4313
No


[09/19/2022 12:26 PM] MGpai#4313
To get JIT do I need to use the app kit 5.0 branch?


[09/19/2022 12:28 PM] morphic#4133
Yes, but you also need to make sure that BlockchainContext has blockVersion >= 3 in parameters


[09/19/2022 12:28 PM] MGpai#4313
How do you check?


[09/19/2022 12:28 PM] MGpai#4313
Is it in the explorer?


[09/19/2022 12:29 PM] morphic#4133
It comes from `info` API request of the node


[09/19/2022 12:31 PM] morphic#4133
If you connect to a network where 5.0 has already been activated then appkit should read this parameter automatically


[09/21/2022 2:31 AM] MGpai#4313
so 5.0 appkit seems to be giving me an error now at least


[09/21/2022 2:31 AM] MGpai#4313


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/1021956847093166182/message.txt


[09/21/2022 2:32 AM] MGpai#4313
```java
java.lang.java.lang.ArrayIndexOutOfBoundsException: java.lang.ArrayIndexOutOfBoundsException: Index 0 out of bounds for length 0
```


[09/21/2022 3:08 AM] MGpai#4313
ok I got it to finally work


[09/21/2022 3:08 AM] MGpai#4313
```scala
  {
  //constants: winnerContractSingleton, ticketContractSingleton
    val winnerContract = INPUTS(0)
    val validSingleton = winnerContract.tokens.exists{ (t: (Coll[Byte], Long)) => t._1 == winnerContractSingleton}
    if (validSingleton) {
        val transferToWinnerContract = allOf(
    Coll(
        OUTPUTS(0).propositionBytes == winnerContract.propositionBytes,
        OUTPUTS(0).value == SELF.value - 1000000L
       )
       )
       sigmaProp(validSingleton && transferToWinnerContract)
    }
    else {
    val ticketContractToken = OUTPUTS(1).tokens.exists{ (t: (Coll[Byte], Long)) => t._1 == ticketContractSingleton} //ensures ticket contract's singleton is in output
    val newPool = OUTPUTS(2).propositionBytes == SELF.propositionBytes //ensures output recreates pool
    sigmaProp(ticketContractToken && newPool)
    }
  }
```

{Reactions}
üéâ 

[09/22/2022 8:34 PM] wombo22#5461
https://twitter.com/hazeyonekenobi/status/1573001825267105798?s=46&t=iJVmOzgFNDva-zT16XNzuw

{Embed}
HazŒ£yOneKenobi (@HazeyOneKenobi)
https://twitter.com/hazeyonekenobi/status/1573001825267105798?s=46&t=iJVmOzgFNDva-zT16XNzuw
Calling all #Ergoscript devs!

Please read this limit order token swap contract, and offer any suggestions or outline any issues!

The effect this has would be totally decentralised partial or full fill trades, meaning you can limit order erg/sigusd. 

https://t.co/XsVVBFoR5d
Twitter

{Reactions}
üëç 

[10/10/2022 6:10 AM] MGpai#4313
@morphic how do I access r8 of a token/nft in a contract?


[10/10/2022 6:35 AM] Krasavice Blasen#4574
You can only access the issuer box registers (which is the box that shares the tokenId of the NFT)


[10/10/2022 6:38 AM] Krasavice Blasen#4574
Well, ultimately you can access any box in ergoscript (even spent boxes, if you encode the spent box in a register).
But for NFT's, to authenticate the box all you have is the token Id, so the only box you can authentically check is the issuer box.


[10/10/2022 6:39 AM] Krasavice Blasen#4574
This is what marketplaces do, they encode the issuer box in the sale UTXO and can read the details of the box (i.e. the prop bytes to use for royalty payment), but of course they need to check tokenId matches box Id or else that box could be fake.


[10/10/2022 10:02 AM] MrStahlfelge#0042
it would have been better if the token properties would have been stored in the issueing box


[10/10/2022 2:42 PM] drehaf#0090
Sorry to hijack, I dm'd you with a ? if you have a sec üôÇ


[10/10/2022 3:45 PM] MGpai#4313
How do I access this ?


[10/10/2022 3:45 PM] MGpai#4313
No because then it appears you can't access this


[10/10/2022 9:28 PM] morphic#4133
I don't understand the question. what is r8?


[10/10/2022 9:31 PM] MGpai#4313
r8 of the issuance box


[10/10/2022 9:31 PM] MGpai#4313
issuance box is where the token is inside of after creation


[10/10/2022 9:32 PM] MGpai#4313
I was going to access this via dataInput however, if the user spends this box I cannot use it


[10/10/2022 9:32 PM] morphic#4133
box.R8[<type of register>].get


[10/10/2022 9:33 PM] MGpai#4313
what if the user spends it though? How can I get that data?


[10/10/2022 9:35 PM] morphic#4133
if the box is spent, it can be neither input nor data input. But you can put the Box instance itself inside a register


[10/10/2022 9:35 PM] morphic#4133
regardless of where you get that instance


[10/10/2022 9:36 PM] MGpai#4313
how do I access the issuer box (input of the token issuance box)?


[10/10/2022 9:36 PM] MGpai#4313
this box and the token share the same id


[10/10/2022 9:37 PM] morphic#4133
not sure, but you can find it either in UTXO set or from blockchain history (in the case it is spent)


[10/10/2022 9:38 PM] morphic#4133
sorry I don't know the details of the contracts


[10/10/2022 9:38 PM] MGpai#4313
because I know auction houses uses it for getting the royalty info


[10/10/2022 9:38 PM] MGpai#4313
the issuer box is always spend to make the token


[10/10/2022 9:43 PM] morphic#4133
we need to ask @anon_real about ^


[10/11/2022 12:53 AM] Krasavice Blasen#4574
You encode the issuer box in a register and then access it


[10/11/2022 1:03 AM] MGpai#4313
How does sky harbor do it to access royalty info?


[10/11/2022 1:05 AM] Krasavice Blasen#4574
Theres some wasm function which takes boxid and returns the encoded box


[10/11/2022 1:06 AM] Krasavice Blasen#4574
When users sell, they put this in the register of the sale contract. When a buyer purchases the contract accesses the encoded box prop bytes and r4 to get royalty address and percentage


[10/11/2022 1:44 AM] MGpai#4313
thank you, this makes sense now


[10/11/2022 6:58 AM] StackOverflow#0000
New Question From Stack Overflow.

{Embed}
kii
Filter within ErgoScript using Coll
https://stackoverflow.com/questions/74023530/filter-within-ergoscript-using-coll
tags: ergoscript


[10/11/2022 4:41 PM] anon_real#2768
Appkit supports it as well.


[10/11/2022 7:12 PM] morphic#4133
Replied there


[10/13/2022 1:16 PM] Krasavice Blasen#4574
Just something interesting Ive noticed but slicing with an interval outside of collection size does not throw any compilation error. 
i.e some script like 
```SELF.R4[Coll[Byte]].get.slice(5,10) == SELF.R4[Coll[Byte]].get.slice(5,9)```
evaluates true even when R4 is an empty collection
Is this something desirable? tbh I find it convenient but I just want to be sure this wont change in future


[10/13/2022 1:19 PM] Krasavice Blasen#4574
In fact just generally it seems that slicing a collection outside its bounds returns an empty collection.


[10/13/2022 7:02 PM] morphic#4133
yes, this will be preserved. Coll type is backed by Scala array and this is how `slice` implemented for arrays in Scala
```
  override def slice(from: Int, until: Int): Array[T] = {
     val reprVal = repr
     val lo = math.max(from, 0)
     val hi = math.min(math.max(until, 0), reprVal.length)
     val size = math.max(hi - lo, 0)
     val result = java.lang.reflect.Array.newInstance(elementClass, size)
     if (size > 0) {
      Array.copy(reprVal, lo, result, 0, size)
     }
     result.asInstanceOf[Array[T]]
  }
```


[10/14/2022 12:46 AM] Krasavice Blasen#4574
Ahh cool, thanks!


[10/18/2022 7:31 AM] StackOverflow#0000
New Question From Stack Overflow.

{Embed}
kii
Ergo - Unable to Parse ReducedTransaction, getting Not enough bytes in buffer
https://stackoverflow.com/questions/74106610/ergo-unable-to-parse-reducedtransaction-getting-not-enough-bytes-in-buffer
tags: ergoscript


[10/23/2022 8:01 PM] MGpai#4313
could you please share this wasm function?


[10/23/2022 8:01 PM] MGpai#4313
Or even if you have done it in appkit


[10/26/2022 12:59 AM] liquid_phase#4605
could a smart contract be written to "reject" (send-back) tokens it was not expecting to receive ?


[10/26/2022 12:59 AM] liquid_phase#4605
i'm asking to consider how to mitigate deposits from random actors into a specific box


[10/26/2022 8:20 AM] haileypdll#3353
Is it possible to use the CONTEXT.headers(0).timestamp as an expiration date for a contract ? Or it is necessary to rely on the creation height and a duration in number of block ?


[10/26/2022 10:06 AM] MrStahlfelge#0042
you can check that in the smart contract, but you need to cover all circumstances. most people will just send with blank registers, you can cover that


[10/26/2022 10:06 AM] MrStahlfelge#0042
auction house uses time stamp from preheader for the auctions.


[10/26/2022 10:32 AM] haileypdll#3353
Thanks, I'll have a look at their contract


[10/26/2022 3:08 PM] liquid_phase#4605
okay this is good to know and yes, essentially i want to prevent standard wallets from initiating transactions with my smart contract so ill need to block / send back any tx without registers


[11/09/2022 2:13 PM] Luivatra#9076
Getting this error:
```
java.lang.ClassCastException: class [Ljava.lang.Long; cannot be cast to class [J ([Ljava.lang.Long; and [J are in module java.base of loader 'bootstrap')
  at special.collection.CollOverArray.toArray$mcJ$sp(CollsOverArrays.scala:20)
  at sigmastate.DataValueComparer$.$anonfun$equalCOA_Prim$5(DataValueComparer.scala:173)
  at sigmastate.interpreter.ErgoTreeEvaluator.addSeqCost(ErgoTreeEvaluator.scala:338)
  at sigmastate.DataValueComparer$.equalCOA_Prim$mJc$sp(DataValueComparer.scala:169)
  at sigmastate.DataValueComparer$.equalColls_Dispatch(DataValueComparer.scala:230)
  at sigmastate.DataValueComparer$.equalDataValues(DataValueComparer.scala:332)
  at sigmastate.EQ.eval(trees.scala:1341)
```
When doing this:
```
proposalBasicOutput.R5[Coll[Long]].get == proposalBasicInput.R5[Coll[Long]].get,
```
But this is fine:
```
proposalBasicOutput.R5[Coll[Long]].get.zip(proposalBasicInput.R5[Coll[Long]].get).forall{(ll: (Long,Long)) => ll._1 == ll._2},
```


[11/09/2022 2:13 PM] Luivatra#9076
bug in compiler or am I missing something obvious


[11/09/2022 4:21 PM] morphic#4133
It is not obvious. How you create Coll[Long] collections which you put in the registers?


[11/09/2022 4:51 PM] Cheese Enthusiast#0548
I had similar errors caused by small issues converting between java and scala longs


[11/09/2022 4:53 PM] Cheese Enthusiast#0548
Would only show up when placed into a Coll. Might be worth trying to rule a problem like that out first.


[11/09/2022 6:31 PM] MrStahlfelge#0042
this was a problem with appkit that we hopefully solved - but I guess these are issues when running a SC?


[11/09/2022 9:17 PM] Luivatra#9076
yes but obviously the values are put in the register from code, scala in this case. Not using the new scala ergovalue builder yet, that would solve it?


[11/09/2022 10:09 PM] morphic#4133
yes, it should, that was the idea. Also, in Scala you can unintentionally put boxed Longs into array of type Array[Long]. If you then put such array into Coll[Long] you may get such exception as Array[Long] with boxed object has different type at runtime then Array[Long] of unboxed longs.

{Reactions}
üëç (2) 

[11/09/2022 10:10 PM] morphic#4133
In Scala there is no distinction between boxed and unboxed Long values. In Java they are completely different types.


[11/10/2022 9:18 AM] Luivatra#9076
confirmed to fix it, thanks!


[11/12/2022 4:48 AM] lgd#5847
i am in a theory of computation class and learned about DFA, NFAs, PDAs, and TM. If a tx in the eUTXO model is like a DFA, what are the inputs and outputs of a tx in the DFA model? Are the set of inputs like a word in the language the DFA accepts and the outputs a map from each state to the alphabet? or are each inputs words and the set of inputs the language itself? does that mean ErgoScript is a programming language for a DFA? Am I crazy?


[11/12/2022 6:38 AM] MGpai#4313
yes


[11/12/2022 4:39 PM] Telefragged#8068
Hey guys, trying to make a composable contract and this is what I came up with:
```scala
val selfIndex = INPUTS.map{ (b:Box) => b.id }.indexOf(SELF.id, 0)

val outputBox = OUTPUTS(selfIndex)
```

Basically finding the index of SELF in the inputs and expecting the output to be placed at the same index.
I also noticed the creationInfo field on the box type which states
```scala
  /** If `tx` is a transaction which generated this box, then `creationInfo._1`
    * is a height of the tx's block. The `creationInfo._2` is a serialized
    * transaction identifier followed by box index in the transaction outputs.
    */
  def creationInfo: (Int, Coll[Byte]) 
```

I'm assuming the box index is the same as what I'm calculating in the first example. Are there any examples of extracting the index from the second field of creationInfo?


[11/12/2022 4:45 PM] Telefragged#8068
Actually I guess it wouldn't be the same as the index of the output in one transaction isn't necessarily the same as the input index in another transaction


[11/12/2022 5:03 PM] Telefragged#8068
Also is there any way to calculate/estimate the cost of executing a script? I mapped the inputs to the box id assuming that the equality check for the byte collection is cheaper than box equality but this is purely guessing


[11/13/2022 4:12 AM] kii#8888
@Cheese Enthusiast have done something like this before


[11/13/2022 4:17 AM] Cheese Enthusiast#0548
SignedTx.GetCost in appkit


[11/13/2022 12:15 PM] Telefragged#8068
Thanks! Will try it out


[11/25/2022 10:48 PM] MGpai#4313
anyone familiar with how I can access timestamps in ergoscript?


[11/26/2022 1:41 AM] Krasavice Blasen#4574
CONTEXT.headers(0).timestamp for last block I think 
And CONTEXT.preHeader.timestamp for upcoming block I presume


[11/26/2022 1:46 AM] MGpai#4313
What is the format for the timestamps?


[11/26/2022 1:47 AM] MGpai#4313
I want a certain function to work only after x days


[11/26/2022 1:47 AM] Krasavice Blasen#4574
Im fairly sure they are just a Long of timestamp in miliseconds.

{Reactions}
üëç 

[11/26/2022 1:47 AM] MGpai#4313
I see thanks


[11/28/2022 11:13 PM] MGpai#4313
Is it possible to allow something in ergoscript if the proxy address is empty?


[11/29/2022 8:20 AM] Krasavice Blasen#4574
Like check the balance of an address? No. But I think there would likely be workarounds to achieve your goal if this is the case

{Reactions}
‚òùÔ∏è 

[12/01/2022 11:28 PM] bk#4411
Is there an ergoscript syntax for a function with multiple args?? I expected the scala syntax like this to work:
```
{

  def foo (a: Int,  b: Int): Int = {
    a + b
  }

  foo(0, 0) == 0
}
```
but I get
 ```
line 3:   def foo (a: Int,  b: Int): Int = {
              ^
Don't know how to evalNode(Lambda(List(),Vector((a,SInt$), (b,SInt$)),SInt$,Some(Plus(Ident(a,SInt$), Ident(b,SInt$)))))
```


[12/01/2022 11:57 PM] Cheese Enthusiast#0548
I think 5.0 fixes this, until then use Pairs or Colls to get multiple args


[12/02/2022 12:01 AM] bk#4411
It look like I am using 5 (`sigma-state_2.12-5.0.2.jar`)?


[12/02/2022 12:02 AM] Cheese Enthusiast#0548
Are you connected to testnet or mainnet


[12/02/2022 12:02 AM] Cheese Enthusiast#0548
If connected to mainnet, it will default to the 4.0 interpreter as that's what is currently running on mainnet


[12/02/2022 12:02 AM] Cheese Enthusiast#0548
5.0 launches in roughly 4-5 days


[12/02/2022 12:05 AM] bk#4411
I don't think I am even getting that far.  I think it is failing during a signing step inside ergo-appkit before I'm actually hitting the network.


[12/02/2022 12:06 AM] Cheese Enthusiast#0548
Signing the tx uses the network context, so you're definitely connected to a network


[12/02/2022 12:06 AM] bk#4411
ah OK.  Well it is testnet


[12/02/2022 12:06 AM] Cheese Enthusiast#0548
Is the node port you're using 9052 or 9053?


[12/02/2022 12:06 AM] bk#4411
9052


[12/02/2022 12:06 AM] Cheese Enthusiast#0548
Ah weird


[12/02/2022 12:06 AM] Cheese Enthusiast#0548
Maybe it's not fixed in 5.0 then


[12/02/2022 12:07 AM] Cheese Enthusiast#0548
In that case I would just use pairs for functions


[12/02/2022 12:07 AM] Cheese Enthusiast#0548
You also might have an easier time using lambdas as functions instead


[12/02/2022 12:07 AM] Cheese Enthusiast#0548
I don't think that parameter size is an issue there, but I may be forgetting


[12/02/2022 12:09 AM] bk#4411
so I need to do tuples of tuples of tuples?  like `(Int, (( Int, Int), (Int, Int)))` for 5 args?


[12/02/2022 12:10 AM] Cheese Enthusiast#0548
That's another good question. I *think* tuples larger than 2 elements are allowed in 5.0, but might be wrong again


[12/02/2022 12:10 AM] Cheese Enthusiast#0548
If they're all the same type, just use a `Coll`


[12/02/2022 12:10 AM] Cheese Enthusiast#0548
If not, then try using a tuple with > 2 elems. If that still doesn't work, then pairs of pairs is the answer.


[12/02/2022 12:10 AM] bk#4411
They aren't the same type unfortunately


[12/02/2022 12:12 AM] Cheese Enthusiast#0548
You could also try lambdas, e.g

```
val foo = {
  (x: Int, y: Long, z: Int) =>
  x + y + z
}

val bar = foo(2, 3L, 2)
```

I believe that should be valid


[12/02/2022 12:13 AM] Cheese Enthusiast#0548
If I have time later today I'll do some testing on this stuff and let you know


[12/02/2022 12:14 AM] bk#4411
doesn't seem to work with multiple vars...


[12/02/2022 12:16 AM] Cheese Enthusiast#0548
Is it a runtime or compiletime error?


[12/02/2022 12:16 AM] Cheese Enthusiast#0548
I just quickly tested it and it seemed to work for me


[12/02/2022 12:16 AM] bk#4411
compile


[12/02/2022 12:17 AM] Cheese Enthusiast#0548
Hmm okay


[12/02/2022 12:17 AM] Cheese Enthusiast#0548
Ill do some more experimentation later tonight


[12/02/2022 12:17 AM] bk#4411
```[error] (Compile / run) sigmastate.lang.exceptions.CosterException: 
[error] line 9:   (a: Int, b: Int) => { a + b }
[error]           ^
[error] Don't know how to evalNode(Lambda(List(),Vector((a,SInt$), (b,SInt$)),SInt$,Some(Plus(Ident(a,SInt$), Ident(b,SInt$)))))```


[12/02/2022 12:18 AM] Cheese Enthusiast#0548
Until then I would just use pairs


[12/02/2022 12:18 AM] bk#4411
```val foo = {
  (a: Int, b: Int) => { a + b }
}```


[12/02/2022 12:34 AM] bk#4411
This is probably a silly question, but can a function take in a generic arg?


[12/02/2022 12:49 AM] bk#4411
and can functions take in a first class function as an arg?  It seems like they can't...


[12/02/2022 1:15 AM] Cheese Enthusiast#0548
They should be able to, given that functions like fold exist which use functions as parameters


[12/02/2022 1:36 AM] bk#4411
I mean like user defined functions, not the built in ones.


[12/02/2022 3:56 PM] morphic#4133
Your are right. Seems like nobody tried it before. This is a limitation of the current TypeSerializer. Created a test case and an issue. https://github.com/ScorexFoundation/sigmastate-interpreter/issues/847

{Embed}
https://github.com/ScorexFoundation/sigmastate-interpreter/issues/847
Serialize SFunc in TypeSerializer ¬∑ Issue #847 ¬∑ ScorexFoundation/s...
This test case should work instead of throwing an exception sigmastate-interpreter/sigmastate/src/test/scala/special/sigma/SigmaDslSpecification.scala Line 10040 in b754e14 property(&quot;highe...
https://images-ext-1.discordapp.net/external/_Fci5t8OoJEUW26bSXpelkf-z5jqisOUTNUYdtFLjlY/https/opengraph.githubassets.com/9fac3eee8679ea9e187096a7fdf267a71be0d3a036cff2cf5902d9a19ad26700/ScorexFoundation/sigmastate-interpreter/issues/847


[12/02/2022 3:56 PM] morphic#4133
Can be done in v6.0 soft-fork

{Reactions}
üôè 

[12/02/2022 4:03 PM] morphic#4133
What is your use case, BTW?


[12/02/2022 4:03 PM] bk#4411
I am trying to write a function to compare if two boxes are the same.


[12/02/2022 4:03 PM] morphic#4133
b1 == b2 ?


[12/02/2022 4:05 PM] bk#4411
or I guess almost the same


[12/02/2022 4:06 PM] bk#4411
I was envisioning a function like 
```
def isSameBox(left: Box, right: Box, value: Option[((Long, Long) => Boolean], ...functs to compare other registers)
```
where a `None` would be `left.value == right.value` and a `Some` would use the `value` arg to compare like `value((left.value, right.value))`


[12/02/2022 4:09 PM] bk#4411
maybe I am going about structuring a poorly designed dapp but I find a need to validate an input box is almost the same as the output box


[12/02/2022 4:12 PM] morphic#4133
yeah, I see, functions as arguments could be useful, indeed.


[12/02/2022 4:13 PM] bk#4411
I am kind of baffled how people are writing contracts without it.  üòÇ   It feels like writing assembly code.


[12/02/2022 4:16 PM] morphic#4133
In v4.x it wouldn't work anyway because of many limitations of AOT.


[12/02/2022 4:17 PM] morphic#4133
Also, Option is not first-class data type still, even in v5.0


[12/02/2022 4:17 PM] morphic#4133
Such limitations can be resolved in v6.0


[12/02/2022 4:19 PM] morphic#4133
On the other hand, there is a lot of wisdom in making contracts as simple as possible. With more abstractions it is  usually harder to understand the logic.


[12/02/2022 4:23 PM] bk#4411
I would also need some form of generics to write `isSameBox`.  I can't write `r4: Option[(X, X) => Boolean]`  unless I can write `r4: Option[(Any, Any) => Boolean]` and provide a concrete type at the call site.


[12/02/2022 4:24 PM] bk#4411
I take your point about keeping things simple. Any maybe the solution is some more builtin utility functions.


[12/02/2022 4:25 PM] bk#4411
Right now for a contract to take in an input box and validate an output box that is exactly the same but has 1 less of a specific token is sooooo much boilerplate.


[12/03/2022 8:08 PM] bk#4411
Did there use to be a `Coll.diff` ??   I could have sworn there was but now I don't see it in the docs.


[12/03/2022 8:16 PM] bk#4411
Comparing https://github.com/ScorexFoundation/sigmastate-interpreter/blob/v3.3.3/docs/LangSpec.md and https://github.com/ScorexFoundation/sigmastate-interpreter/blob/v4.0.7/docs/LangSpec.md a huge amount of `Coll` operations were dropped. I don't see that mentioned in the Release notes. Is there any record of why that happened?


[12/05/2022 9:55 AM] morphic#4133
There is no diff now and has never been.


[12/05/2022 9:58 AM] morphic#4133
What happened is the dreams has met with the reality. üôÇ 
LangSpec was used early on as a design doc and not everything was implemented (for the lack of time mostly and also due to AOT limitations). 
Then it was cleaned up.

{Reactions}
üòÄ 

[12/05/2022 2:26 PM] bk#4411
Thanks for the info!


[12/07/2022 3:13 AM] soysor#6001
are there any code formatters that work for ergo script?


[12/07/2022 5:24 AM] greenhat#6562
I have not tried any, but given its closeness to Scala, scalafmt might work.

{Reactions}
üëç 

[12/08/2022 3:36 AM] 6directions#1089
How do you set context variables?


[12/08/2022 4:52 AM] MGpai#4313
you add it to the input being used I think


[12/08/2022 4:55 AM] MGpai#4313
```scala
val inputBox: InputBox = someInput.withContextVars(ContextVar.of(0.toByte, someVar))
```


[12/08/2022 4:55 AM] MGpai#4313
this is in appkit btw ^

{Reactions}
üëç 

[12/08/2022 1:33 PM] 6directions#1089
Ooo nice, thanks so much üôÇ


[12/08/2022 1:34 PM] 6directions#1089
What's different about using context vars and constants? Do context vars affect the script's address the way constants do?


[12/08/2022 2:34 PM] MrStahlfelge#0042
no. context vars can be added to inputs while registers can only be set for outputs

{Reactions}
üëç 

[12/08/2022 3:14 PM] morphic#4133
The constants are embedded in the ErgoTree and hence part of the address. Vars are also embeded, but not as concrete values but as access operation GetVar(id)

{Reactions}
üëç 

[12/13/2022 2:21 AM] 6directions#1089
can context vars _only_ be set on inputs?


[12/13/2022 5:54 AM] MGpai#4313
yes


[12/20/2022 1:53 PM] haileypdll#3353
Hello,
The following script is trying to make the box spendable by the address for which the ergotree is stored in the register R4 of the box.
`{ proveDlog(decodePoint(SELF.R4[Coll[Byte]].get)) }`
But is seems that this does not work. (prover does not have enough witnesses to perform the proof)
When storing the address as a SigmaProp, instead of an ergotree it works fine.
`{ SELF.R4[SigmaProp].get }`

I'm doing something wrong with the Ergotree stored ?
Or what I'm trying to do is not possible from the Ergotree ?


[12/20/2022 2:18 PM] morphic#4133
I see Coll[Byte] in the register. Why you call it ErgoTree?


[12/20/2022 2:23 PM] haileypdll#3353
The ergotree of the address, encoded as hex string, like: "0008cd039ed9a6df20fca487da2d3b58e822cdcc5bcfad4cca794eadf132afa3113f31a6"


[12/20/2022 2:24 PM] haileypdll#3353
(This one is a valid ECpoint, otherwise I got a different error)


[12/20/2022 2:25 PM] morphic#4133
ah, I see, but ErgoTree bytes are not the same as GroupElement encoded bytes


[12/20/2022 2:29 PM] haileypdll#3353
There is a way, from a Coll[Byte] register, to get the SigmaProp for a specific address ? Or the ErgoTree hex string miss some information ?


[12/20/2022 2:36 PM] morphic#4133
ErgoTree bytes cannot be parsed by decodePoint


[12/20/2022 2:39 PM] haileypdll#3353
thanks


[12/20/2022 2:50 PM] morphic#4133
What is your goal?


[12/20/2022 2:55 PM] haileypdll#3353
Make the box spendable by a specific address only, but store the information (address) in a register as a Coll[Byte]
(Because I need several of them, and cannot encode Coll[SigmaProp])


[12/20/2022 3:46 PM] liquid_phase#4605
Looking for someone to audit our smart contracts for security and to validate intended functionality


[12/20/2022 3:47 PM] liquid_phase#4605
repo here: https://github.com/TremendouslyHighFrequency/SmartContracts


[12/20/2022 3:51 PM] liquid_phase#4605
@scalahub do you have the bandwidth perhaps?


[12/20/2022 6:25 PM] morphic#4133
What  "spendable by a specific address" means?


[12/20/2022 6:40 PM] haileypdll#3353
Spendable by the wallet signing for an erg public address like 9azedfg2d78l...


[12/20/2022 6:45 PM] morphic#4133
So, you probably have isP2PK() == true address.


[12/20/2022 6:47 PM] morphic#4133
If yes, then you can use public DLogProtocol.ProveDlog getPublicKey()
And then use that ProveDlog value to construct appkit.SigmaProp(dlog)


[12/20/2022 6:47 PM] morphic#4133
Then create ErgoValue with SigmaProp and then add it to a register


[12/20/2022 9:13 PM] haileypdll#3353
I'm using sigma-rust so this is not totally clear. But it seems i need to go through a public key to do that. Thanks


[12/20/2022 10:25 PM] morphic#4133
the naming is sigma_rust should be similar to Sigma. Also please ask @greenhat


[12/21/2022 7:49 AM] greenhat#6562
You can make a ProveDlog constant from EcPoint bytes with `Constant.from_ecpoint_bytes(bytes)`


[12/21/2022 4:07 PM] haileypdll#3353
Here the type of the register would be SigmaProp. I would have wanted to store it as a Coll[Byte], and re-generate the SigmaProp in the ergoscript smart contract.


[12/21/2022 4:12 PM] greenhat#6562
@haileypdll  Oh, I see. Well, I don't see what's wrong with `{ proveDlog(decodePoint(SELF.R4[Coll[Byte]].get)) }` . I think it should work with a serialized EcPoint.


[12/21/2022 7:51 PM] haileypdll#3353
The ecpoint seems good because bad vakues gives an ecpoint decoding error... When the ecpoint decoding is ok, i got prover error... But i've made a free register to store it as SigmaProp...


[12/22/2022 7:17 AM] greenhat#6562
This is really weird. I just checked `proveDlog` and `decodePoint` and they should produce a valid `SigmaProp` given the byte array is an encoded `EcPoint`. An equivalent of `Constant.from_ecpoint_bytes`.


[12/22/2022 7:25 AM] haileypdll#3353
My valid ecpoint in the Coll[Byte] register, not working for signing the transaction, is the ergotree for the public address. This is correct?


[12/22/2022 7:30 AM] greenhat#6562
If your ergotree is for P2PK address, then it should be a serialized EcPoint. How exactly are you getting the bytes you put in R4?


[12/22/2022 7:46 AM] haileypdll#3353
I'm doing: 

`const issuerErgoTree = (await ergolib).Address.from_base58(address).to_ergo_tree().to_base16_bytes();
mintBoxBuilder.set_register_value(4, await encodeHexConst(issuerErgoTree));`

With:
`export async function encodeHexConst(reg) {
    return (await ergolib).Constant.from_byte_array(Buffer.from(reg, 'hex'));
}`


[12/22/2022 7:54 AM] greenhat#6562
Found it. `const issuerErgoTree = (await ergolib).Address.from_base58(address).content_bytes();` should work. ErgoTree serializes with a header.


[12/22/2022 8:36 AM] haileypdll#3353
Thanks, it worked ! (I've upgraded from ergo lib wasm 20.1 to 21.1 and got the content_bytes() function)

`const issuerErgoTree = (await ergolib).Address.from_base58(address).content_bytes();
mintBoxBuilder.set_register_value(4, (await ergolib).Constant.from_byte_array(issuerErgoTree));`

{Reactions}
üôå (2) 

[12/27/2022 2:50 AM] MGpai#4313
How do I get access to minerpk?


[12/27/2022 5:14 AM] MGpai#4313
`CONTEXT.headers(0).minerPk` how to convert this to a propByte so I can check if an output goes here
@morphic


[12/27/2022 5:11 PM] morphic#4133
you can try this 
proveDlog(minerPk).propBytes == out.propositionBytes
this will only work if `out` uses P2PK address with ErgoTree version 0 in the header. @MGpai


[12/27/2022 5:36 PM] MGpai#4313
I am not sure about the latter


[12/27/2022 5:36 PM] MGpai#4313
I just want to verify the boxes that go to miner


[12/27/2022 5:38 PM] morphic#4133
which library you use to create and sign TX?


[12/27/2022 5:39 PM] MGpai#4313
appkit


[12/27/2022 5:41 PM] morphic#4133
How you specify the address of the out box?


[12/27/2022 5:55 PM] MGpai#4313
what do you mean, I have appkit automatically build the fee box


[12/27/2022 5:58 PM] morphic#4133
if you what to use `proveDlog(minerPk).propBytes == out.propositionBytes` then the `out` box should be created with correct ErgoTree.
I don't know how this out box is created, so cannot tell you will this condition work or not.


[12/28/2022 5:22 AM] Balb#7267
whats the best way to ensure that the output from a contract goes to a specific p2s address


[12/28/2022 5:24 AM] Balb#7267
in ergoscript, if i do `blake2b26(outBox.propositionBytes) == contractAddress` what do i set contractAddress as?


[12/28/2022 5:36 AM] Krasavice Blasen#4574
the blake2b256 hash of the ergotree encoded as base 58


[12/28/2022 5:37 AM] Krasavice Blasen#4574
In the contract you could physically write fromBase58("hashedergotree")


[12/28/2022 5:45 AM] Balb#7267
to get hashedergotree can i do `.getErgoAddress().script` on an address in appkit?


[12/28/2022 6:03 AM] Krasavice Blasen#4574
Not sure on appkit, that looks like it will just get you the address of the script.


[12/28/2022 6:04 AM] Krasavice Blasen#4574
So the steps are get the address, convert to ergotree (can confirm your conversion on the node if you like http://204.48.31.129:9053/swagger#/script/addressToTree)
Hash the hex string to blake2b256, convert the result to base58


[12/28/2022 6:40 AM] Balb#7267
i must not be hashing to blake2b or converting to base58 correctly


[12/28/2022 6:41 AM] Balb#7267
the ergotree string is the same that the node gives me


[12/28/2022 8:05 AM] Krasavice Blasen#4574
Hmm, if you want to check your blake2b256 hash function. ErgoTree: ``101704020e2071766757877ba7329864f5ad0931810cfdb3af7f0f7744a1cb18ed44b56a14dc040004000e20f6c2123b6da54ab4bfbf03e9e4d37a1ac2e0bc66e04f553c44d385d575d364f804000580897a0580897a0580897a04000e207cf1846046c5c6e98778ea4f977981e53c5c5c9cdf04eb2c19ac9aef4fadef9d040004060480a4e803040404000e209916d75132593c8b07fe18bd8d583bda1652eed7565cf41a4738ddd90fc992ec04c20f04d00f041804140480897a0100d80fd601b2a5730000d60293cbc272017301d603b2db6501fe730200d604938cb2db63087203730300017304d605b2db63087201730500d6068c720502d607e4c6a70405d608e4c672030411d6099d9c7207b0b47208e4c6a70604b172087306d9010959999a8c7209018c72090273077308d60a93e4c6720104057207d60bb2a5730900d60c938c720501730ad60dc1a7d60eb2a4730b00d60fdb6308720ed1ecedededededed720272049272067209720a93c2720be4c6a7050e720c93720dc1720b9592b1720f730cd802d61099720d7e730d05d6119dc1720e8cb2720f730e0002edededededed7202938cb2720f730f000173109272069d9c72107e7311059c7e7312057211ec9072109d9c9c72097e73130572117e73140591a37315720c7204720a7316``
Should hash to 
``e8b46a1a4114e301035e8fb80e7f81418a85da55878c550384dd78442cceddc6``


[12/28/2022 8:24 AM] Balb#7267
it appears mine isnt the same


[12/28/2022 8:24 AM] Balb#7267
i got `fa68f2d8f243951b6af48af13e2872793bd6f6c0c63ebb2150de209ddd732eff`


[12/28/2022 9:01 AM] Balb#7267
im not sure where im going wrong

my testnet p2s address is: `24fZfBxxFZYG6ErBfvit6VhzwagencNc2mVwnHugTA5yA78tLvfTPsEz8AucKAEwJarwT9N1mtfxLnWD8WchdQdxr3su3MszYXSniUpUf3T13rXRBRTdx4qUimoGJhGPYASjrqaR4V6SnkpkkHkp62onP5fPbNfxdQbuo3uCVmmBQd6Xt3t8NEEVHFqNrCVT1pp4q`

and after i do everything the base 58 string is: `8mbEW7rWGjFcYehtYQcVwCHTjBTDckVnqqaGkg1FVzDS`


[12/28/2022 3:06 PM] Cheese Enthusiast#0548
What exactly are you hashing, do you have any example code?


[12/28/2022 3:21 PM] Balb#7267
i have two contracts and I want to ensure that the outputs from contract 1 goes to contract 2


[12/28/2022 3:22 PM] Balb#7267
contract one looks like this 

```
sigmaProp(blake2b256(OUTPUTS(0).propositionBytes == mintContractAddress)
```


[12/28/2022 3:22 PM] Cheese Enthusiast#0548
Whats the corresponding off-chain code you have'


[12/28/2022 3:23 PM] Balb#7267


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/1057680223493177495/message.txt


[12/28/2022 5:19 PM] Cheese Enthusiast#0548
Ah


[12/28/2022 5:19 PM] Cheese Enthusiast#0548
You're getting the wrong bytes


[12/28/2022 5:21 PM] Cheese Enthusiast#0548
Just use `ErgoTree.bytes()`, for example `mintContractErgoTreeBytes = mintContractAddress.getErgoTree.bytes`. Then do `Blake2b256(mintContractErgoTreeBytes)`


[12/29/2022 9:18 AM] Balb#7267
tried this out and my system still doesn't work


[12/29/2022 9:19 AM] Balb#7267
i think the problem is with my proxy contract because when i use `sigmaProp(1==1)` as the proxy contract then my minting contract works but when I try to do the other proxy contract then i get a script reduced to false error


[01/03/2023 6:10 PM] Cheese Enthusiast#0548
Sorry didnt see this before


[01/03/2023 6:11 PM] Cheese Enthusiast#0548
This is the entire contract right?


[01/03/2023 9:16 PM] Balb#7267
Yes


[01/03/2023 11:57 PM] Cheese Enthusiast#0548
Make sure you're not using the String or anything


[01/03/2023 11:57 PM] Cheese Enthusiast#0548
Honestly it might be easier to not use the fromBase58 function


[01/03/2023 11:57 PM] Cheese Enthusiast#0548
And instead to just insert it into the contract via the constants


[01/03/2023 11:58 PM] Cheese Enthusiast#0548
Ah wait


[01/03/2023 11:58 PM] Cheese Enthusiast#0548
That's the issue


[01/03/2023 11:58 PM] Cheese Enthusiast#0548
Yeah don't use Base58


[01/03/2023 11:58 PM] Cheese Enthusiast#0548
Just insert a Coll[Byte] into the contract


[01/10/2023 10:15 PM] liquid_phase#4605
@kushti sir, i was wondering if you have had the chance to look at the smart contracts for Terahertz(swamp audio) mutual release agreement?


[01/31/2023 4:42 PM] MGpai#4313
Within a contract, how would you ensure a token gets burned?


[01/31/2023 6:07 PM] morphic#4133
check the sum on inputs and outputs


[01/31/2023 6:17 PM] MGpai#4313
How do you sum all possible inputs and outputs?


[02/01/2023 9:37 AM] morphic#4133
@MGpai 
val inAmounts = INPUTS.flatMap(inBox => inBox.tokens.filter(t => t._1 == tokenId).map(t => t._2))
inAmounts.fold(0L, (acc, x) => acc + x)

{Reactions}
üòò 

[02/01/2023 9:37 AM] morphic#4133
something like this for OUTPUTS


[02/01/2023 10:28 AM] haileypdll#3353
Ho thanks, i need to bookmark this ! üòç


[02/04/2023 10:30 PM] MGpai#4313
@morphic I don't see `fromBase16` in the spec


[02/04/2023 10:30 PM] MGpai#4313
https://github.com/ScorexFoundation/sigmastate-interpreter/blob/develop/docs/LangSpec.md


[02/05/2023 10:28 PM] kushti#0978
@liquid_phase https://github.com/TremendouslyHighFrequency/SmartContracts/blob/main/bootstrap.txt#L27 "Needed because comparison doesnt work without slicing" - but why ?

{Embed}
https://github.com/TremendouslyHighFrequency/SmartContracts/blob/main/bootstrap.txt
SmartContracts/bootstrap.txt at main ¬∑ TremendouslyHighFrequency/Sm...
Contribute to TremendouslyHighFrequency/SmartContracts development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/CpqMXr3sk0QbWkjAPDIfF2ae5ThOCxVgBgXIDQAtiT8/https/opengraph.githubassets.com/0ee2d031e86ce5f83e1c1f6ed9fd99361221b9780c820480ee3405ac8e8adc3d/TremendouslyHighFrequency/SmartContracts


[02/05/2023 10:49 PM] kushti#0978
@liquid_phase any high-level description of workflow


[02/05/2023 10:49 PM] kushti#0978
so what do you try to achieve with the contracts at all


[02/06/2023 4:41 PM] liquid_phase#4605
2 or more owners of NFT/FT objects, or one owner of many unique objects can enter the objects into a 'release agreement' or content pack. 

The bootstrap looks for the objects mentioned in the code and waits to receive them. when it receives all the objects, it then creates the Sale and withdrawal contracts. 

The sale contract dictates the royalty distribution of the sale of the entire pack of objects at once, think of a single smart contract music album which contains individual NFT or fungible token songs and automatically pays out the submitter of the object the amount they specified during bootstrapping. 

The withdrawal contract allows for the users/owners who entered the agreement to withdrawal the works from the contract based on a withdrawal consensus being met (sending the withdrawal / object receipt NFT to the contract) - an example of this is if the musicians on the album need to end the agreement because one discovered the other plagiarized their work from someone/somewhere else.

The smart contract would then act as a layer one index for specified hierarchies of objects, who owns them and what they expect to be paid for the sale of them, as well as conditions to dissolve the contract such as real world legal contracts have for media distribution. 

The goal of the contract is to have a layer-1 solution for independent collaboration and distribution of media objects, be it music or content-assets (brush packs, samples, loops, codeblocks, etc), where those entering the contract have the ability to nullify it if needed. Also to have a layer-1 solution to hierarchies of token objects from multiple disparate sources. Some proposed novel ideas for the contract were using it as a treasure chest filled with NFT objects that game players gamble and win/lose. Another would be an in-game property filled with other NFT items, where the items could be added/removed to change the appearance of the property in-game. Our application of it is for layer 1 collaboration


[02/06/2023 4:42 PM] liquid_phase#4605
@Krasavice Blasen can you answer this please? "https://github.com/TremendouslyHighFrequency/SmartContracts/blob/main/bootstrap.txt#L27 "Needed because comparison doesnt work without slicing" - but why ?"

{Embed}
https://github.com/TremendouslyHighFrequency/SmartContracts/blob/main/bootstrap.txt
SmartContracts/bootstrap.txt at main ¬∑ TremendouslyHighFrequency/Sm...
Contribute to TremendouslyHighFrequency/SmartContracts development by creating an account on GitHub.
https://images-ext-1.discordapp.net/external/CpqMXr3sk0QbWkjAPDIfF2ae5ThOCxVgBgXIDQAtiT8/https/opengraph.githubassets.com/0ee2d031e86ce5f83e1c1f6ed9fd99361221b9780c820480ee3405ac8e8adc3d/TremendouslyHighFrequency/SmartContracts


[02/06/2023 4:52 PM] liquid_phase#4605
@kushti the need for a  contract which could be nullified was / is needed for media publication (publication not being the same as minting, similarly uploading a track to the internet does not put it automatically on spotify - publication does.) This also allows a third party to enter the contract who is not the artists, such as a publishing house, who can then be defined in the withdrawal / bootstrap as an interested party. Based on my understanding of legal contracts, this gives the smart contract assignment provision and so there can always checks and balances to the distribution contract as well, such as if there are parties like advertisers putting in some form of investment but not assets in the agreement/publication.


[02/06/2023 4:56 PM] liquid_phase#4605


{Attachments}
https://cdn.discordapp.com/attachments/849659724495323206/1072199165628649502/192360881-5035ed14-ded6-4384-a75e-c8f10d9ae1ba.png


[02/06/2023 5:09 PM] liquid_phase#4605
Generally speaking, there are many dynamic ways to enter this contract. the 'publisher' is generally going to be the one who starts it and hosts the code required to convert the form inputs / wallet inputs from individual contributors into the code required to form the bootstrap


[02/07/2023 2:49 PM] Krasavice Blasen#4574
I just found it to be the case when I was testing the contract. I later spoke with Morphic and found out that slicing shouldn't be necessary (as expected) so the issue must have been unrelated.


[02/07/2023 2:50 PM] Krasavice Blasen#4574
So should be able to take it out just fine


[02/07/2023 3:05 PM] liquid_phase#4605
do you have time this month to ammend the code so it works without slicing? Or is including slicing an arbitrary thing that doesnt matter except by efficiency of lines of code processed ?


[02/07/2023 3:06 PM] liquid_phase#4605
in other words, is the contract fully usable in this way with slicing? If so, there is little to no urgency to ammend the code. However, if its a large performance or workflow impact - perhaps we need it changed sooner


[02/07/2023 3:33 PM] Krasavice Blasen#4574
No it won't impact anything either way. Just slightly lower verification costing.


[02/07/2023 3:34 PM] Krasavice Blasen#4574
The change is to replace L27 with ```val slicedInitialTokens = heldTokens0```


[02/07/2023 3:55 PM] liquid_phase#4605
thank you


[02/08/2023 8:51 PM] MGpai#4313
How do you get the size of a Coll[Byte]?


[02/08/2023 8:56 PM] morphic#4133
xs.size üôÇ


[02/08/2023 10:58 PM] MGpai#4313
thanks


[02/15/2023 3:29 AM] deathgripson#2395
```pinLockBox = tb.outBoxBuilder().value(Parameters.OneErg * ergoAmount).registers([ErgoValue.of(hashedPin)]).contract(pinLockContract).build()
senderErgoTree = ErgoTreeContract(pinLockContract.getErgoTree(), ergo._networkType)
withdrawBox = tb.outBoxBuilder().value(Parameters.OneErg * ergoAmount).registers([ErgoValue.of(pinBytes)]).contract(senderErgoTree).build()
```
while doing pinlockbox Im getting `script reduced to false` even though I think I set it up exactly as in the example. Heres the pinLockBox and withdrawBox (ergpy), the withdraw is reduced to false no matter what I try


[02/17/2023 12:29 AM] deathgripson#2395
anyone have any thoughts as to why p1 cannot withdraw from this after the deadline in this contract:
`sigmaProp(p1 && HEIGHT > deadline || p2 && HEIGHT <= deadline)` p2 can withdraw within their block time frame


[02/17/2023 12:34 AM] MGpai#4313
`sigmaProp(((HEIGHT > deadline) && p1) || (p2 && (HEIGHT <= deadline)))` try this maybe?


[02/17/2023 12:38 AM] Cheese Enthusiast#0548
Are p1 and p2 public keys?


[02/17/2023 12:41 AM] deathgripson#2395
yes i made sure to specify the keys


[02/17/2023 12:43 AM] Cheese Enthusiast#0548
Public keys are of type `SigmaProp`, meaning that putting them in the `sigmaProp` function (which takes booleans and returns `SigmaProp`) could make things weird. Try the following:

```scala
(p1 && sigmaProp(HEIGHT > deadline)) || (p2 && sigmaProp(HEIGHT <= deadline))
```


[02/17/2023 12:44 AM] deathgripson#2395
thank you ill try it


[02/17/2023 12:57 AM] MGpai#4313
good point


[02/17/2023 1:39 AM] deathgripson#2395
its still returning unprovenSchnorr


[02/17/2023 1:41 AM] deathgripson#2395
p2 can withdraw just fine from these contracts when I test but p1 always returns unprovenSchnorr


[02/17/2023 1:58 AM] deathgripson#2395
doesnt make a ton of sense right? p2 is set up same way as p1 and its just using a || to create 2 spending paths. are there any recently tested examples of contracts with 2 spending paths?


[02/17/2023 2:30 AM] deathgripson#2395
woah, i think getting new instance of ErgoAppKit solved it


[02/17/2023 2:31 AM] deathgripson#2395
object orientation b like


[02/17/2023 2:32 AM] deathgripson#2395
i also needed to get new instance in order to update block height so i guess that makes sense since they are dependent on the block height?


[02/17/2023 4:11 AM] Cheese Enthusiast#0548
Unproven Schnorr means the private key does not match the public key


[02/17/2023 4:12 AM] Cheese Enthusiast#0548
blockheight comes from the node, it should auto update when you call the `BlockchainContext`


[02/17/2023 4:12 AM] deathgripson#2395
I think it was occasionally throwing that when the sender tried to claim without getting a new instance of appkit first, but either way I got it working by getting a new instance.


[02/17/2023 4:15 AM] Cheese Enthusiast#0548
Not sure why getting a new instance of appkit changed the Unproven Schnorr error, but if it works it works


[02/17/2023 4:15 AM] deathgripson#2395
I think its because it relies on the block height which didnt update, I might try just calling the Context variable though that would be better if that works


[02/17/2023 4:18 AM] Cheese Enthusiast#0548
Nah, Unproven Schnorr is only about whether the signed input has the signature of the correct public key. Blockheight also certainly updates correctly if you're able to build transactions, only reason it wouldn't is if your node was unsynced.


[02/17/2023 4:20 AM] Cheese Enthusiast#0548
Unproven Schnorr could happen if the incorrect EIP-3 indices were added


[02/17/2023 4:21 AM] deathgripson#2395
its very possibly i am not remembering properly when it was thrown


[02/17/2023 4:21 AM] deathgripson#2395
either way im not running into it any more


[02/17/2023 4:22 AM] Cheese Enthusiast#0548
Yep, lmk if you end up running into it again. I would suggest trying with multiple addresses just in case.


[02/17/2023 4:22 AM] deathgripson#2395
since the contract involves 2 parties wouldnt it be possible that if the block height was not updated locally, it would attempt to sign for the other party, and therefore result in this schnorr case?


[02/17/2023 4:23 AM] deathgripson#2395
the contract would only allow a signature for that party at that block height


[02/17/2023 4:23 AM] Cheese Enthusiast#0548
Nah, if it was a blockheight issue it should give a `Script Reduced To False` error


[02/17/2023 4:23 AM] deathgripson#2395
yea that one came up more regularly


[02/17/2023 4:23 AM] deathgripson#2395
makes sense


[02/17/2023 4:25 AM] deathgripson#2395
btw this form of the contract works `sigmaProp(p1 && HEIGHT > deadline || p2 && HEIGHT <= deadline)`


[02/17/2023 4:27 AM] Cheese Enthusiast#0548
It does work, but is bad practice imo


[02/17/2023 4:31 AM] deathgripson#2395
ok, better to wrap the height condition in sigmaprops?


[02/17/2023 4:32 AM] Cheese Enthusiast#0548
Yea, imo better to keep public keys and other sigma props outside of the `sigmaProp` function. Only put booleans inside that function.


[02/17/2023 4:32 AM] deathgripson#2395
sounds good thank you for the help


[02/17/2023 5:01 AM] deathgripson#2395
incase you arent aware im working with a python version of appkit with ergpy so it could have different results from the regular version. I tried to call the context variable it has `ergo._ctx`  and it didnt work however it brought up unprovenSchnorr again even though this exact script works if I just get a new instance right before. Only thing I can imagine is that it is because the ergo instance is not updated and tries to sign for the wrong party.


[02/17/2023 5:06 AM] Cheese Enthusiast#0548
Ah okay, yeah ergpy uses JPYPE I think which can cause some strange issues not present in Scala or Java. @MGpai would know more.


[02/17/2023 5:07 AM] Cheese Enthusiast#0548
Did this happen when trying different addresses, or the same ones?


[02/17/2023 5:07 AM] deathgripson#2395
same address just didnt update the instance


[02/17/2023 5:08 AM] deathgripson#2395
incase mgpai is reading this back the problem is solved already


[02/17/2023 5:08 AM] deathgripson#2395
but this does seem to be a sort of strange error that is derived


[02/17/2023 5:09 AM] Cheese Enthusiast#0548
Still pretty strange but Idk enough about ergpy to help you there. Imo it would be better to move to Scala eventually, especially as you make more advanced contracts. But that decision is up to you üôÇ


[02/17/2023 5:10 AM] deathgripson#2395
yea I would be willing to especially if it enables more features, but for now I just need to write relatively small contracts so I should be able to work with what I got right now


[02/17/2023 1:08 PM] MGpai#4313
What was the problem?


[02/17/2023 1:08 PM] MGpai#4313
Yes switch to scala for advanced contract, specifically those with special data types


[02/17/2023 1:08 PM] MGpai#4313
Ergopad and I both had to switch at some point ü§£


[02/17/2023 5:56 PM] deathgripson#2395
maybe I will follow this https://github.com/ApexTheory/appkit-by-example that you sent me to learn the scala version. im not super familiar w scala, what would I have to do to run the example (assuming I already fill the ergo config w my parameters)

{Embed}
https://github.com/ApexTheory/appkit-by-example
GitHub - ApexTheory/appkit-by-example
Contribute to ApexTheory/appkit-by-example development by creating an account on GitHub.


[02/17/2023 5:57 PM] deathgripson#2395
luckily for the current stage of my project I should be able to get by w very small contracts but if I run into an issue I will likely just start using scala


[02/17/2023 5:58 PM] MGpai#4313
how are your python skills?


[02/17/2023 5:59 PM] deathgripson#2395
pretty good i dont usually have issues related to the python lang, rn only issues are coming from the blake function w that pin lock contract however I dont believe I have tried everything


[02/17/2023 5:59 PM] MGpai#4313
well you could help improve the repo if you come across anything


[02/17/2023 6:00 PM] MGpai#4313
I haven't had the time to add much since I been working with scala for several months now


[02/17/2023 6:00 PM] MGpai#4313
I have been meaning to also create a native appkit for python too


[02/17/2023 6:01 PM] MGpai#4313
similar to fleet


[02/17/2023 6:01 PM] MGpai#4313
here is kinda the start to it:

https://github.com/mgpai22/ergpy-native


[02/17/2023 6:02 PM] MGpai#4313
I saw that you have cpp code in your repo so you may be able to implement certain ergo based serialization for python better than I


[02/17/2023 6:02 PM] deathgripson#2395
Ill make sure to, so far I have only added one thing to the helper file most other things I am just implementing directly. If there are any new things I can implement I will


[02/17/2023 6:03 PM] deathgripson#2395
yea I do know cpp, I am not using a ton of it in the current project, but that sounds like an interesting thing to do


[02/17/2023 6:03 PM] MGpai#4313
a robust python environment will really help with onboarding new devs into ergo


[02/17/2023 6:05 PM] deathgripson#2395
yea I agree, the framework Im building is mostly a deployment pipeline based around ergpy appkit features. python does make it really easy to edit the interaction scripts


[02/17/2023 6:08 PM] MGpai#4313
in my native repo you can see tools to play with ergo addresses all native!


[02/17/2023 6:08 PM] MGpai#4313
with minimal dependencies


[02/17/2023 6:09 PM] MGpai#4313
I wrote it to programmatically decipher which address type a string is


[02/17/2023 6:09 PM] MGpai#4313
rather than using jpype or node api requests


[02/17/2023 6:09 PM] deathgripson#2395
wow it looks great


[02/17/2023 6:10 PM] deathgripson#2395
Are you looking at the source code for appkit and re-implementing or how are you going about this?


[02/17/2023 6:13 PM] MGpai#4313
yeah kinda


[02/17/2023 6:13 PM] MGpai#4313
and fleet too


[02/17/2023 6:13 PM] MGpai#4313
I think it makes sense to start with addresses


[02/17/2023 6:13 PM] MGpai#4313
then box objects


[02/17/2023 6:13 PM] MGpai#4313
then transaction builder (along with node and explorer api to submit)


[02/17/2023 6:14 PM] MGpai#4313
but its not in my immediate road map


[02/17/2023 6:14 PM] MGpai#4313
probably will start during summer time, when I have time off from school


[02/17/2023 6:16 PM] deathgripson#2395
makes sense its a pretty large undertaking


[02/17/2023 6:18 PM] deathgripson#2395
yea that does make sense, sounds like a great project


[02/17/2023 7:08 PM] deathgripson#2395
any ideas as to what this error means ```Error in Evaluation.compile.evaluate(s325 -> MethodCall(s324, scalan.Base$Ref special.sigma.CostedObjects$SizeBox.getReg(scalan.Base$Ref,scalan.TypeDescs$Elem), [s82, CollElem<Coll[Byte]>], true))
```


[02/17/2023 7:10 PM] deathgripson#2395
@MGpai I am making my pin bytes like this `JPin =  jpype.JByte(int(pinNumber.hex(), 16))`
 then passing it into the registers like 
```withdrawBox = tb.outBoxBuilder().value(Parameters.OneErg * ergoAmount - Parameters.MinFee) \
            .registers(
                    [ErgoValue.of(JPin )]
            ).contract(senderErgoTree).build()```
which results in the above error when trying to claim


[02/17/2023 7:11 PM] MGpai#4313
what is pinNumber?


[02/17/2023 7:11 PM] deathgripson#2395
9728


[02/17/2023 7:12 PM] deathgripson#2395
the byte array of the hash is specified as such: 
    ```
    pinNumber = b'9728'
    hasher = hashlib.blake2b(digest_size=32)
    hasher.update(pinNumber)
    hashedPin = hasher.digest()
    pinHashByteArray = bytearray(hashedPin.hex(), 'utf-8')```


[02/17/2023 7:13 PM] MGpai#4313
and you get the hash that starts with "c..." right?


[02/17/2023 7:13 PM] deathgripson#2395
yea this one caff357f5e90c10ae18debce6948ea80f15162ba3815bb34c2e892587f1978e0


[02/17/2023 7:14 PM] deathgripson#2395
the Coll object of the byte array looks like this :
` Coll(-54,-1,53,127,94,-112,-63,10,-31,-115,-21,-50,105,72,-22,-128,-15,81,98,-70,56,21,-69,52,-62,-24,-110,88,127,25,120,-32)`


[02/17/2023 7:15 PM] MGpai#4313
what happens if you pass in the hashedPin?


[02/17/2023 7:15 PM] MGpai#4313
is that type bytes?


[02/17/2023 7:16 PM] MGpai#4313
or list[bytes]


[02/17/2023 7:17 PM] deathgripson#2395
so the above Coll object is actually the output of this:
`print("getval:", ErgoValue.of(hashedPin).getValue())`


[02/17/2023 7:18 PM] deathgripson#2395
im trying rn with just the hashedPin


[02/17/2023 7:21 PM] deathgripson#2395
when trying w hashed pin i get `Error in Evaluation.compile.evaluate(s325 -> MethodCall(s324, scalan.Base$Ref special.sigma.CostedObjects$SizeBox.getReg(scalan.Base$Ref,scalan.TypeDescs$Elem), [s82, CollElem<Coll[Byte]>], true))` same exact error i think


[02/17/2023 7:22 PM] deathgripson#2395
```hashedpin: Coll(-54,-1,53,127,94,-112,-63,10,-31,-115,-21,-50,105,72,-22,-128,-15,81,98,-70,56,21,-69,52,-62,-24,-110,88,127,25,120,-32)
hashedPinByteArray: Coll(99,97,102,102,51,53,55,102,53,101,57,48,99,49,48,97,101,49,56,100,101,98,99,101,54,57,52,56,101,97,56,48,102,49,53,49,54,50,98,97,51,56,49,53,98,98,51,52,99,50,101,56,57,50,53,56,55,102,49,57,55,56,101,48)
``` both seem to fail so far


[02/17/2023 7:35 PM] deathgripson#2395
bytearray in utf-8 makes sense right?


[02/17/2023 8:37 PM] MGpai#4313
I don't think so


[02/17/2023 8:37 PM] deathgripson#2395
what does [Coll[Byte]] expect ?


[02/17/2023 8:38 PM] MGpai#4313
Coll[Byte] means Array[Byte]


[02/17/2023 10:22 PM] deathgripson#2395
I found a way!!


[02/17/2023 10:23 PM] deathgripson#2395
I can pipe in scala getbytes through Popen


[02/17/2023 10:23 PM] deathgripson#2395
it works!


[02/17/2023 11:07 PM] MGpai#4313
oh I think I might have used that before


[02/17/2023 11:10 PM] deathgripson#2395
yea u can just create a scala file that returns the python format then you run the scala file with Popen (in python) and an argument and capture the output, then you do this ast.literal_eval(result) and it will read it into the python formatted object that the scala file returns.


[02/17/2023 11:12 PM] deathgripson#2395
Popen returns bytes no mater what so you have to .decode() them to get rid of the b'' wrapper


[02/21/2023 10:05 AM] deathgripson#2395
probably a reach but does ergo script have any built in way to do scalar multiplication?


[02/24/2023 2:43 AM] MGpai#4313
Is there a way to sort boxes based on the same script code but with different constants


[02/24/2023 2:43 AM] MGpai#4313
for example I have a script with const a


[02/24/2023 2:43 AM] MGpai#4313
and script with const b


[02/24/2023 2:43 AM] MGpai#4313
the code of the scripts are the same


[02/24/2023 2:44 AM] MGpai#4313
but they have different hashes as they are compiled with different constants


[02/24/2023 8:31 PM] MGpai#4313
@morphic how can I use an ergoTreeTemplateHash


[02/24/2023 8:31 PM] morphic#4133
however you like üôÇ


[02/24/2023 8:43 PM] MGpai#4313
no I mean how does it work?


[02/24/2023 8:45 PM] morphic#4133
actually I don't remember. Have you looked at the code?


[02/24/2023 8:45 PM] MGpai#4313
no is there documentation on this?


[02/24/2023 8:48 PM] morphic#4133
you are talking about 
public class BoxQuery {
  @SerializedName("ergoTreeTemplateHash")
  private String ergoTreeTemplateHash = null;
? @MGpai


[02/24/2023 8:49 PM] MGpai#4313
I want to make use of this endpoint


[02/24/2023 8:49 PM] MGpai#4313
https://api.ergoplatform.com/api/v1/docs/#operation/postApiV1BoxesUnspentSearch


[02/24/2023 8:49 PM] MGpai#4313
likely


[02/24/2023 8:51 PM] morphic#4133
hm, this is a dark side of explorer. Maybe @Ilya | Spectrum can help?


[02/24/2023 8:51 PM] MGpai#4313
ü§£


[02/24/2023 8:54 PM] morphic#4133
so the main question is how to create ergoTreeTemplate bytes, I don't know how explorer expects the bytes should be created.


[02/24/2023 8:55 PM] MGpai#4313
but like what is it first of all?


[02/24/2023 8:56 PM] morphic#4133
this is to search boxes by ergoTree template (content of ErgoTree.root)


[02/24/2023 8:57 PM] MGpai#4313
so do all scripts that share the SAME code but different constants have the same template hash?


[02/24/2023 8:58 PM] morphic#4133
yes, they should, but again depends on how the bytes are expected to be created


[02/24/2023 8:59 PM] morphic#4133
For example does the bytes include ErgoTree.header?


[02/24/2023 9:00 PM] MGpai#4313
not sure


[02/24/2023 9:01 PM] morphic#4133
neither am I


[02/24/2023 9:03 PM] MGpai#4313
would kushti know?


[02/24/2023 9:04 PM] morphic#4133
cannot speak for him, but I suggest ping Ilya first


[02/24/2023 9:05 PM] MGpai#4313
I see no ergoTreeTemplate stuff on node endpoints


[02/24/2023 9:05 PM] morphic#4133
or you can look at the explorer code, it is Scala


[02/24/2023 9:07 PM] MGpai#4313
https://tenor.com/view/hunt-wilderpeople-taika-wilderpeop-gif-7515442

{Embed}
https://tenor.com/view/hunt-wilderpeople-taika-wilderpeop-gif-7515442
https://images-ext-2.discordapp.net/external/fEtrQRWSfxxLXriiJx7DFaw565xEY-BjyLarCaMwf3o/https/media.tenor.com/geMiGBdt4NYAAAAD/hunt-wilderpeople.png

{Reactions}
üòÅ 

[02/24/2023 9:27 PM] MGpai#4313
@morphic found this


[02/24/2023 9:27 PM] MGpai#4313
https://github.com/ergoplatform/eips/blob/67a314cead29fbd3e0c6ab4f1696c310c9d2d532/eip-0005.md

{Embed}
https://github.com/ergoplatform/eips/blob/67a314cead29fbd3e0c6ab4f1696c310c9d2d532/eip-0005.md
eips/eip-0005.md at 67a314cead29fbd3e0c6ab4f1696c310c9d2d532 ¬∑ ergo...
Ergo Improvement Proposals. Contribute to ergoplatform/eips development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/oOg0b-jP55FbeJxsdA7Zi5x9th3YyFRN19TqajyWhLA/https/opengraph.githubassets.com/e8508a99918c18d20f8996dca19dfac2a9299e40afabcc0175446315cc9bf1bf/ergoplatform/eips


[02/24/2023 9:29 PM] MGpai#4313
Is there a method to convert ergotree to a template?


[02/24/2023 9:29 PM] MGpai#4313
In appkit?


[02/24/2023 9:30 PM] morphic#4133
it is being implemented


[02/24/2023 9:30 PM] morphic#4133
look at the latest sigma PRs


[02/27/2023 1:36 AM] deathgripson#2395
is ctx.getUnspentBoxesFor deprecated if so what should I use in replacement


[02/28/2023 4:52 PM] deathgripson#2395
value
`    val gGE = GroupElement(dlogGroup.generator)` 
constants builder
` .item("generator", gGE)`
error output
```generator.multiply(SELF.R4[SGroupElement].get).getXCoord.toBigInteger == xGX &&
                                  ^
Invalid argument type of application Apply(Select(ConstantNode(ECPoint(79be66,483ada,...),SGroupElement),multiply,None),ArrayBuffer(Select(ApplyTypes(Select(Self$(167),R4,None),Vector(SGroupElement)),get,None))): expected WrappedArray(SGroupElement); actual: ArrayBuffer(SGroupElement)```


[02/28/2023 4:55 PM] Cheese Enthusiast#0548
If you can get the ECPoint/GE bytes, you could instead store a `Coll[Byte]` and use the `decodePoint` function in ErgoScript to get a GroupElement


[02/28/2023 4:55 PM] deathgripson#2395
oh thanks


[02/28/2023 4:55 PM] deathgripson#2395
Ill try this


[02/28/2023 5:01 PM] deathgripson#2395
would I encode my point as bytes like this?
`val generator = dlogGroup.generator.getEncoded(true)`


[02/28/2023 5:02 PM] deathgripson#2395
because this gives me `Cannot find method 'decodePoint' in in the object ConstantNode(Coll(2,121,-66,102,126,-7,-3...`


[02/28/2023 5:06 PM] deathgripson#2395
theres an example here https://docs.ergoplatform.com/dev/scs/sigma/verifying/#schnorr-identification that uses the generator this way but doesnt show how it sets up the constants or registers


[02/28/2023 5:32 PM] Cheese Enthusiast#0548
Can you show me the ErgoScript?


[02/28/2023 5:33 PM] deathgripson#2395
```{
              sigmaProp(
                receiver &&
                generator.decodePoint.multiply(SELF.R4[SGroupElement].get).getXCoord.toBigInteger == xGX &&
                generator.decodePoint.multiply(SELF.R4[SGroupElement].get).getYCoord.toBigInteger == xGY
              )
 
}```


[02/28/2023 5:33 PM] Cheese Enthusiast#0548
generator is the `Coll[Byte]` right?


[02/28/2023 5:34 PM] deathgripson#2395
It is Array[Byte] in scala technically idk how to make it Coll


[02/28/2023 5:34 PM] Cheese Enthusiast#0548
It should be this I believe:

```
{
              sigmaProp(
                receiver &&
                decodePoint(generator).multiply(SELF.R4[SGroupElement].get).getXCoord.toBigInteger == xGX &&
                decodePoint(generator).multiply(SELF.R4[SGroupElement].get).getYCoord.toBigInteger == xGY
              )
 
}
```
`decodePoint` is a global function, not a member of `Coll` type


[02/28/2023 5:35 PM] deathgripson#2395
ill try that


[02/28/2023 5:37 PM] deathgripson#2395
now its just saying I need a wrapped array instead of a regular array:
```Exception in thread "main" sigmastate.lang.exceptions.TyperException: 
line 5:                 decodePoint(generator).multiply(SELF.R4[SGroupElement].get).getXCoord.toBigInteger == xGX &&
                        ^
Invalid argument type of application Apply(Select(Apply(Ident(decodePoint,NoType),ArrayBuffer(ConstantNode(Coll(2,121,-66,102,126,-7,-36,-69,-84,85,-96,98,-107,-50,-121,11,7,2,-101,-4,-37,45,-50,40,-39,89,-14,-127,91,22,-8,23,-104),Coll[SByte$]))),multiply,None),ArrayBuffer(Select(ApplyTypes(Select(Self$(167),R4,None),Vector(SGroupElement)),get,None))): expected WrappedArray(SGroupElement); actual: ArrayBuffer(SGroupElement)```


[02/28/2023 5:38 PM] Cheese Enthusiast#0548
I don't think `.getXCoord` is a function, at least judging by the lang spec


[02/28/2023 5:39 PM] Cheese Enthusiast#0548
At least not a function available in ErgoScript, could be wrong though


[02/28/2023 5:39 PM] deathgripson#2395
in that case the contract can be ```decodePoint(generator).multiply(SELF.R4[SGroupElement].get) == xG``` where xG is just another GroupElement that I can specify


[02/28/2023 5:40 PM] Cheese Enthusiast#0548
That works, also the type is just `GroupElement`, not `SGroupElement`


[02/28/2023 5:41 PM] deathgripson#2395
Yea that was really confusing me, there is a SGroupElement in special.sigma that shows up in the error outputs alot


[02/28/2023 5:42 PM] Cheese Enthusiast#0548
If it has an 'S' in front of it, it's referring to the sigma state code under the ErgoScript. When you're working on the ErgoScript itself, you won't have to add the S's in front.


[02/28/2023 5:43 PM] deathgripson#2395
yea that makes sense lol thank you so much I got it to compile

{Reactions}
üî• 

[02/28/2023 6:05 PM] deathgripson#2395
wow apparently scalar mult in ergoscript is GroupElement.exp()


[02/28/2023 11:23 PM] deathgripson#2395
What does NoSuchElementException imply it happens when I am signing the tx


[02/28/2023 11:25 PM] deathgripson#2395
```      val unlockBox = ctx.newTxBuilder().outBoxBuilder()
        .value(ergoAmountFeeSubtracted )
        .contract(new ErgoTreeContract(sender.getErgoAddress.script, NetworkType.TESTNET))
        .registers(ErgoValue.of(x))
        .build()
      val inputboxes = java.util.Arrays.asList(ctx.getBoxesById(scalarLockBox).array.last)

      val tx = ctx.newTxBuilder()
        .boxesToSpend(inputboxes)
        .outputs(unlockBox)
        .fee(Parameters.MinFee)
        .sendChangeTo(prover.getP2PKAddress)
        .build()

      val signed = prover.sign(tx)

      ctx.sendTransaction(signed)```


[03/01/2023 12:07 AM] deathgripson#2395
the error output is just this Exception in thread "main" java.util.NoSuchElementException: None.get and a huge stack trace leading to the tx signature


[03/01/2023 12:14 AM] MGpai#4313
it means you trying to access an element that does not exist in ergoscript


[03/01/2023 12:15 AM] MGpai#4313
for example you may do `val x = SELF.R9[Long].get` but R9 may not exist


[03/01/2023 12:16 AM] deathgripson#2395
Im trying to access INPUTS(0).R4[BigInt].get and I think I added it correctly

.registers(ErgoValue.of(x))

where x is the bigint


[03/01/2023 12:23 AM] deathgripson#2395
this is on the withdrawing calls, the contract is published correctly


[03/01/2023 12:36 AM] deathgripson#2395
is there a specific way to format a bigint in a register? or maybe I can pass in Coll[bytes] that can be converted to bigint in ergoscript somehow?


[03/01/2023 12:46 AM] deathgripson#2395
found this ```  // c of signature in (c, s)
  val cBytes = getVar[Coll[Byte]](0).get
  val c = byteArrayToBigInt(cBytes)``` thats probably what  it is looking for


[03/01/2023 1:00 AM] deathgripson#2395
incase anyone else ever tries to do it you have to make the BigInt like this
```
      val x = new BigInteger(config.getParameters.get("x"))
      val xBYTES = x.toByteArray()
      val exBYTES = ErgoValue.of(xBYTES)
```


[03/01/2023 1:01 AM] deathgripson#2395
and in python x = secrets.randbits(256) will generate numbers larger than ergoscript expects as bigint so it needs to be decreased to 255


[03/01/2023 7:51 PM] deathgripson#2395
If I want to use the other registers do I just use the .registers() function one at a time for each extra register I want to use? Or is there a way I need to specify it


[03/01/2023 8:19 PM] Cheese Enthusiast#0548
I believe you just add a comma and then add the next ErgoValue in the parameters of the register call


[03/01/2023 8:24 PM] deathgripson#2395
ok thanks


[03/01/2023 9:01 PM] MGpai#4313
https://github.com/LiliumErgo/offchain-bot/blob/f6e4ef63b7bd563b0d003cc24ad719f66693a8a8/src/main/scala/utils/OutBoxes.scala#L269

{Embed}
https://github.com/LiliumErgo/offchain-bot/blob/f6e4ef63b7bd563b0d003cc24ad719f66693a8a8/src/main/scala/utils/OutBoxes.scala
offchain-bot/OutBoxes.scala at f6e4ef63b7bd563b0d003cc24ad719f66693...
Contribute to LiliumErgo/offchain-bot development by creating an account on GitHub.
https://images-ext-2.discordapp.net/external/J3ixB6q1d9eVAixl3n6OJ7G-cSHkuEal_qoawc_0-AA/https/opengraph.githubassets.com/f4cfd5a5ca39d9858557eb3ff1331dfc2f3da01f252420bea03af5164c130058/LiliumErgo/offchain-bot


[03/02/2023 12:15 AM] deathgripson#2395
Having issues specifying  curve points with x and y coords, when I put the same coords as constants the contract compiles and deploys a box with those coords as a check for spending. But when I try to claim w same coords it says invalid length for compressed/uncompressed encoding. When I tried to specify the coords as a GroupElement it returned get.none


[03/07/2023 9:04 PM] MGpai#4313
@morphic Is it possible to use the natural logarithm function in ergoscript?


[03/07/2023 9:06 PM] morphic#4133
unfortunately there is no such a function


[03/07/2023 9:07 PM] morphic#4133
BTW, there is no floating point type either


[03/07/2023 9:21 PM] MGpai#4313
I was thinking of using Taylor Series Expansion 

```scala
  def ln(x: Double): Double = {
    if (x > 2) return ln(x/2) + ln(2)
    val sum = (1 until 1000 by 2).foldLeft(0.0) { case (acc, i) =>
      acc + math.pow((x - 1) / (x + 1), i) / i
    }
    2 * sum
  }
```


[03/07/2023 9:21 PM] MGpai#4313
but this needs to be functional some how


[03/07/2023 9:44 PM] morphic#4133
recursion is also not supported


[03/07/2023 9:58 PM] MGpai#4313
Oh wow


[03/07/2023 9:58 PM] MGpai#4313
That's tough then lol


[03/16/2023 7:57 AM] Huginn#2291
Hi guys,
I was wondering if you could help me out. I am trying to ensure the total sum of all outputs except the first one is below certain threshold. Could you please help me with a simple code snippet for it? I am not sure how to exactly to that, perhaps via `Fold`? I am writing it in scala, which I have little experience unfortunately.


[03/16/2023 4:09 PM] lgd#5847
`val sumExceptFirst: Long = OUTPUTS.slice(1,OUTPUTS.size).fold(0L, { (output: Box, acc: Long) =>  output.value + acc })` that's ergoscript, but scala is similar with foldLeft


[03/16/2023 5:30 PM] Huginn#2291
Thanks for your help, that seems nice. I will make sure to try it out!


[04/01/2023 11:04 PM] kii#8888
Hi, 

I've a function like this:

```
val outLenderBoxCFTokenAmount: Long = OutLenderBox.tokens
                    .filter{(t: (Coll[Byte], Long)) => t._1 == _crowdFundTokenIdRegister.get}
                    .fold(0L, {(acc: Long, token: (Coll[Byte], Long)) => acc + token._2}
```

However, I'm running into an issue when I'm running this with an inputBox/outBox where the token with the crowdFundTokenId in the crowdFundTokenIdRegister does not exists.

It throws me this error:
Error in Evaluation.compile.evaluate(s19237 -> MethodCall(s55, scalan.Base$Ref special.collection.Colls$Coll.foldLeft(scalan.Base$Ref,scalan.Base$Ref), [s19236, s15887], true))


What should i do to attack this issue?

Some ways that I have tried:
```

val inLenderBoxCFToken: Coll[(Coll[Byte], Long)] = InLenderBox.tokens
                    .filter{(t: (Coll[Byte], Long)) => t._1 == _crowdFundTokenIdRegister.get}

                val hackForFold: Coll[(Coll[Byte], Long)] = if (inLenderBoxCFToken.size > 0) inLenderBoxCFToken
                    else Coll((Coll(1.toByte), 0L))

                val inLenderBoxCFTokenAmount: Long = {
                    hackForFold
                        .fold(0L, {(acc: Long, token: (Coll[Byte], Long)) => acc + token._2})
                }

```

But it does not seem to be working and is throwing the same error


[04/03/2023 2:17 PM] morphic#4133
Upgrade to the latest Appkit. The error is from Sigma v4.x.

{Reactions}
ü§ù 

[04/18/2023 1:50 PM] glasgowm#9381
Started a thread.


==============================================================
Exported 1,520 message(s)
==============================================================
